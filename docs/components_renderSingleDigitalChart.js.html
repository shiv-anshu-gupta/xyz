

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> components/renderSingleDigitalChart.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- build/entry.js removed - not needed -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-analyzeGroupsAndPublish.html">analyzeGroupsAndPublish</a></li><li><a href="module-axisBuilder.html">axisBuilder</a></li><li><a href="module-axisCalculator.html">axisCalculator</a></li><li><a href="module-calculateAndPublishMaxYAxes.html">calculateAndPublishMaxYAxes</a></li><li><a href="module-chartAxisAlignment.html">chartAxisAlignment</a></li><li><a href="module-chartComponent.html">chartComponent</a></li><li><a href="module-chartManager.html">chartManager</a></li><li><a href="module-chartUpdateHelpers.html">chartUpdateHelpers</a></li><li><a href="module-components_renderComputedChart.html">components/renderComputedChart</a></li><li><a href="module-components_renderComtradeCharts.html">components/renderComtradeCharts</a></li><li><a href="module-components_renderSingleAnalogChart.html">components/renderSingleAnalogChart</a></li><li><a href="module-components_renderSingleDigitalChart.html">components/renderSingleDigitalChart</a></li><li><a href="module-comtradeUtils.html">comtradeUtils</a></li><li><a href="module-createDragBar.html">createDragBar</a></li><li><a href="module-createState.html">createState</a></li><li><a href="module-domUpdateQueue.html">domUpdateQueue</a></li><li><a href="module-domUpdateQueueInit.html">domUpdateQueueInit</a></li><li><a href="module-eventListenerManager.html">eventListenerManager</a></li><li><a href="module-handleVerticalLineShortcuts.html">handleVerticalLineShortcuts</a></li><li><a href="module-initVerticalLineControl.html">initVerticalLineControl</a></li><li><a href="module-main.html">main</a></li><li><a href="module-maxYAxesStore.html">maxYAxesStore</a></li><li><a href="module-mergerWindowLauncher.html">mergerWindowLauncher</a></li><li><a href="module-seriesMapper.html">seriesMapper</a></li><li><a href="module-services_computedChannels.html">services/computedChannels</a></li><li><a href="module-services_computedChannels_dataPreparation.html">services/computedChannels/dataPreparation</a></li><li><a href="module-services_computedChannels_eventHandling.html">services/computedChannels/eventHandling</a></li><li><a href="module-services_computedChannels_expressionConversion.html">services/computedChannels/expressionConversion</a></li><li><a href="module-services_computedChannels_resultProcessing.html">services/computedChannels/resultProcessing</a></li><li><a href="module-services_computedChannels_stateUpdate.html">services/computedChannels/stateUpdate</a></li><li><a href="module-services_computedChannels_validators.html">services/computedChannels/validators</a></li><li><a href="module-services_computedChannels_workerManagement.html">services/computedChannels/workerManagement</a></li><li><a href="module-setupChartDragAndDrop.html">setupChartDragAndDrop</a></li><li><a href="module-timeInterpolation.html">timeInterpolation</a></li><li><a href="module-utils_autoGroupChannels.html">utils/autoGroupChannels</a></li><li><a href="module-utils_computedChannelMetadata.html">utils/computedChannelMetadata</a></li><li><a href="module-verticalLineControl.html">verticalLineControl</a></li><li><a href="module-workers_computedChannelWorker.html">workers/computedChannelWorker</a></li></ul><h3>Classes</h3><ul><li><a href="PolarChart.html">PolarChart</a></li><li><a href="PolarChartCanvas.html">PolarChartCanvas</a></li><li><a href="SidebarStore.html">SidebarStore</a></li><li><a href="module-utils_computedChannelMetadata-ComputedChannelMetadata.html">ComputedChannelMetadata</a></li></ul><h3>Global</h3><ul><li><a href="global.html#IMPLEMENTATION_COMPLETE">IMPLEMENTATION_COMPLETE</a></li><li><a href="global.html#QUICK_REFERENCE">QUICK_REFERENCE</a></li><li><a href="global.html#STORAGE_CFG_KEY">STORAGE_CFG_KEY</a></li><li><a href="global.html#adjustMainContent">adjustMainContent</a></li><li><a href="global.html#appendComputedChannelToStorage">appendComputedChannelToStorage</a></li><li><a href="global.html#attachChartContainer">attachChartContainer</a></li><li><a href="global.html#attachChartEventHandlers">attachChartEventHandlers</a></li><li><a href="global.html#attachChartPlugins">attachChartPlugins</a></li><li><a href="global.html#attachComputedChartContainer">attachComputedChartContainer</a></li><li><a href="global.html#attachComputedChartEventHandlers">attachComputedChartEventHandlers</a></li><li><a href="global.html#attachComputedChartPlugins">attachComputedChartPlugins</a></li><li><a href="global.html#axisLinesPlugin">axisLinesPlugin</a></li><li><a href="global.html#broadcastComputedChannelChange">broadcastComputedChannelChange</a></li><li><a href="global.html#buildChartData">buildChartData</a></li><li><a href="global.html#buildChartOptions">buildChartOptions</a></li><li><a href="global.html#buildComputedChannelLabels">buildComputedChannelLabels</a></li><li><a href="global.html#buildComputedChartOptions">buildComputedChartOptions</a></li><li><a href="global.html#buildGroupsWithAutoGrouping">buildGroupsWithAutoGrouping</a></li><li><a href="global.html#buildGroupsWithUserAssignments">buildGroupsWithUserAssignments</a></li><li><a href="global.html#buildTableBody">buildTableBody</a></li><li><a href="global.html#buildTableHTML">buildTableHTML</a></li><li><a href="global.html#buildTableHeader">buildTableHeader</a></li><li><a href="global.html#buildUnitChartData">buildUnitChartData</a></li><li><a href="global.html#calculateStats">calculateStats</a></li><li><a href="global.html#chart2">chart2</a></li><li><a href="global.html#cleanupOldComputedCharts">cleanupOldComputedCharts</a></li><li><a href="global.html#clearChartsContainer">clearChartsContainer</a></li><li><a href="global.html#clearComputedChannelsFromStorage">clearComputedChannelsFromStorage</a></li><li><a href="global.html#clearExpressionCache">clearExpressionCache</a></li><li><a href="global.html#closeAnalysisDrawer">closeAnalysisDrawer</a></li><li><a href="global.html#collectChartDeltas">collectChartDeltas</a></li><li><a href="global.html#computeChartDataDimensions">computeChartDataDimensions</a></li><li><a href="global.html#convertLatexToMathJs">convertLatexToMathJs</a></li><li><a href="global.html#convertLatexToPlainText">convertLatexToPlainText</a></li><li><a href="global.html#createAnalogChannelGroupMap">createAnalogChannelGroupMap</a></li><li><a href="global.html#createBinaryBlob">createBinaryBlob</a></li><li><a href="global.html#createChannelItem">createChannelItem</a></li><li><a href="global.html#createChannelList">createChannelList</a></li><li><a href="global.html#createChartContainer">createChartContainer</a></li><li><a href="global.html#createChartMetadata">createChartMetadata</a></li><li><a href="global.html#createChartOptions">createChartOptions</a></li><li><a href="global.html#createComputedChannelsSidebar">createComputedChannelsSidebar</a></li><li><a href="global.html#createComputedChartMetadata">createComputedChartMetadata</a></li><li><a href="global.html#createComputedClickHandler">createComputedClickHandler</a></li><li><a href="global.html#createComputedMousemoveHandler">createComputedMousemoveHandler</a></li><li><a href="global.html#createDeltaTableRenderer">createDeltaTableRenderer</a></li><li><a href="global.html#createDigitalFillPlugin">createDigitalFillPlugin</a></li><li><a href="global.html#createGroupDragBar">createGroupDragBar</a></li><li><a href="global.html#createMousemoveHandler">createMousemoveHandler</a></li><li><a href="global.html#createProgressBar">createProgressBar</a></li><li><a href="global.html#createScopeTemplate">createScopeTemplate</a></li><li><a href="global.html#createSidebarResizer">createSidebarResizer</a></li><li><a href="global.html#createSimpleChannelList">createSimpleChannelList</a></li><li><a href="global.html#createSimpleContainer">createSimpleContainer</a></li><li><a href="global.html#createState">createState</a></li><li><a href="global.html#createTooltip">createTooltip</a></li><li><a href="global.html#createVerticalLineClickHandler">createVerticalLineClickHandler</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#detectGroupFromExpression">detectGroupFromExpression</a></li><li><a href="global.html#encodeFloat64">encodeFloat64</a></li><li><a href="global.html#encodeInt32">encodeInt32</a></li><li><a href="global.html#evaluateAndSaveComputedChannel">evaluateAndSaveComputedChannel</a></li><li><a href="global.html#evaluateExpression">evaluateExpression</a></li><li><a href="global.html#exportAllChannelsAsCSV">exportAllChannelsAsCSV</a></li><li><a href="global.html#exportAllComputedChannels">exportAllComputedChannels</a></li><li><a href="global.html#exportComputedChannelAsASCII">exportComputedChannelAsASCII</a></li><li><a href="global.html#exportComputedChannelAsCFGDAT">exportComputedChannelAsCFGDAT</a></li><li><a href="global.html#exportComputedChannelsAsCSV">exportComputedChannelsAsCSV</a></li><li><a href="global.html#extractChannelMetadata">extractChannelMetadata</a></li><li><a href="global.html#extractChannelNameFromEquation">extractChannelNameFromEquation</a></li><li><a href="global.html#extractGroupId">extractGroupId</a></li><li><a href="global.html#extractMathExpression">extractMathExpression</a></li><li><a href="global.html#filterGroupsWithChannels">filterGroupsWithChannels</a></li><li><a href="global.html#filterIndicesWithData">filterIndicesWithData</a></li><li><a href="global.html#filterTableRows">filterTableRows</a></li><li><a href="global.html#filterUnassignedComputedChannels">filterUnassignedComputedChannels</a></li><li><a href="global.html#filterValidIndices">filterValidIndices</a></li><li><a href="global.html#formatEquationForLatex">formatEquationForLatex</a></li><li><a href="global.html#formatScaledValue">formatScaledValue</a></li><li><a href="global.html#formatTableData">formatTableData</a></li><li><a href="global.html#generateCFGContent">generateCFGContent</a></li><li><a href="global.html#generateCFGContentBatch">generateCFGContentBatch</a></li><li><a href="global.html#generateCFGContentBinary32">generateCFGContentBinary32</a></li><li><a href="global.html#generateCFGContentBinary64">generateCFGContentBinary64</a></li><li><a href="global.html#generateCFGContentFloat32">generateCFGContentFloat32</a></li><li><a href="global.html#generateCFGContentFloat64">generateCFGContentFloat64</a></li><li><a href="global.html#generateDATContent">generateDATContent</a></li><li><a href="global.html#generateDATContentBatch">generateDATContentBatch</a></li><li><a href="global.html#generateDATContentBinary32">generateDATContentBinary32</a></li><li><a href="global.html#generateDATContentBinary64">generateDATContentBinary64</a></li><li><a href="global.html#generateDATContentFloat32">generateDATContentFloat32</a></li><li><a href="global.html#generateDATContentFloat64">generateDATContentFloat64</a></li><li><a href="global.html#generateUniqueComputedGroup">generateUniqueComputedGroup</a></li><li><a href="global.html#getAllAvailableGroups">getAllAvailableGroups</a></li><li><a href="global.html#getCacheStats">getCacheStats</a></li><li><a href="global.html#getChannelByDisplayName">getChannelByDisplayName</a></li><li><a href="global.html#getChannelMetadata">getChannelMetadata</a></li><li><a href="global.html#getChannelsForFile">getChannelsForFile</a></li><li><a href="global.html#getColorHex">getColorHex</a></li><li><a href="global.html#getCompiledExpression">getCompiledExpression</a></li><li><a href="global.html#getComputedChannelById">getComputedChannelById</a></li><li><a href="global.html#getComputedChannelStorageMetadata">getComputedChannelStorageMetadata</a></li><li><a href="global.html#getComputedChannelsState">getComputedChannelsState</a></li><li><a href="global.html#getElementWidth">getElementWidth</a></li><li><a href="global.html#getFileIndexForTime">getFileIndexForTime</a></li><li><a href="global.html#getOriginalChannelName">getOriginalChannelName</a></li><li><a href="global.html#getSampleIndexInFile">getSampleIndexInFile</a></li><li><a href="global.html#groupChannelsByUnit">groupChannelsByUnit</a></li><li><a href="global.html#handleComputedVerticalLineAddition">handleComputedVerticalLineAddition</a></li><li><a href="global.html#handleVerticalLineAddition">handleVerticalLineAddition</a></li><li><a href="global.html#hasDigitalData">hasDigitalData</a></li><li><a href="global.html#hasStoredComputedChannels">hasStoredComputedChannels</a></li><li><a href="global.html#hideProgress">hideProgress</a></li><li><a href="global.html#hideTooltip">hideTooltip</a></li><li><a href="global.html#importComputedChannelFromJSON">importComputedChannelFromJSON</a></li><li><a href="global.html#initComputedChannelsState">initComputedChannelsState</a></li><li><a href="global.html#initUPlotChart">initUPlotChart</a></li><li><a href="global.html#initializeChartInstance">initializeChartInstance</a></li><li><a href="global.html#initializeComputedChartInstance">initializeComputedChartInstance</a></li><li><a href="global.html#initializeSidebarChannels">initializeSidebarChannels</a></li><li><a href="global.html#injectSidebarIntoUplot">injectSidebarIntoUplot</a></li><li><a href="global.html#isMathJaxLoaded">isMathJaxLoaded</a></li><li><a href="global.html#listenForComputedChannelChanges">listenForComputedChannelChanges</a></li><li><a href="global.html#loadComputedChannelsForGroup">loadComputedChannelsForGroup</a></li><li><a href="global.html#loadComputedChannelsFromStorage">loadComputedChannelsFromStorage</a></li><li><a href="global.html#loadMathJax">loadMathJax</a></li><li><a href="global.html#mathJaxPromise">mathJaxPromise</a></li><li><a href="global.html#measurePerformance">measurePerformance</a></li><li><a href="global.html#mergeAnalogAndComputedMetadata">mergeAnalogAndComputedMetadata</a></li><li><a href="global.html#mergeAnalogChannels">mergeAnalogChannels</a></li><li><a href="global.html#mergeComtradeFilesSetsSequential">mergeComtradeFilesSetsSequential</a></li><li><a href="global.html#mergeDigitalChannels">mergeDigitalChannels</a></li><li><a href="global.html#mergeTimeArraysSequential">mergeTimeArraysSequential</a></li><li><a href="global.html#openAnalysisDrawer">openAnalysisDrawer</a></li><li><a href="global.html#openBothSidebars">openBothSidebars</a></li><li><a href="global.html#openDeltaWindow">openDeltaWindow</a></li><li><a href="global.html#openMathLiveEditor">openMathLiveEditor</a></li><li><a href="global.html#openPhasorDiagram">openPhasorDiagram</a></li><li><a href="global.html#performExport">performExport</a></li><li><a href="global.html#prepareChartDataContext">prepareChartDataContext</a></li><li><a href="global.html#processEquationInput">processEquationInput</a></li><li><a href="global.html#readFileAsText">readFileAsText</a></li><li><a href="global.html#renameChannelWithPrefix">renameChannelWithPrefix</a></li><li><a href="global.html#renderChannelLabelContainer">renderChannelLabelContainer</a></li><li><a href="global.html#renderComputedChannels">renderComputedChannels</a></li><li><a href="global.html#renderLatex">renderLatex</a></li><li><a href="global.html#resizeChartsToContainers">resizeChartsToContainers</a></li><li><a href="global.html#resolveGroupIndices">resolveGroupIndices</a></li><li><a href="global.html#resolveTimeArray">resolveTimeArray</a></li><li><a href="global.html#saveComputedChannelsToStorage">saveComputedChannelsToStorage</a></li><li><a href="global.html#setupMobileSidebar">setupMobileSidebar</a></li><li><a href="global.html#showChannelListWindow">showChannelListWindow</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showExportFormatDialog">showExportFormatDialog</a></li><li><a href="global.html#showFileInfo">showFileInfo</a></li><li><a href="global.html#showProgress">showProgress</a></li><li><a href="global.html#subscribeChartUpdates">subscribeChartUpdates</a></li><li><a href="global.html#syncComputedChannelsWithParent">syncComputedChannelsWithParent</a></li><li><a href="global.html#themeContext">themeContext</a></li><li><a href="global.html#toggleChartsVisibility">toggleChartsVisibility</a></li><li><a href="global.html#updateComputedChannelGroupInStorage">updateComputedChannelGroupInStorage</a></li><li><a href="global.html#updateComputedChannelsSidebar">updateComputedChannelsSidebar</a></li><li><a href="global.html#updateFileInfo">updateFileInfo</a></li><li><a href="global.html#updateProgress">updateProgress</a></li><li><a href="global.html#updateStatsCards">updateStatsCards</a></li><li><a href="global.html#updateTooltip">updateTooltip</a></li><li><a href="global.html#validateChannelName">validateChannelName</a></li><li><a href="global.html#validateGroupIndices">validateGroupIndices</a></li><li><a href="global.html#wrapChartInSection">wrapChartInSection</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>components/renderSingleDigitalChart.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file renderSingleDigitalChart.js
 * @module components/renderSingleDigitalChart
 * 
 * @description
 * &lt;h3>Single Digital Chart Renderer&lt;/h3>
 * 
 * &lt;p>Visualizes binary/boolean signals from protection relays and power quality meters.
 * Renders a SINGLE uPlot instance for one digital channel group.&lt;/p>
 * 
 * &lt;h4>Design Philosophy&lt;/h4>
 * &lt;table>
 *   &lt;tr>&lt;th>Principle&lt;/th>&lt;th>Description&lt;/th>&lt;/tr>
 *   &lt;tr>&lt;td>Single Responsibility&lt;/td>&lt;td>One function â†’ one chart&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>DRY&lt;/td>&lt;td>Uses shared utilities to avoid duplication&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Stacked Display&lt;/td>&lt;td>Color-coded HIGH/LOW states&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Consistency&lt;/td>&lt;td>Same interface as &lt;code>renderSingleAnalogChart&lt;/code>&lt;/td>&lt;/tr>
 * &lt;/table>
 * 
 * &lt;h4>Key Features&lt;/h4>
 * &lt;ul>
 *   &lt;li>&lt;strong>Group-based rendering&lt;/strong> â€” Channels grouped by user or auto-grouping&lt;/li>
 *   &lt;li>&lt;strong>Stacked display&lt;/strong> â€” Configurable &lt;code>DigChannelOffset&lt;/code> between channels&lt;/li>
 *   &lt;li>&lt;strong>Color-coded fill&lt;/strong> â€” HIGH states shown as filled rectangles&lt;/li>
 *   &lt;li>&lt;strong>Auto filtering&lt;/strong> â€” Channels with no HIGH values are hidden&lt;/li>
 *   &lt;li>&lt;strong>Computed support&lt;/strong> â€” Can render computed digital channels&lt;/li>
 *   &lt;li>&lt;strong>Responsive&lt;/strong> â€” ResizeObserver auto-adjusts&lt;/li>
 * &lt;/ul>
 * 
 * &lt;h4>Operating Modes&lt;/h4>
 * &lt;table>
 *   &lt;tr>&lt;th>Mode&lt;/th>&lt;th>channelIndices&lt;/th>&lt;th>computedChannels&lt;/th>&lt;th>Result&lt;/th>&lt;/tr>
 *   &lt;tr>&lt;td>COMTRADE&lt;/td>&lt;td>&lt;code>[0,1,2]&lt;/code>&lt;/td>&lt;td>&lt;code>[]&lt;/code>&lt;/td>&lt;td>Renders COMTRADE channels&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Computed-only&lt;/td>&lt;td>&lt;code>[]&lt;/code>&lt;/td>&lt;td>&lt;code>[...]&lt;/code>&lt;/td>&lt;td>Renders only computed&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Mixed&lt;/td>&lt;td>&lt;code>[0,1,2]&lt;/code>&lt;/td>&lt;td>&lt;code>[...]&lt;/code>&lt;/td>&lt;td>Both in same chart&lt;/td>&lt;/tr>
 * &lt;/table>
 * 
 * &lt;h4>Digital Signal Display&lt;/h4>
 * &lt;ul>
 *   &lt;li>&lt;strong>HIGH (1)&lt;/strong> â€” Filled rectangles&lt;/li>
 *   &lt;li>&lt;strong>LOW (0)&lt;/strong> â€” Baseline&lt;/li>
 *   &lt;li>&lt;strong>Stacked&lt;/strong> â€” Vertical offset between channels&lt;/li>
 * &lt;/ul>
 * 
 * @see {@link module:components/renderSingleAnalogChart} - Analog equivalent
 * @see {@link module:components/renderComtradeCharts} - Orchestrator
 * @see {@link module:plugins/digitalFillPlugin} - Fill plugin
 * 
 * @example
 * import { renderSingleDigitalChart } from "./renderSingleDigitalChart.js";
 * 
 * renderSingleDigitalChart(
 *   "G0",              // Group ID
 *   [0, 1, 2, 3],      // Channel indices (TRIP, CLOSE, 52A, 52B)
 *   1,                 // Chart index
 *   cfg, data,         // COMTRADE data
 *   chartsContainer,   // DOM container
 *   charts,            // Charts array
 *   verticalLinesX,    // Vertical lines state
 *   { channelState }   // Options
 * );
 * 
 * @mermaid
 * graph TD
 *     A[Input: groupId, channelIndices, cfg, data] --> B[Validate Inputs]
 *     B --> C{Has HIGH values?}
 *     C -->|No| D[Return null]
 *     C -->|Yes| E[Build channel metadata]
 *     E --> F[createDragBar]
 *     F --> G[createChartContainer]
 *     G --> H[Build chartData with 0/1 values]
 *     H --> I[createDigitalFillPlugin]
 *     I --> J[createChartOptions]
 *     J --> K[initUPlotChart]
 *     K --> L[Attach Metadata]
 *     L --> M[attachChartEventHandlers]
 *     M --> N[Return chart instance]
 */

import { createDragBar } from "./createDragBar.js";
import { createChartOptions } from "./chartComponent.js";
import { addChart } from "../utils/chartMetadataStore.js";
import { createChartContainer, initUPlotChart } from "../utils/chartDomUtils.js";
import verticalLinePlugin from "../plugins/verticalLinePlugin.js";
import { createDigitalFillPlugin } from "../plugins/digitalFillPlugin.js";
import { attachChartEventHandlers } from "../utils/chartInteractions.js";
import { getMaxYAxes } from "../utils/maxYAxesStore.js";
import { resolveTimeArray } from "../utils/computedChannelDataProcessor.js";

/**
 * Digital channel offset for stacked display.
 * Each digital channel is offset by this amount on the Y-axis.
 * @constant {number}
 * @default 2
 */
const DigChannelOffset = 2;

/**
 * Check if a digital channel has any HIGH (true/1) values.
 * Digital signals that are always LOW (0/false) are typically not useful to display.
 * 
 * @function hasDigitalData
 * @private
 * @param {Array&lt;boolean|number>} channelData - Boolean or numeric array for one channel
 * @returns {boolean} True if channel has at least one HIGH value
 * 
 * @example
 * hasDigitalData([0, 0, 1, 0, 0]);  // true - has HIGH
 * hasDigitalData([false, false]);    // false - all LOW
 * hasDigitalData([true, false]);     // true - has HIGH
 */
function hasDigitalData(channelData) {
  if (!Array.isArray(channelData)) return false;
  return channelData.some(v => v === true || v === 1);
}

/**
 * Filter channel indices to only those with actual HIGH values.
 * Removes channels that are always LOW from the display.
 * 
 * @function filterIndicesWithData
 * @private
 * @param {number[]} indices - Channel indices to filter
 * @param {Array&lt;Array&lt;boolean|number>>} digitalData - Digital data arrays
 * @returns {number[]} Filtered indices with valid data (at least one HIGH)
 * 
 * @example
 * const digitalData = [
 *   [0, 0, 0],  // Channel 0: always LOW
 *   [0, 1, 0],  // Channel 1: has HIGH
 *   [1, 1, 1],  // Channel 2: always HIGH
 * ];
 * filterIndicesWithData([0, 1, 2], digitalData);  // [1, 2]
 */
function filterIndicesWithData(indices, digitalData) {
  return indices.filter(idx => {
    if (idx &lt; 0 || idx >= digitalData.length) return false;
    return hasDigitalData(digitalData[idx]);
  });
}

/**
 * Digital channel state object structure
 * 
 * @typedef {Object} DigitalChannelState
 * @property {string[]} yLabels - Array of channel labels indexed by channel position
 * @property {string[]} lineColors - Array of hex color codes indexed by channel position
 * @property {string[]} groups - Array of group IDs per channel (e.g., ["G0", "G0", "G1"])
 * 
 * @example
 * const channelState = {
 *   digital: {
 *     yLabels: ["TRIP", "CLOSE", "52A", "52B"],
 *     lineColors: ["#f97316", "#06b6d4", "#a855f7", "#10b981"],
 *     groups: ["G0", "G0", "G0", "G0"]
 *   }
 * };
 */

/**
 * Options object for renderSingleDigitalChart
 * 
 * @typedef {Object} RenderDigitalOptions
 * @property {Object} channelState - Channel state with digital sub-object
 * @property {DigitalChannelState} channelState.digital - Digital channel configuration
 * @property {ComputedDigitalChannel[]} [computedChannels=[]] - Computed digital channels for this group
 * 
 * @example
 * const options = {
 *   channelState: {
 *     digital: { yLabels: [...], lineColors: [...], groups: [...] }
 *   },
 *   computedChannels: [
 *     { id: "fault_detect", name: "Fault Detect", color: "#FF6B6B", data: [0,0,1,1,0] }
 *   ]
 * };
 */

/**
 * Computed digital channel object structure
 * 
 * @typedef {Object} ComputedDigitalChannel
 * @property {string} id - Unique identifier (e.g., "computed_fault")
 * @property {string} name - Display name (e.g., "Fault Detection")
 * @property {string} color - Hex color code (e.g., "#FF6B6B")
 * @property {string} group - Parent group ID (e.g., "DigitalComputed")
 * @property {string} [unit] - Unit string (optional for digital)
 * @property {number[]} data - Calculated data array (boolean-like: 0/1 or true/false)
 */

/**
 * Digital fill signal configuration for the digitalFillPlugin
 * 
 * @typedef {Object} DigitalFillSignal
 * @property {number} signalIndex - Series index in uPlot (1-based, 0 is time)
 * @property {number} offset - Y-axis offset for stacking
 * @property {string} color - Fill color for HIGH states
 * @property {number} targetVal - Value to fill (always 1 for digital)
 * @property {number} originalIndex - Original channel index in cfg.digitalChannels
 */

/**
 * Render a SINGLE uPlot instance for one digital channel group.
 * 
 * This function creates a complete digital chart with:
 * - Multiple digital channels from the same group stacked vertically
 * - Color-coded fill for HIGH states
 * - Drag bar for chart reordering
 * - Click handler for vertical line markers
 * - Automatic filtering of always-LOW channels
 * - Responsive resize handling
 * 
 * **Display Format:**
 * ```
 * Channel 2: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  (HIGH/LOW pattern)
 * Channel 1: â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆ
 * Channel 0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
 *            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Time
 * ```
 * 
 * **Data Transformation:**
 * - Input: Boolean or numeric arrays from COMTRADE
 * - Output: Normalized 0/1 values for consistent display
 * - Channels with no HIGH values are filtered out
 * 
 * @function renderSingleDigitalChart
 * @memberof module:components/renderSingleDigitalChart
 * @since 1.0.0
 * 
 * @param {string} groupId - Group identifier (e.g., "G0", "G1", "Protection")
 *   Used for chart title and metadata
 * 
 * @param {number[]} channelIndices - Array of channel indices belonging to this group
 *   These indices map to `cfg.digitalChannels[idx]` and `data.digitalData[idx]`
 *   Example: [0, 1, 2, 3] for channels TRIP, CLOSE, 52A, 52B
 * 
 * @param {number} chartIndex - Chart position/number (0-based)
 *   Used for ordering and dataset attributes
 * 
 * @param {Object} cfg - COMTRADE configuration object from parseCFG()
 * @param {Object[]} cfg.digitalChannels - Array of digital channel definitions
 * @param {string} cfg.digitalChannels[].id - Channel identifier (e.g., "TRIP")
 * @param {boolean} cfg.digitalChannels[].normalState - Normal state (0 or 1)
 * 
 * @param {Object} data - Parsed COMTRADE data object from parseDAT()
 * @param {Array&lt;Array&lt;boolean|number>>} data.digitalData - 2D array of digital channel data
 *   `data.digitalData[channelIndex][sampleIndex]` = true/false or 1/0
 * 
 * @param {HTMLElement} chartsContainer - DOM container to append chart to
 * 
 * @param {uPlot[]} charts - Array to push new chart instance into
 *   Shared across all charts for synchronized cursor/zoom
 * 
 * @param {Object} verticalLinesX - Reactive array for vertical line positions
 * 
 * @param {RenderDigitalOptions} [options={}] - Additional options
 * 
 * @returns {uPlot|null} The created uPlot instance, or null if:
 *   - No valid channel indices provided
 *   - Missing digitalData
 *   - All channels have no HIGH values
 *   - uPlot creation failed
 * 
 * @throws {Error} Does not throw - returns null on failure with console warnings
 * 
 * @example
 * // Example 1: Basic digital chart with protection signals
 * const chart = renderSingleDigitalChart(
 *   "G0",                              // Group ID
 *   [0, 1, 2, 3],                       // Indices for TRIP, CLOSE, 52A, 52B
 *   1,                                  // Second chart
 *   cfg,                                // From parseCFG()
 *   data,                               // From parseDAT()
 *   document.getElementById("charts"), // Container
 *   charts,                             // Charts array
 *   verticalLinesX,                     // Vertical lines state
 *   {
 *     channelState: {
 *       digital: {
 *         yLabels: ["TRIP", "CLOSE", "52A", "52B"],
 *         lineColors: ["#f97316", "#06b6d4", "#a855f7", "#10b981"]
 *       }
 *     }
 *   }
 * );
 * 
 * @example
 * // Example 2: Accessing chart metadata after creation
 * const chart = renderSingleDigitalChart(...);
 * 
 * if (chart) {
 *   console.log("Group:", chart._userGroupId);      // "G0"
 *   console.log("Type:", chart._chartType);         // "digital"
 *   console.log("Channels:", chart._channelIndices); // [0, 1, 2, 3]
 *   console.log("Plugin:", chart._digitalPlugin);   // digitalFillPlugin instance
 * }
 * 
 * @mermaid
 * sequenceDiagram
 *     Caller->>Func: groupId, indices, cfg, data
 *     Func->>Func: filterIndicesWithData
 *     Func->>DragBar: createDragBar
 *     DragBar-->>Func: dragBar element
 *     Func->>Container: createChartContainer
 *     Container-->>Func: parentDiv, chartDiv
 *     Func->>Func: Build digitalFillSignals
 *     Func->>Plugin: createDigitalFillPlugin
 *     Plugin-->>Func: digitalPlugin
 *     Func->>Options: createChartOptions
 *     Options-->>Func: opts
 *     Func->>uPlot: initUPlotChart
 *     uPlot-->>Func: chart
 *     Func->>Events: attachChartEventHandlers
 *     Func-->>Caller: return chart
 * 
 * @see {@link module:components/renderSingleAnalogChart} - Analog chart equivalent
 * @see {@link module:plugins/digitalFillPlugin} - Plugin for digital visualization
 * @see {@link module:components/renderComtradeCharts} - Caller/orchestrator
 */
export function renderSingleDigitalChart(
  groupId,
  channelIndices,
  chartIndex,
  cfg,
  data,
  chartsContainer,
  charts,
  verticalLinesX,
  options = {}
) {
  const { channelState, computedChannels = [] } = options;
  const renderStartTime = performance.now();

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DETERMINE MODE: COMTRADE mode (has indices) vs Computed-only mode (empty indices)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const hasComtradeChannels = channelIndices?.length > 0;
  const hasComputedChannels = computedChannels?.length > 0;

  console.log(`[renderSingleDigitalChart] ğŸ“Š Creating digital chart #${chartIndex} for group "${groupId}" - Mode: ${hasComtradeChannels ? 'COMTRADE' : 'Computed-only'} (${channelIndices?.length || 0} COMTRADE + ${computedChannels.length} computed)`);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // VALIDATE INPUTS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Need at least COMTRADE channels OR computed channels
  if (!hasComtradeChannels &amp;&amp; !hasComputedChannels) {
    console.warn(`[renderSingleDigitalChart] âš ï¸ No channels for "${groupId}"`);
    return null;
  }

  // For COMTRADE mode, need digitalData
  if (hasComtradeChannels &amp;&amp; !data?.digitalData?.length) {
    console.warn(`[renderSingleDigitalChart] âš ï¸ Missing digitalData for COMTRADE mode`);
    return null;
  }

  // Filter to valid COMTRADE indices that have HIGH values
  const validIndices = hasComtradeChannels
    ? filterIndicesWithData(channelIndices, data.digitalData)
    : [];

  // Filter computed channels with valid data
  const computedWithData = computedChannels.filter(ch => ch.data?.length > 0);

  if (validIndices.length === 0 &amp;&amp; computedWithData.length === 0) {
    console.log(`[renderSingleDigitalChart] â­ï¸ Skipping group "${groupId}" - no channels with data`);
    return null;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BUILD CHANNEL INFO FROM CFG + COMPUTED
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const digitalChannels = cfg?.digitalChannels || [];
  const digital = channelState?.digital || {};
  
  // Build COMTRADE channels to display with their metadata
  const digitalChannelsToShow = validIndices.map(idx => {
    const ch = digitalChannels[idx] || { id: `D${idx}` };
    return {
      ...ch,
      originalIndex: idx,
      isComputed: false,
    };
  });

  // Add computed channels to display list
  const computedChannelsToShow = computedWithData.map(ch => ({
    id: ch.id,
    name: ch.name || ch.id,
    color: ch.color,
    originalIndex: -1,  // Not from COMTRADE
    isComputed: true,
    computedData: ch.data,
    unit: ch.unit || "",
  }));

  // Combine COMTRADE + computed channels
  const allChannelsToShow = [...digitalChannelsToShow, ...computedChannelsToShow];

  if (allChannelsToShow.length === 0) {
    console.log(`[renderSingleDigitalChart] â­ï¸ Skipping group "${groupId}" - no channels to display`);
    return null;
  }

  // Build labels and colors (COMTRADE + computed)
  const digitalYLabels = allChannelsToShow.map((ch, i) => {
    if (ch.isComputed) {
      return ch.name || ch.id;
    }
    // Prefer label from channelState if available
    if (Array.isArray(digital.yLabels) &amp;&amp; digital.yLabels[ch.originalIndex]) {
      return digital.yLabels[ch.originalIndex];
    }
    return ch.id || `D${ch.originalIndex}`;
  });

  const displayedColors = allChannelsToShow.map((ch, i) => {
    if (ch.isComputed) {
      return ch.color || "#4ECDC4";
    }
    if (Array.isArray(digital.lineColors) &amp;&amp; digital.lineColors[ch.originalIndex]) {
      return digital.lineColors[ch.originalIndex];
    }
    // Default digital colors (from original)
    const defaultColors = ["#f97316", "#06b6d4", "#a855f7", "#10b981", "#ef4444", "#eab308"];
    return defaultColors[i % defaultColors.length];
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CREATE CHART METADATA
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const dragBar = createDragBar({ indices: validIndices, name: groupId }, cfg, channelState);

  // Build channel IDs (COMTRADE + computed)
  const channelIds = allChannelsToShow.map((ch, idx) => {
    if (ch.isComputed) {
      return `computed-${ch.id}`;
    }
    return ch.originalIndex !== undefined ? `digital-${ch.originalIndex}` : `digital-${idx}`;
  });

  const metadata = addChart({
    userGroupId: groupId,
    type: "digital",
    yLabels: digitalYLabels.slice(),
    channelIds: channelIds,
    colors: displayedColors.slice(),
    indices: validIndices.slice(),
    computedChannelIds: computedWithData.map(ch => ch.id),
    sourceGroupId: groupId,
  });

  console.log(`[renderSingleDigitalChart] Creating ${metadata.userGroupId} â†’ ${metadata.uPlotInstance}`);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CREATE CHART CONTAINER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const { parentDiv, chartDiv } = createChartContainer(
    dragBar,
    "chart-container",
    digitalYLabels,
    displayedColors,
    "Digital Channels",
    metadata.userGroupId,
    "digital"
  );
  parentDiv.dataset.userGroupId = metadata.userGroupId;
  parentDiv.dataset.uPlotInstance = metadata.uPlotInstance;
  parentDiv.dataset.chartType = "digital";
  chartsContainer.appendChild(parentDiv);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BUILD CHART DATA (COMTRADE + computed)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Get COMTRADE digital data (converted to 0/1)
  const digitalDataToShow = validIndices.map(idx => data.digitalData[idx]);
  const digitalDataZeroOne = digitalDataToShow.map(arr => arr.map(v => (v ? 1 : 0)));

  // Get computed digital data (converted to 0/1)
  const computedDataZeroOne = computedChannelsToShow.map(ch => 
    ch.computedData.map(v => (v ? 1 : 0))
  );

  // Combine all data series
  const allDataSeries = [...digitalDataZeroOne, ...computedDataZeroOne];

  // Derive sample count from all series
  const allLengths = allDataSeries
    .filter(arr => Array.isArray(arr) &amp;&amp; arr.length > 0)
    .map(arr => arr.length);
  const sampleCount = allLengths.length ? Math.min(...allLengths) : 0;

  if (!sampleCount) {
    console.log(`[renderSingleDigitalChart] â­ï¸ Skipping group "${groupId}" - no valid sample count`);
    return null;
  }

  // Resolve time array using centralized utility (handles multiple fallback sources)
  let timeArray = resolveTimeArray(data, computedChannelsToShow.map(ch => ({ data: ch.computedData })));
  
  // Trim to sample count
  if (timeArray?.length > sampleCount) {
    timeArray = timeArray.slice(0, sampleCount);
  }
  
  if (!timeArray?.length) {
    console.log(`[renderSingleDigitalChart] â­ï¸ Skipping group "${groupId}" - no time data`);
    return null;
  }
  
  // Trim all data series to sample count
  const trimmedDigital = allDataSeries.map((arr, idx) => {
    if (!Array.isArray(arr)) {
      console.warn(`[renderSingleDigitalChart] âš ï¸ Digital channel at idx=${idx} missing data`);
      return [];
    }
    return arr.slice(0, sampleCount);
  });

  const hasAnyDigital = trimmedDigital.some(arr => Array.isArray(arr) &amp;&amp; arr.length > 0);
  if (!hasAnyDigital) {
    console.log(`[renderSingleDigitalChart] â­ï¸ Skipping group "${groupId}" - no data available`);
    return null;
  }

  const chartData = [timeArray, ...trimmedDigital];

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CREATE DIGITAL FILL PLUGIN SIGNALS (COMTRADE + computed)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const digitalFillSignals = allChannelsToShow.map((ch, i) => ({
    signalIndex: i + 1,
    offset: (allChannelsToShow.length - 1 - i) * DigChannelOffset,
    color: displayedColors[i],
    targetVal: 1,
    originalIndex: ch.isComputed ? -1 : ch.originalIndex,
    isComputed: ch.isComputed,
    computedId: ch.isComputed ? ch.id : null,
  }));

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONFIGURE CHART OPTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const yMin = -0.5;
  const yMax = (allChannelsToShow.length - 1) * DigChannelOffset + 2;
  const scales = {
    x: { time: false, auto: true },
    y: { min: yMin, max: yMax, auto: false },
  };

  const maxYAxes = getMaxYAxes() || 1;

  const opts = createChartOptions({
    title: "Digital Channels",
    yLabels: digitalYLabels,
    lineColors: displayedColors,
    verticalLinesX: verticalLinesX,
    xLabel: "Time",
    xUnit: "s",
    getCharts: () => charts,
    yUnits: [],
    axesScales: [],
    scales,
    singleYAxis: true,
    autoScaleUnit: { x: true, y: false },
    maxYAxes: maxYAxes,
  });

  // Configure digital Y-axis with custom formatting
  const firstAxis = {
    ...opts.axes[1],
    scale: "y",
    side: 3,
    show: true,
    size: 60,
    stroke: "#d1d5db",
    label: "Digital States",
    grid: { show: true },
    ticks: { show: true, size: 10 },
    gap: 5,
    values: (u, vals) =>
      vals.map(v => {
        for (let i = 0; i &lt; allChannelsToShow.length; ++i) {
          if (Math.abs(v - i * DigChannelOffset) &lt; 0.5) return "0";
          if (Math.abs(v - (i * DigChannelOffset + 1)) &lt; 0.5) return "1";
        }
        return "";
      }),
    splits: allChannelsToShow.flatMap((_, i) => [
      i * DigChannelOffset,
      i * DigChannelOffset + 1,
    ]),
  };

  opts.axes = [opts.axes[0], firstAxis, ...opts.axes.slice(2)];

  // Configure series (COMTRADE + computed)
  opts.series = [
    {},
    ...allChannelsToShow.map((ch, i) => {
      let label;
      if (ch.isComputed) {
        label = ch.name || ch.id;
      } else {
        label = ch.id;
        if (Array.isArray(digital.yLabels) &amp;&amp; digital.yLabels[ch.originalIndex]) {
          label = digital.yLabels[ch.originalIndex];
        }
      }
      return {
        label,
        stroke: "transparent",
        show: true,
      };
    }),
  ];

  // Add plugins
  opts.plugins = opts.plugins || [];
  opts.plugins = opts.plugins.filter(p => !(p &amp;&amp; p.id === "verticalLinePlugin"));
  
  const digitalPlugin = createDigitalFillPlugin(digitalFillSignals);
  opts.plugins.push(digitalPlugin);
  opts.plugins.push(verticalLinePlugin(verticalLinesX, () => charts));

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CREATE UPLOT INSTANCE (using shared utility - handles ResizeObserver)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const chart = initUPlotChart(opts, chartData, chartDiv, charts);

  if (!chart) {
    console.warn(`[renderSingleDigitalChart] âš ï¸ Failed to create uPlot for "${groupId}"`);
    parentDiv.remove();
    return null;
  }

  // Store plugin reference for later access
  chart._digitalPlugin = digitalPlugin;
  chart._metadata = metadata;
  chart._userGroupId = metadata.userGroupId;
  chart._uPlotInstance = metadata.uPlotInstance;
  chart._chartType = "digital";
  chart._chartIndex = chartIndex;
  chart._type = "digital";
  chart._channelIndices = validIndices.slice();
  chart._computedChannelIds = computedWithData.map(ch => ch.id);

  console.log(`[renderSingleDigitalChart] âœ… Digital chart created with ${allChannelsToShow.length} channel(s) (${validIndices.length} COMTRADE + ${computedWithData.length} computed)`);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ATTACH EVENT HANDLERS (using shared utility - handles click + tooltip)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  attachChartEventHandlers(chart, charts, verticalLinesX, opts);

  const renderEndTime = performance.now();
  console.log(`[renderSingleDigitalChart] âœ“ Render complete in ${(renderEndTime - renderStartTime).toFixed(1)}ms`);

  return chart;
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
