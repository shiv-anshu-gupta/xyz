

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Context/ThemeContext.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- build/entry.js removed - not needed -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-Context_ThemeContext.html">Context/ThemeContext</a></li><li><a href="module-analyzeGroupsAndPublish.html">analyzeGroupsAndPublish</a></li><li><a href="module-axisBuilder.html">axisBuilder</a></li><li><a href="module-axisCalculator.html">axisCalculator</a></li><li><a href="module-calculateAndPublishMaxYAxes.html">calculateAndPublishMaxYAxes</a></li><li><a href="module-chartAxisAlignment.html">chartAxisAlignment</a></li><li><a href="module-chartComponent.html">chartComponent</a></li><li><a href="module-chartManager.html">chartManager</a></li><li><a href="module-chartUpdateHelpers.html">chartUpdateHelpers</a></li><li><a href="module-components_AnalysisSidebar.html">components/AnalysisSidebar</a></li><li><a href="module-components_ChannelList.html">components/ChannelList</a></li><li><a href="module-components_ComputedChannelsSidebar.html">components/ComputedChannelsSidebar</a></li><li><a href="module-components_DeltaDrawer.html">components/DeltaDrawer</a></li><li><a href="module-components_DeltaTable.html">components/DeltaTable</a></li><li><a href="module-components_DeltaTableDataFormatter.html">components/DeltaTableDataFormatter</a></li><li><a href="module-components_DeltaTableRenderer.html">components/DeltaTableRenderer</a></li><li><a href="module-components_EquationEvaluatorInChannelList.html">components/EquationEvaluatorInChannelList</a></li><li><a href="module-components_PolarChart.html">components/PolarChart</a></li><li><a href="module-components_PolarChartCanvas.html">components/PolarChartCanvas</a></li><li><a href="module-components_ProgressBar.html">components/ProgressBar</a></li><li><a href="module-components_ResizableGroup.html">components/ResizableGroup</a></li><li><a href="module-components_SidebarResizer.html">components/SidebarResizer</a></li><li><a href="module-components_Tooltip.html">components/Tooltip</a></li><li><a href="module-components_debugPanelLite.html">components/debugPanelLite</a></li><li><a href="module-components_renderComputedChart.html">components/renderComputedChart</a></li><li><a href="module-components_renderComtradeCharts.html">components/renderComtradeCharts</a></li><li><a href="module-components_renderDigitalCharts.html">components/renderDigitalCharts</a></li><li><a href="module-components_renderSingleAnalogChart.html">components/renderSingleAnalogChart</a></li><li><a href="module-components_renderSingleDigitalChart.html">components/renderSingleDigitalChart</a></li><li><a href="module-components_setupPolarChartIntegration.html">components/setupPolarChartIntegration</a></li><li><a href="module-components_showError.html">components/showError</a></li><li><a href="module-components_verticalLineControl.html">components/verticalLineControl</a></li><li><a href="module-comtradeUtils.html">comtradeUtils</a></li><li><a href="module-createDragBar.html">createDragBar</a></li><li><a href="module-createState.html">createState</a></li><li><a href="module-domUpdateQueue.html">domUpdateQueue</a></li><li><a href="module-domUpdateQueueInit.html">domUpdateQueueInit</a></li><li><a href="module-eventListenerManager.html">eventListenerManager</a></li><li><a href="module-handleVerticalLineShortcuts.html">handleVerticalLineShortcuts</a></li><li><a href="module-initVerticalLineControl.html">initVerticalLineControl</a></li><li><a href="module-main.html">main</a></li><li><a href="module-maxYAxesStore.html">maxYAxesStore</a></li><li><a href="module-mergerWindowLauncher.html">mergerWindowLauncher</a></li><li><a href="module-plugins_autoUnitScalePlugin.html">plugins/autoUnitScalePlugin</a></li><li><a href="module-plugins_axisLinesPlugin.html">plugins/axisLinesPlugin</a></li><li><a href="module-plugins_deltaBoxPlugin.html">plugins/deltaBoxPlugin</a></li><li><a href="module-plugins_horizontalZoomPanPlugin.html">plugins/horizontalZoomPanPlugin</a></li><li><a href="module-plugins_verticalLinePlugin.html">plugins/verticalLinePlugin</a></li><li><a href="module-seriesMapper.html">seriesMapper</a></li><li><a href="module-services_computedChannels.html">services/computedChannels</a></li><li><a href="module-services_computedChannels_dataPreparation.html">services/computedChannels/dataPreparation</a></li><li><a href="module-services_computedChannels_eventHandling.html">services/computedChannels/eventHandling</a></li><li><a href="module-services_computedChannels_expressionConversion.html">services/computedChannels/expressionConversion</a></li><li><a href="module-services_computedChannels_resultProcessing.html">services/computedChannels/resultProcessing</a></li><li><a href="module-services_computedChannels_stateUpdate.html">services/computedChannels/stateUpdate</a></li><li><a href="module-services_computedChannels_validators.html">services/computedChannels/validators</a></li><li><a href="module-services_computedChannels_workerManagement.html">services/computedChannels/workerManagement</a></li><li><a href="module-setupChartDragAndDrop.html">setupChartDragAndDrop</a></li><li><a href="module-timeInterpolation.html">timeInterpolation</a></li><li><a href="module-utils_autoGroupChannels.html">utils/autoGroupChannels</a></li><li><a href="module-utils_chartDomUtils.html">utils/chartDomUtils</a></li><li><a href="module-utils_chartMetadataStore.html">utils/chartMetadataStore</a></li><li><a href="module-utils_computedChannelMetadata.html">utils/computedChannelMetadata</a></li><li><a href="module-utils_constants.html">utils/constants</a></li><li><a href="module-utils_helpers.html">utils/helpers</a></li><li><a href="module-utils_sidebarStore.html">utils/sidebarStore</a></li><li><a href="module-workers_computedChannelWorker.html">workers/computedChannelWorker</a></li></ul><h3>Classes</h3><ul><li><a href="module-components_PolarChartCanvas.PolarChartCanvas.html">PolarChartCanvas</a></li><li><a href="module-utils_computedChannelMetadata-ComputedChannelMetadata.html">ComputedChannelMetadata</a></li></ul><h3>Global</h3><ul><li><a href="global.html#IMPLEMENTATION_COMPLETE">IMPLEMENTATION_COMPLETE</a></li><li><a href="global.html#QUICK_REFERENCE">QUICK_REFERENCE</a></li><li><a href="global.html#STORAGE_CFG_KEY">STORAGE_CFG_KEY</a></li><li><a href="global.html#ZOOM_ICONS">ZOOM_ICONS</a></li><li><a href="global.html#adjustMainContent">adjustMainContent</a></li><li><a href="global.html#appendComputedChannelToStorage">appendComputedChannelToStorage</a></li><li><a href="global.html#applyZoom">applyZoom</a></li><li><a href="global.html#attachChartContainer">attachChartContainer</a></li><li><a href="global.html#attachChartEventHandlers">attachChartEventHandlers</a></li><li><a href="global.html#attachChartPlugins">attachChartPlugins</a></li><li><a href="global.html#attachComputedChartContainer">attachComputedChartContainer</a></li><li><a href="global.html#attachComputedChartEventHandlers">attachComputedChartEventHandlers</a></li><li><a href="global.html#attachComputedChartPlugins">attachComputedChartPlugins</a></li><li><a href="global.html#broadcastComputedChannelChange">broadcastComputedChannelChange</a></li><li><a href="global.html#buildChartData">buildChartData</a></li><li><a href="global.html#buildChartOptions">buildChartOptions</a></li><li><a href="global.html#buildComputedChannelLabels">buildComputedChannelLabels</a></li><li><a href="global.html#buildComputedChartOptions">buildComputedChartOptions</a></li><li><a href="global.html#buildGroupsWithAutoGrouping">buildGroupsWithAutoGrouping</a></li><li><a href="global.html#buildGroupsWithUserAssignments">buildGroupsWithUserAssignments</a></li><li><a href="global.html#buildUnitChartData">buildUnitChartData</a></li><li><a href="global.html#calculateStats">calculateStats</a></li><li><a href="global.html#chart2">chart2</a></li><li><a href="global.html#cleanupOldComputedCharts">cleanupOldComputedCharts</a></li><li><a href="global.html#clearChartsContainer">clearChartsContainer</a></li><li><a href="global.html#clearComputedChannelsFromStorage">clearComputedChannelsFromStorage</a></li><li><a href="global.html#clearExpressionCache">clearExpressionCache</a></li><li><a href="global.html#closeAnalysisDrawer">closeAnalysisDrawer</a></li><li><a href="global.html#collectChartDeltas">collectChartDeltas</a></li><li><a href="global.html#computeChartDataDimensions">computeChartDataDimensions</a></li><li><a href="global.html#createBinaryBlob">createBinaryBlob</a></li><li><a href="global.html#createChannelList">createChannelList</a></li><li><a href="global.html#createChartMetadata">createChartMetadata</a></li><li><a href="global.html#createChartOptions">createChartOptions</a></li><li><a href="global.html#createComputedChartMetadata">createComputedChartMetadata</a></li><li><a href="global.html#createComputedClickHandler">createComputedClickHandler</a></li><li><a href="global.html#createComputedMousemoveHandler">createComputedMousemoveHandler</a></li><li><a href="global.html#createDigitalFillPlugin">createDigitalFillPlugin</a></li><li><a href="global.html#createGroupDragBar">createGroupDragBar</a></li><li><a href="global.html#createMousemoveHandler">createMousemoveHandler</a></li><li><a href="global.html#createScopeTemplate">createScopeTemplate</a></li><li><a href="global.html#createState">createState</a></li><li><a href="global.html#createVerticalLineClickHandler">createVerticalLineClickHandler</a></li><li><a href="global.html#createZoomControlsHTML">createZoomControlsHTML</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#deleteComputedChannelFromStorage">deleteComputedChannelFromStorage</a></li><li><a href="global.html#encodeFloat64">encodeFloat64</a></li><li><a href="global.html#encodeInt32">encodeInt32</a></li><li><a href="global.html#evaluateExpression">evaluateExpression</a></li><li><a href="global.html#exportAllChannelsAsCSV">exportAllChannelsAsCSV</a></li><li><a href="global.html#exportComputedChannelsAsCSV">exportComputedChannelsAsCSV</a></li><li><a href="global.html#extractChannelMetadata">extractChannelMetadata</a></li><li><a href="global.html#extractChannelNameFromEquation">extractChannelNameFromEquation</a></li><li><a href="global.html#extractGroupId">extractGroupId</a></li><li><a href="global.html#extractMathExpression">extractMathExpression</a></li><li><a href="global.html#filterGroupsWithChannels">filterGroupsWithChannels</a></li><li><a href="global.html#filterUnassignedComputedChannels">filterUnassignedComputedChannels</a></li><li><a href="global.html#filterValidIndices">filterValidIndices</a></li><li><a href="global.html#formatEquationForLatex">formatEquationForLatex</a></li><li><a href="global.html#formatScaledValue">formatScaledValue</a></li><li><a href="global.html#generateCFGContentBinary32">generateCFGContentBinary32</a></li><li><a href="global.html#generateCFGContentBinary64">generateCFGContentBinary64</a></li><li><a href="global.html#generateCFGContentFloat32">generateCFGContentFloat32</a></li><li><a href="global.html#generateCFGContentFloat64">generateCFGContentFloat64</a></li><li><a href="global.html#generateDATContentBinary32">generateDATContentBinary32</a></li><li><a href="global.html#generateDATContentBinary64">generateDATContentBinary64</a></li><li><a href="global.html#generateDATContentFloat32">generateDATContentFloat32</a></li><li><a href="global.html#generateDATContentFloat64">generateDATContentFloat64</a></li><li><a href="global.html#getCacheStats">getCacheStats</a></li><li><a href="global.html#getChannelByDisplayName">getChannelByDisplayName</a></li><li><a href="global.html#getChannelMetadata">getChannelMetadata</a></li><li><a href="global.html#getChannelsForFile">getChannelsForFile</a></li><li><a href="global.html#getCompiledExpression">getCompiledExpression</a></li><li><a href="global.html#getComputedChannelById">getComputedChannelById</a></li><li><a href="global.html#getComputedChannelStorageMetadata">getComputedChannelStorageMetadata</a></li><li><a href="global.html#getComputedChannelsState">getComputedChannelsState</a></li><li><a href="global.html#getElementWidth">getElementWidth</a></li><li><a href="global.html#getFileIndexForTime">getFileIndexForTime</a></li><li><a href="global.html#getOriginalChannelName">getOriginalChannelName</a></li><li><a href="global.html#getSampleIndexInFile">getSampleIndexInFile</a></li><li><a href="global.html#getZoomLevel">getZoomLevel</a></li><li><a href="global.html#groupChannelsByUnit">groupChannelsByUnit</a></li><li><a href="global.html#handleComputedVerticalLineAddition">handleComputedVerticalLineAddition</a></li><li><a href="global.html#handleVerticalLineAddition">handleVerticalLineAddition</a></li><li><a href="global.html#hasStoredComputedChannels">hasStoredComputedChannels</a></li><li><a href="global.html#initComputedChannelsState">initComputedChannelsState</a></li><li><a href="global.html#initializeChartInstance">initializeChartInstance</a></li><li><a href="global.html#initializeComputedChartInstance">initializeComputedChartInstance</a></li><li><a href="global.html#initializeSidebarChannels">initializeSidebarChannels</a></li><li><a href="global.html#initializeZoomControls">initializeZoomControls</a></li><li><a href="global.html#injectZoomControls">injectZoomControls</a></li><li><a href="global.html#isMathJaxLoaded">isMathJaxLoaded</a></li><li><a href="global.html#listenForComputedChannelChanges">listenForComputedChannelChanges</a></li><li><a href="global.html#loadComputedChannelsForGroup">loadComputedChannelsForGroup</a></li><li><a href="global.html#loadComputedChannelsFromStorage">loadComputedChannelsFromStorage</a></li><li><a href="global.html#loadMathJax">loadMathJax</a></li><li><a href="global.html#mathJaxPromise">mathJaxPromise</a></li><li><a href="global.html#measurePerformance">measurePerformance</a></li><li><a href="global.html#mergeAnalogAndComputedMetadata">mergeAnalogAndComputedMetadata</a></li><li><a href="global.html#mergeAnalogChannels">mergeAnalogChannels</a></li><li><a href="global.html#mergeComtradeFilesSetsSequential">mergeComtradeFilesSetsSequential</a></li><li><a href="global.html#mergeDigitalChannels">mergeDigitalChannels</a></li><li><a href="global.html#mergeTimeArraysSequential">mergeTimeArraysSequential</a></li><li><a href="global.html#openAnalysisDrawer">openAnalysisDrawer</a></li><li><a href="global.html#openBothSidebars">openBothSidebars</a></li><li><a href="global.html#openDeltaWindow">openDeltaWindow</a></li><li><a href="global.html#openPhasorDiagram">openPhasorDiagram</a></li><li><a href="global.html#prepareChartDataContext">prepareChartDataContext</a></li><li><a href="global.html#processEquationInput">processEquationInput</a></li><li><a href="global.html#renameChannelWithPrefix">renameChannelWithPrefix</a></li><li><a href="global.html#renderChannelLabelContainer">renderChannelLabelContainer</a></li><li><a href="global.html#renderComputedChannels">renderComputedChannels</a></li><li><a href="global.html#renderLatex">renderLatex</a></li><li><a href="global.html#resetZoom">resetZoom</a></li><li><a href="global.html#resizeChartsToContainers">resizeChartsToContainers</a></li><li><a href="global.html#resolveGroupIndices">resolveGroupIndices</a></li><li><a href="global.html#resolveTimeArray">resolveTimeArray</a></li><li><a href="global.html#saveComputedChannelsToStorage">saveComputedChannelsToStorage</a></li><li><a href="global.html#setZoomLevel">setZoomLevel</a></li><li><a href="global.html#setupMobileSidebar">setupMobileSidebar</a></li><li><a href="global.html#showChannelListWindow">showChannelListWindow</a></li><li><a href="global.html#showFileInfo">showFileInfo</a></li><li><a href="global.html#subscribeChartUpdates">subscribeChartUpdates</a></li><li><a href="global.html#syncComputedChannelsWithParent">syncComputedChannelsWithParent</a></li><li><a href="global.html#toggleChartsVisibility">toggleChartsVisibility</a></li><li><a href="global.html#updateComputedChannelGroupInStorage">updateComputedChannelGroupInStorage</a></li><li><a href="global.html#updateComputedChannelInStorage">updateComputedChannelInStorage</a></li><li><a href="global.html#updateFileInfo">updateFileInfo</a></li><li><a href="global.html#updateMainZoomPosition">updateMainZoomPosition</a></li><li><a href="global.html#updateStatsCards">updateStatsCards</a></li><li><a href="global.html#updateZoomDisplay">updateZoomDisplay</a></li><li><a href="global.html#validateChannelName">validateChannelName</a></li><li><a href="global.html#validateGroupIndices">validateGroupIndices</a></li><li><a href="global.html#wrapChartInSection">wrapChartInSection</a></li><li><a href="global.html#zoomIn">zoomIn</a></li><li><a href="global.html#zoomOut">zoomOut</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>Context/ThemeContext.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file ThemeContext.js
 * @module Context/ThemeContext
 * 
 * @description
 * &lt;h3>Application Theme Manager&lt;/h3>
 * 
 * &lt;p>Singleton class that manages light/dark theme state across the application.
 * Supports localStorage persistence, cross-window synchronization via BroadcastChannel,
 * and automatic system preference detection.&lt;/p>
 * 
 * &lt;h4>Design Philosophy&lt;/h4>
 * &lt;table>
 *   &lt;tr>&lt;th>Principle&lt;/th>&lt;th>Description&lt;/th>&lt;/tr>
 *   &lt;tr>&lt;td>Singleton&lt;/td>&lt;td>Single instance exported as themeContext&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Persistence&lt;/td>&lt;td>Theme saved to localStorage for session continuity&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Cross-Window Sync&lt;/td>&lt;td>BroadcastChannel syncs popup windows&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>System Preference&lt;/td>&lt;td>Falls back to prefers-color-scheme media query&lt;/td>&lt;/tr>
 * &lt;/table>
 * 
 * &lt;h4>Key Features&lt;/h4>
 * &lt;ul>
 *   &lt;li>&lt;strong>CSS Variable Updates&lt;/strong> — Sets all --bg-*, --text-*, --chart-* variables&lt;/li>
 *   &lt;li>&lt;strong>Subscriber Notification&lt;/strong> — Components can subscribe to theme changes&lt;/li>
 *   &lt;li>&lt;strong>Chart Re-render&lt;/strong> — Triggers chart color updates on theme change&lt;/li>
 *   &lt;li>&lt;strong>BroadcastChannel&lt;/strong> — Syncs theme across popup windows&lt;/li>
 * &lt;/ul>
 * 
 * &lt;h4>CSS Variables Set&lt;/h4>
 * &lt;table>
 *   &lt;tr>&lt;th>Variable&lt;/th>&lt;th>Light&lt;/th>&lt;th>Dark&lt;/th>&lt;/tr>
 *   &lt;tr>&lt;td>--bg-primary&lt;/td>&lt;td>#f5f5f5&lt;/td>&lt;td>#1a1a1a&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>--bg-secondary&lt;/td>&lt;td>#ffffff&lt;/td>&lt;td>#2d2d2d&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>--text-primary&lt;/td>&lt;td>#1a1a1a&lt;/td>&lt;td>#ffffff&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>--chart-bg&lt;/td>&lt;td>#ffffff&lt;/td>&lt;td>#252525&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>--chart-grid&lt;/td>&lt;td>#e0e0e0&lt;/td>&lt;td>#404040&lt;/td>&lt;/tr>
 * &lt;/table>
 * 
 * @example
 * import { themeContext } from './Context/ThemeContext.js';
 * 
 * // Get current theme
 * const isDark = themeContext.getTheme() === 'dark';
 * 
 * // Toggle theme
 * themeContext.toggleTheme();
 * 
 * // Subscribe to changes
 * themeContext.subscribe((newTheme) => {
 *   console.log('Theme changed to:', newTheme);
 * });
 * 
 * @mermaid
 * graph TD
 *     A[new ThemeContext] --> B[_init]
 *     B --> C[Load from localStorage]
 *     C --> D{Found?}
 *     D -->|Yes| E[Use Stored Theme]
 *     D -->|No| F[Check System Preference]
 *     F --> G[Set Default Theme]
 *     E --> H[Apply CSS Variables]
 *     G --> H
 *     H --> I[Setup BroadcastChannel]
 *     
 *     J[toggleTheme] --> K[Switch light/dark]
 *     K --> L[Save to localStorage]
 *     L --> M[Apply CSS Variables]
 *     M --> N[Notify Subscribers]
 *     N --> O[Broadcast to Other Windows]
 *     
 *     style A fill:#4CAF50,color:white
 *     style H fill:#2196F3,color:white
 *     style N fill:#FF9800,color:white
 */

class ThemeContext {
  constructor() {
    this.THEMES = {
      light: {
        "--bg-primary": "#f5f5f5",
        "--bg-secondary": "#ffffff",
        "--bg-tertiary": "#f0f0f0",
        "--bg-sidebar": "#ffffff",
        "--text-primary": "#1a1a1a",
        "--text-secondary": "#666666",
        "--text-muted": "#999999",
        "--border-color": "#e0e0e0",
        "--chart-bg": "#ffffff",
        "--chart-text": "#1a1a1a",
        "--chart-grid": "#e0e0e0",
        "--chart-axis": "#666666",
      },
      dark: {
        "--bg-primary": "#1a1a1a",
        "--bg-secondary": "#2d2d2d",
        "--bg-tertiary": "#3a3a3a",
        "--bg-sidebar": "#2d2d2d",
        "--text-primary": "#ffffff",
        "--text-secondary": "#cccccc",
        "--text-muted": "#888888",
        "--border-color": "#404040",
        "--chart-bg": "#252525",
        "--chart-text": "#ffffff",
        "--chart-grid": "#404040",
        "--chart-axis": "#cccccc",
      },
    };

    this._currentTheme = null;
    this._subscribers = new Set();
    this._broadcastChannel = null;
    this._isInitialized = false;

    this._init();
  }

  _init() {
    if (this._isInitialized) {
      console.warn("[ThemeContext] Already initialized");
      return;
    }
    console.log("[ThemeContext] Initializing...");

    // 1. Load initial theme
    this._currentTheme = this._loadInitialTheme();

    // 2. Apply theme immediately (prevents FOUC - Flash of Unstyled Content)
    this._applyThemeToDom(this._currentTheme);

    // 3. Setup cross-window synchronization
    this._setupBroadcastChannel();

    // 4. Listen for storage changes (cross-tab sync)
    this._setupStorageListener();

    // 5. Listen for system theme changes
    this._setupSystemThemeListener();

    this._isInitialized = true;
    console.log(
      `[ThemeContext] ✅ Initialized with theme: ${this._currentTheme}`
    );
  }
  /**
   * Load initial theme from localStorage or system preference
   * Priority: localStorage > system preference > default (dark)
   * @private
   * @returns {string} Theme name ('light' or 'dark')
   */
  _loadInitialTheme() {
    // Check localStorage first (user's explicit choice)
    const saved = localStorage.getItem("comtrade-theme");
    if (saved &amp;&amp; this.THEMES[saved]) {
      console.log(`[ThemeContext] Loaded theme from localStorage: ${saved}`);
      return saved;
    }

    // Fallback to system preference
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme:  dark)"
    ).matches;
    const systemTheme = prefersDark ? "dark" : "light";
    console.log(`[ThemeContext] Using system preference: ${systemTheme}`);
    return systemTheme;
  }

  /**
   * Setup BroadcastChannel for cross-window/tab synchronization
   * Uses the Broadcast Channel API to sync theme across all app instances
   * @private
   */
  _setupBroadcastChannel() {
    // Check if BroadcastChannel is supported
    if (typeof BroadcastChannel === "undefined") {
      console.warn(
        "[ThemeContext] BroadcastChannel not supported in this browser"
      );
      return;
    }

    try {
      this._broadcastChannel = new BroadcastChannel("comtrade-theme-sync");

      this._broadcastChannel.onmessage = (event) => {
        const { theme, source } = event.data;

        // Avoid infinite loops - don't apply if we sent it
        if (source === this._getWindowId()) {
          return;
        }

        console.log(
          `[ThemeContext] Received theme from another window: ${theme}`
        );
        this._applyTheme(theme, false); // Don't re-broadcast
      };

      console.log("[ThemeContext] BroadcastChannel setup complete");
    } catch (err) {
      console.error("[ThemeContext] Failed to setup BroadcastChannel:", err);
    }
  }

  /**
   * Setup storage event listener for cross-tab synchronization
   * The 'storage' event fires when localStorage changes in another tab
   * @private
   */
  _setupStorageListener() {
    window.addEventListener("storage", (event) => {
      // Only react to our theme key
      if (event.key === "comtrade-theme" &amp;&amp; event.newValue) {
        console.log(
          `[ThemeContext] Storage changed in another tab: ${event.newValue}`
        );
        this._applyTheme(event.newValue, false); // Don't re-broadcast
      }
    });

    console.log("[ThemeContext] Storage listener setup complete");
  }

  /**
   * Listen for system theme preference changes
   * Automatically updates theme when user changes OS theme (if no manual override)
   * @private
   */
  _setupSystemThemeListener() {
    const mediaQuery = window.matchMedia("(prefers-color-scheme:  dark)");

    const handleSystemThemeChange = (event) => {
      // Only apply if user hasn't set a manual preference
      const hasManualPreference = localStorage.getItem("comtrade-theme");
      if (!hasManualPreference) {
        const newTheme = event.matches ? "dark" : "light";
        console.log(`[ThemeContext] System theme changed:  ${newTheme}`);
        this.setTheme(newTheme);
      }
    };

    // Modern browsers
    if (mediaQuery.addEventListener) {
      mediaQuery.addEventListener("change", handleSystemThemeChange);
    } else {
      // Fallback for older browsers
      mediaQuery.addListener(handleSystemThemeChange);
    }

    console.log("[ThemeContext] System theme listener setup complete");
  }

  /**
   * Get unique identifier for this window instance
   * Used to prevent infinite broadcast loops
   * @private
   * @returns {string} Unique window ID
   */
  _getWindowId() {
    if (!window.__themeContextId) {
      window.__themeContextId = `window-${Date.now()}-${Math.random()}`;
    }
    return window.__themeContextId;
  }

  /**
   * Apply theme (internal method with broadcast control)
   * @private
   * @param {string} themeName - Theme name ('light' or 'dark')
   * @param {boolean} broadcast - Whether to broadcast to other windows/tabs
   */
  _applyTheme(themeName, broadcast = true) {
    const colors = this.THEMES[themeName];

    if (!colors) {
      console.error(`[ThemeContext] Unknown theme: ${themeName}`);
      return;
    }

    // Update internal state
    const previousTheme = this._currentTheme;
    this._currentTheme = themeName;

    // Apply to DOM
    this._applyThemeToDom(themeName);

    // Save to localStorage
    localStorage.setItem("comtrade-theme", themeName);

    // Notify all subscribers
    this._notifySubscribers(themeName, colors);

    // Broadcast to other windows/tabs
    if (broadcast &amp;&amp; this._broadcastChannel) {
      try {
        this._broadcastChannel.postMessage({
          theme: themeName,
          source: this._getWindowId(),
        });
        console.log(`[ThemeContext] Broadcasted theme change:  ${themeName}`);
      } catch (err) {
        console.error("[ThemeContext] Failed to broadcast theme:", err);
      }
    }

    console.log(
      `[ThemeContext] Theme applied: ${previousTheme} → ${themeName}`
    );
  }

  /**
   * Apply theme CSS variables to DOM
   * @private
   * @param {string} themeName - Theme name
   */
  _applyThemeToDom(themeName) {
    const colors = this.THEMES[themeName];

    // Apply CSS variables to document root
    const root = document.documentElement.style;
    Object.entries(colors).forEach(([key, value]) => {
      root.setProperty(key, value);
    });

    // Set data attribute for CSS hooks (optional, for additional styling)
    document.documentElement.setAttribute("data-theme", themeName);

    // Dispatch native event for compatibility with existing code
    window.dispatchEvent(
      new CustomEvent("themeChanged", {
        detail: { theme: themeName, colors },
      })
    );
  }

  /**
   * Notify all subscribers of theme change
   * @private
   * @param {string} themeName - Theme name
   * @param {object} colors - Theme colors
   */
  _notifySubscribers(themeName, colors) {
    const themeData = {
      theme: themeName,
      colors: colors,
      isDark: themeName === "dark",
    };

    this._subscribers.forEach((callback) => {
      try {
        callback(themeData);
      } catch (err) {
        console.error("[ThemeContext] Subscriber error:", err);
      }
    });
  }

  // ========================================
  // PUBLIC API
  // ========================================

  /**
   * Get current theme name
   * @returns {string} Current theme name ('light' or 'dark')
   * @example
   * const theme = themeContext.getCurrentTheme(); // 'dark'
   */
  getCurrentTheme() {
    return this._currentTheme;
  }

  /**
   * Get current theme colors
   * @returns {object} Current theme color object with CSS variables
   * @example
   * const colors = themeContext. getCurrentColors();
   * // { '--bg-primary': '#1a1a1a', ...  }
   */
  getCurrentColors() {
    return this.THEMES[this._currentTheme];
  }

  /**
   * Check if current theme is dark
   * @returns {boolean} True if dark theme is active
   * @example
   * if (themeContext.isDark()) {
   *   // Apply dark-specific logic
   * }
   */
  isDark() {
    return this._currentTheme === "dark";
  }

  /**
   * Set theme explicitly
   * @param {string} themeName - Theme name ('light' or 'dark')
   * @example
   * themeContext.setTheme('dark');
   */
  setTheme(themeName) {
    if (!this.THEMES[themeName]) {
      console.error(`[ThemeContext] Unknown theme: ${themeName}`);
      return;
    }

    this._applyTheme(themeName, true);
  }

  /**
   * Toggle between light and dark theme
   * @returns {string} New theme name
   * @example
   * const newTheme = themeContext. toggle(); // 'dark' or 'light'
   */
  toggle() {
    const newTheme = this._currentTheme === "light" ? "dark" : "light";
    this.setTheme(newTheme);
    return newTheme;
  }

  /**
   * Subscribe to theme changes
   * Callback receives { theme, colors, isDark }
   * Returns an unsubscribe function
   *
   * @param {Function} callback - Callback function
   * @returns {Function} Unsubscribe function
   * @example
   * const unsubscribe = themeContext.subscribe(({ theme, isDark }) => {
   *   console.log('Theme changed to:', theme);
   * });
   *
   * // Later, cleanup
   * unsubscribe();
   */
  subscribe(callback) {
    if (typeof callback !== "function") {
      console.error("[ThemeContext] Subscribe callback must be a function");
      return () => {};
    }

    // Add subscriber
    this._subscribers.add(callback);

    // Immediately call with current theme
    try {
      callback({
        theme: this._currentTheme,
        colors: this.THEMES[this._currentTheme],
        isDark: this._currentTheme === "dark",
      });
    } catch (err) {
      console.error("[ThemeContext] Initial callback error:", err);
    }

    // Return unsubscribe function
    return () => {
      this._subscribers.delete(callback);
      console.log("[ThemeContext] Subscriber removed");
    };
  }

  /**
   * Get specific color value from current theme
   * @param {string} colorKey - CSS variable name (e.g., '--bg-primary')
   * @returns {string|null} Color value or null if not found
   * @example
   * const bgColor = themeContext.getColor('--bg-primary');
   * canvas.style.backgroundColor = bgColor;
   */
  getColor(colorKey) {
    return this.THEMES[this._currentTheme][colorKey] || null;
  }

  /**
   * Get all available theme names
   * @returns {string[]} Array of theme names
   * @example
   * const themes = themeContext.getAvailableThemes(); // ['light', 'dark']
   */
  getAvailableThemes() {
    return Object.keys(this.THEMES);
  }

  /**
   * Add a custom theme (advanced usage)
   * @param {string} themeName - Theme name
   * @param {object} colors - Color object with CSS variables
   * @example
   * themeContext.addTheme('sunset', {
   *   '--bg-primary': '#ff6b6b',
   *   '--text-primary': '#ffe66d',
   *   // ... more colors
   * });
   */
  addTheme(themeName, colors) {
    if (this.THEMES[themeName]) {
      console.warn(
        `[ThemeContext] Theme '${themeName}' already exists, overwriting`
      );
    }

    this.THEMES[themeName] = colors;
    console.log(`[ThemeContext] Added custom theme: ${themeName}`);
  }

  /**
   * Cleanup and destroy context (call when app is destroyed)
   * Closes broadcast channel and removes listeners
   */
  destroy() {
    if (this._broadcastChannel) {
      this._broadcastChannel.close();
      this._broadcastChannel = null;
    }

    this._subscribers.clear();
    this._isInitialized = false;

    console.log("[ThemeContext] Destroyed");
  }
}

// ========================================
// SINGLETON EXPORT
// ========================================

/**
 * Singleton instance of ThemeContext
 * Auto-initializes on first import
 * @type {ThemeContext}
 */
export const themeContext = new ThemeContext();

/**
 * Export class for testing purposes
 * Allows creating isolated instances in tests
 */
export { ThemeContext };

/**
 * Default export (singleton)
 */
export default themeContext;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
