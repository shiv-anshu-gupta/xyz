<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>COMTRADE Detailed Implementation Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        color: white;
        text-align: center;
        margin-bottom: 30px;
      }

      h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .subtitle {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .diagram-card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: auto;
      }

      .diagram-card h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.6em;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
      }

      .mermaid {
        display: flex;
        justify-content: center;
        min-height: 600px;
      }

      .legend {
        background: #f5f5f5;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }

      .legend h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.1em;
      }

      .legend-items {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .legend-color {
        width: 30px;
        height: 30px;
        border-radius: 4px;
        border: 2px solid #999;
      }

      .legend-text {
        font-size: 0.9em;
      }

      .layer-section {
        background: #f9f9f9;
        border-left: 4px solid #667eea;
        padding: 15px 20px;
        margin: 15px 0;
        border-radius: 4px;
      }

      .layer-section h3 {
        color: #667eea;
        margin-bottom: 8px;
        font-size: 1.1em;
      }

      .layer-section p {
        color: #555;
        line-height: 1.6;
        font-size: 0.95em;
      }

      code {
        background: #f0f0f0;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
      }

      footer {
        text-align: center;
        color: white;
        margin-top: 40px;
        padding: 20px;
        opacity: 0.8;
      }

      @media (max-width: 768px) {
        h1 {
          font-size: 1.8em;
        }

        .diagram-card {
          padding: 15px;
        }

        .legend-items {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üèóÔ∏è COMTRADE Detailed Implementation Architecture</h1>
        <p class="subtitle">
          Complete function flows, data structures, and implementation details
          with Linear Interpolation
        </p>
      </header>

      <div class="diagram-card">
        <h2>Complete Architecture with Functions & Data Flow</h2>
        <div class="mermaid">
          graph TD subgraph LAYER1["üìÅ FILE LOADING & USER INPUT"]
          FILE_INPUT["üë§ User File Selection<br />HTMLInputElement<br />accept='.cfg,.dat'"]
          READ_FILES["FileReader API<br />readAsText(file)"] end subgraph
          LAYER2["üîß PARSING & PROCESSING (comtradeUtils.js)"] PARSE_CFG["<b
            >parseCFG(cfgText, timeUnit)</b
          ><br />üìù Lines: 1-200<br />Parameters: string cfgText<br />Returns:
          config object<br /><br />EXTRACT:<br />1. Header: stationName,
          deviceID, COMTRADE_rev<br />2. Channel metadata: id, phase, unit,
          mult, offset<br />3. Sampling rates: rate, endSample<br />4. Times:
          startDate, triggerTime<br />5. File type: ASCII or BINARY<br />6. 2013
          extensions: timeCode, localCode"] PARSE_DAT["<b
            >parseDAT(datText, cfg)</b
          ><br />üìù Lines: 200-400<br />Parameters: string datText, object
          cfg<br />Returns: data object<br /><br />PROCESS:<br />1. Split lines,
          parse sample values<br />2. Apply multiplier/offset to analog<br />3.
          Decode binary if needed<br />4. Group by analog/digital<br />5. CALL
          timeInterpolation functions"] INTERPOLATION["‚≠ê
          <b>Linear Interpolation</b><br />üìç utils/timeInterpolation.js<br />Lines:
          1-229<br /><br />KEY FUNCTIONS:<br /><br /><b
            >calculateTimeFromSampleNumber()</b
          ><br />time = sampleNumber / samplingRate<br />Returns: float
          seconds<br /><br /><b>generateUniformTimeArray()</b><br />Loop i=0 to
          totalSamples:<br />
          time[i] = i / rate<br />Returns: [0, 0.00025, 0.0005, ...]<br /><br /><b
            >findSamplingRateForSample()</b
          ><br />Find applicable rate from samplingRates[]<br />Handle
          multi-rate support<br /><br /><b>linearInterpolate(x1,y1,x2,y2,x)</b
          ><br />slope = (y2-y1)/(x2-x1)<br />y = y1 + (x-x1)*slope"]
          DATA_RESULT["üìä Final Data Structure<br />{<br />
          analog: [[time, t1, t2, ...],<br />
          [ch0_val_0, ch0_val_1, ...],<br />
          [ch1_val_0, ch1_val_1, ...],<br />
          ...],<br />
          digital: [...similar],<br />
          cfg: {config object},<br />
          startDate: {DD,MM,YYYY},<br />
          timeArray: [uniform times],<br />
          samplingRates: [{rate,endSample}]<br />}"] end subgraph LAYER3["‚öôÔ∏è
          REACTIVE STATE MANAGEMENT (createState.js)"] STATE_FACTORY["<b
            >createState(initialState, options)</b
          ><br />üìù Lines: 1-250<br />Parameters: any, {batch: bool}<br />Returns:
          Proxy object with methods<br /><br />FEATURES:<br />- Proxy-based deep
          reactivity<br />- Tracks all nested changes<br />- Path-based
          subscriptions<br />- Selector functions<br />- Batch mode (default
          true)<br />- Middleware interceptors<br />- Error handling"]
          SUBSCRIBE_API["<b>state.subscribe(callback, options)</b
          ><br />Parameters:<br />
          callback: (change) => void<br />
          options.path: string|array<br />
          options.selector: (state) => any<br />
          options.descendants: bool<br />
          options.batch: bool<br /><br />Returns: unsubscribe function<br /><br />Change
          Object Structure:<br />{<br />
          path: ['analog', 'yLabels'],<br />
          prop: 'yLabels',<br />
          newValue: [...],<br />
          oldValue: [...],<br />
          root: proxy<br />
          selectorValue: custom<br />}"] CH_STATE["<b>channelState</b><br />=
          createState({<br />
          analog: {<br />
          yLabels: string[],<br />
          lineColors: string[],<br />
          channelIDs: string[],<br />
          groups: string[],<br />
          scales: number[],<br />
          units: string[],<br />
          starts: number[],<br />
          durations: number[],<br />
          inverts: boolean[],<br />
          primary: number[],<br />
          secondary: number[],<br />
          skew: number[]<br />
          },<br />
          digital: {<br />
          yLabels: string[],<br />
          lineColors: string[],<br />
          channelIDs: string[],<br />
          groups: string[],<br />
          inverts: boolean[]<br />
          }<br />})"] DATA_STATE["<b>dataState</b><br />= createState({<br />
          analog: [<br />
          [t0, t1, t2, ..., tn],<br />
          [ch0_s0, ch0_s1, ...],<br />
          [ch1_s0, ch1_s1, ...],<br />
          ...<br />
          ],<br />
          digital: [<br />
          [t0, t1, t2, ..., tn],<br />
          [dig0_s0, dig0_s1, ...],<br />
          [dig1_s0, dig1_s1, ...],<br />
          ...<br />
          ]<br />})"] VERT_STATE["<b>verticalLinesX</b><br />=
          createState([])<br /><br />Array of marker positions<br />[{x: 0.5,
          label: 'Fault'},<br />
          {x: 1.2, label: 'Event'}]"] end subgraph LAYER4["üìä CHART
          INITIALIZATION (uPlot Integration)"] CHART_OPTIONS["<b
            >createChartOptions(type, cfg)</b
          ><br />üìç components/chartComponent.js<br />üìù Lines: 34-149<br /><br />BUILD
          uPlot configuration:<br />1. width: DOM container width<br />2.
          height: 300px default<br />3. title: 'Analog' or 'Digital'<br />4.
          scales: {<br />
          x: {time scale},<br />
          y0: {left axis},<br />
          y1: {right axis},<br />
          y2: {optional}<br />
          }<br />5. series: [{<br />
          label: channel name,<br />
          stroke: color hex,<br />
          show: boolean,<br />
          spanGaps: true,<br />
          points: {show: false},<br />
          paths: uPlot.paths.linear()<br />
          }, ...],<br />6. axes: [x-axis, y-axis config]<br />7. plugins:
          [...]<br />8. hooks: {<br />
          ready: onChartReady(),<br />
          setSize: onSetSize()<br />
          }"] INIT_CHART["<b>new uPlot(opts, data, dom)</b
          ><br />Parameters:<br />
          opts: config from above<br />
          data: dataState[type]<br />
          dom: HTMLElement<br /><br />Initializes uPlot instance with:<br />-
          Canvas rendering context<br />- Series calculation<br />- Axis
          formatting<br />- Event listeners"] RENDER_MAIN["<b
            >renderComtradeCharts()</b
          ><br />üìç components/renderComtradeCharts.js<br />üìù Lines: 23-300+<br /><br />ORCHESTRATOR
          FUNCTION:<br />1. Create container divs<br />2. Setup
          ResizableGroup<br />3. For each channel type:<br />
          a. Auto-group by pattern<br />
          b. Create chart wrapper<br />
          c. Call createChartOptions()<br />
          d. new uPlot(opts, data, dom)<br />
          e. Apply plugins<br />4. Mount ResizableGroup<br />5. Setup
          drag-and-drop<br />6. Setup keyboard shortcuts"] end subgraph
          LAYER5["üîÑ REACTIVE UPDATE SYSTEM (chartManager.js)"]
          SUBSCRIBE_CHARTS["<b>subscribeChartUpdates()</b><br />üìç
          components/chartManager.js<br />üìù Lines: 40-150<br />Parameters:<br />
          channelState: state proxy<br />
          dataState: state proxy<br />
          charts: [uPlot, uPlot]<br />
          container: HTMLElement<br />
          verticalLinesX: state proxy<br /><br />Setup subscriptions:<br />1.
          channelState.subscribe((change) => {<br />
          analyzeChange(change)<br />
          decideUpdateStrategy()\n applyUpdates()\n })<br />2.
          dataState.subscribe(...)<br />3. verticalLinesX.subscribe(...)"]
          CHANGE_DETECTION["CHANGE ANALYSIS<br />Check what changed:<br />1.
          Color changed?<br />
          ‚Üí Cheap: series.stroke<br />2. Label changed?<br />
          ‚Üí Cheap: series.label<br />3. Channel added/removed?<br />
          ‚Üí Expensive: recreate<br />4. Axes changed?<br />
          ‚Üí Expensive: recreate<br />5. Data changed?<br />
          ‚Üí Medium: setData()<br />6. Invert toggled?<br />
          ‚Üí Medium: flip amplitudes"] UPDATE_STRATEGY["UPDATE DECISION TREE<br />If
          cheap operation:<br />
          ‚Üí Modify series in-place<br />
          ‚Üí chart.setSeries(index, newSeries)<br />
          ‚Üí chart.setStroke(index, color)<br />Else if structural:<br />
          ‚Üí chart.destroy()<br />
          ‚Üí recreateChart(type)<br />Else if data change:<br />
          ‚Üí chart.setData(newData)"] APPLY_UPDATES["APPLY TO uPlot<br />Methods:<br />-
          chart.setData(data)<br />- chart.setScale(key, scale)<br />-
          chart.setSeries(idx, series)<br />- chart.setSize(w, h)<br />-
          chart.setSelect(range)<br />- chart.destroy()"] RAF_BATCH["<b
            >requestAnimationFrame</b
          ><br />üìç utils/requestAnimationFrameUpdates.js<br /><br />Batch all
          updates:<br />1. Collect state changes<br />2. Batch: true
          (default)<br />3. Schedule single RAF call<br />4. Apply all updates
          once<br />5. Single reflow/repaint"] end subgraph LAYER6["üìã CHANNEL
          EDITOR - TABULATOR INTEGRATION"] OPEN_WINDOW["<b
            >showChannelListWindow()</b
          ><br />üìç components/showChannelListWindow.js<br /><br />1. Create
          popup window:<br />
          childWin = window.open()<br />2. Build HTML for Tabulator<br />3. Load
          Tabulator library<br />4. Define table columns"]
          TABULATOR_COLS["Tabulator Column Definitions:<br />- type: select
          editor<br />
          options: ['Analog','Digital']<br />- id: text (read-only)<br />- name:
          text editor<br />- unit: text editor<br />- group: select editor<br />-
          color: color picker editor<br />- scale: number editor<br />- start:
          number editor<br />- duration: number editor<br />- invert: checkbox
          editor<br />- Delete: button"] EDIT_ROWS["User Edits Table Rows<br />Each
          edit triggers:<br />editable cell update<br />
          ‚Üí table.on('cellEdited', ...)"] CHILD_LISTENER["<b
            >Child Window Message Handler</b
          ><br />üìç Tabulator window (child)<br /><br />table.on('cellEdited',
          (cell) => {<br />
          field = cell.getColumn().getField()<br />
          oldValue = row[field]<br />
          newValue = cell.getValue()<br /><br />
          parentWindow.postMessage({<br />
          source: 'ChildWindow',<br />
          type: CALLBACK_TYPE[field],<br />
          payload: {<br />
          field,<br />
          newValue,<br />
          oldValue,<br />
          channelID,<br />
          row<br />
          }<br />
          })<br />})"] CALLBACK_MSGS["Callback Message Types<br />üìç main.js
          Lines: 105-115<br /><br />CALLBACK_TYPE = {<br />
          COLOR: 'callback_color',<br />
          SCALE: 'callback_scale',<br />
          START: 'callback_start',<br />
          DURATION: 'callback_duration',<br />
          INVERT: 'callback_invert',<br />
          CHANNEL_NAME: 'callback_channelName',<br />
          GROUP: 'callback_group',<br />
          ADD_CHANNEL: 'callback_addChannel',<br />
          DELETE: 'callback_delete',<br />
          UNIT: 'callback_unit'<br />}"] PARENT_HANDLER["<b
            >Parent Message Handler</b
          ><br />üìç main.js Lines: 800+<br /><br />window.addEventListener('message',
          (e) => {<br />
          if (e.data.source !== 'ChildWindow')<br />
          return<br /><br />
          const {type, payload} = e.data<br />
          const {channelID, newValue} = payload<br /><br />
          if (type === CALLBACK_TYPE.COLOR)<br />
          channelState[type].lineColors[idx] = newValue<br />
          else if (type === CALLBACK_TYPE.SCALE)<br />
          channelState[type].scales[idx] = newValue<br />
          else if (type === CALLBACK_TYPE.INVERT)<br />
          channelState[type].inverts[idx] = newValue<br />
          ...<br />})"] end subgraph LAYER7["üëÜ USER INTERACTION HANDLERS"]
          DRAG_BAR["<b>createDragBar()</b><br />üìç
          components/createDragBar.js<br /><br />Creates draggable element:<br />-
          DOM: div with drag handle icon<br />- Color swatch<br />- Channel
          label<br />- Live label subscriptions<br /><br />Event listeners:<br />mousedown
          ‚Üí dragStart<br />mousemove ‚Üí dragMove<br />mouseup ‚Üí dragEnd<br /><br />Updates:
          verticalLinesX.push({x})"] SHORTCUTS["<b
            >handleVerticalLineShortcuts()</b
          ><br />üìç components/handleVerticalLineShortcuts.js<br /><br />Keyboard
          event handlers:<br />- ArrowLeft/Right: Move line ¬±0.01<br />-
          ArrowUp/Down: Move line ¬±0.001<br />- Delete: Remove selected line<br />-
          Ctrl+Z: Undo<br />- Plus/Minus: Adjust step size<br /><br />Updates:
          verticalLinesX array"] ZOOM_PAN["<b>horizontalZoomPanPlugin</b
          ><br />üìç plugins/horizontalZoomPanPlugin.js<br /><br />Event
          handling:<br />Wheel event:<br />
          ‚Üí Zoom in/out<br />
          ‚Üí Calculate new scale<br />
          ‚Üí chart.setScale('x', newScale)<br /><br />Drag event:<br />
          ‚Üí Pan horizontally<br />
          ‚Üí Update x-axis range"] REORDER["<b>setupChartDragAndDrop()</b
          ><br />üìç components/setupChartDragAndDrop.js<br /><br />Drag channel
          groups:<br />dragstart ‚Üí Store source index<br />dragover ‚Üí Show drop
          target<br />drop ‚Üí Reorder channels<br />
          ‚Üí Modify channelState<br />
          ‚Üí Chart recreates with new order"] end subgraph LAYER8["üîå PLUGINS &
          ADVANCED FEATURES"] VERT_PLUGIN["<b>verticalLinePlugin</b><br />üìç
          plugins/verticalLinePlugin.js<br /><br />Renders vertical overlay
          lines:<br />- Subscribe to verticalLinesX<br />- For each line:<br />
          draw vertical line at x pos<br />
          draw label tooltip<br />- Sync across both charts<br />- Update on
          verticalLinesX change"] DIGITAL_FILL["<b>digitalFillPlugin</b><br />üìç
          plugins/digitalFillPlugin.js<br /><br />Enhanced digital signal
          display:<br />- Fill areas under curve<br />- Color by state
          (high/low)<br />- Improves readability<br />- 50% opacity fill"]
          AUTO_SCALE["<b>autoUnitScalePlugin</b><br />üìç
          plugins/autoUnitScalePlugin.js<br /><br />Intelligent unit scaling:<br />-
          Analyze data range<br />- Select unit: mV, V, kV<br />- Auto-scale
          axis<br />- Update series colors<br />- Change scale label"]
          DELTA_BOX["<b>deltaBoxPlugin</b><br />üìç plugins/deltaBoxPlugin.js<br /><br />Value
          difference display:<br />- Show on hover<br />- Calculate: Œî = v2 -
          v1<br />- Show %: (Œî/v1)*100<br />- Uses calculateDeltas()"] end
          subgraph LAYER9["üîß UTILITY LAYER & HELPERS"] TIME_UTILS["<b
            >timeInterpolation.js</b
          ><br />üìç utils/timeInterpolation.js<br />üìù Lines: 1-229<br /><br />Exported
          Functions:<br />1. calculateTimeFromSampleNumber(n, rates)<br />2.
          generateUniformTimeArray(total, rates)<br />3.
          linearInterpolate(x1,y1,x2,y2,x)<br />4. findSamplingRateForSample(n,
          rates)"] DELTA_UTILS["<b>calculateDeltas()</b><br />üìç
          utils/calculateDeltas.js<br /><br />Calculates differences:<br />-
          Input: val1, val2<br />- Output: {delta, percent}"] DOM_UTILS["<b
            >chartDomUtils</b
          ><br />üìç utils/chartDomUtils.js<br /><br />- querySelector helpers<br />-
          createElement factory<br />- addClass/removeClass<br />-
          getBoundingClientRect()"] HELPERS["<b>helpers.js</b><br />üìç
          utils/helpers.js<br /><br />- createCustomElement()<br />-
          formatValue(num, precision)<br />- parseColorHex()<br />-
          debounce()<br />- throttle()"] CONSTANTS["<b>constants.js</b><br />üìç
          utils/constants.js<br /><br />Color palettes:<br />- analogPalette: 12
          colors<br />- digitalPalette: 6 colors<br />- Unit definitions<br />-
          Scale presets"] AUTO_GROUP_UTIL["<b>autoGroupChannels()</b><br />üìç
          utils/autoGroupChannels.js<br /><br />Intelligent grouping:<br />-
          Extract prefixes<br />- Match units<br />- Group A/B/C phases<br />-
          Assign colors per group"] end FILE_INPUT --> READ_FILES READ_FILES -->
          PARSE_CFG & PARSE_DAT PARSE_CFG --> INTERPOLATION PARSE_DAT -->
          INTERPOLATION INTERPOLATION --> DATA_RESULT DATA_RESULT -->
          STATE_FACTORY STATE_FACTORY --> SUBSCRIBE_API SUBSCRIBE_API -->
          CH_STATE & DATA_STATE & VERT_STATE CH_STATE & DATA_STATE -->
          CHART_OPTIONS CHART_OPTIONS --> INIT_CHART INIT_CHART --> RENDER_MAIN
          RENDER_MAIN --> SUBSCRIBE_CHARTS CH_STATE & DATA_STATE & VERT_STATE
          --> SUBSCRIBE_CHARTS SUBSCRIBE_CHARTS --> CHANGE_DETECTION
          CHANGE_DETECTION --> UPDATE_STRATEGY UPDATE_STRATEGY --> APPLY_UPDATES
          APPLY_UPDATES --> RAF_BATCH OPEN_WINDOW --> TABULATOR_COLS
          TABULATOR_COLS --> EDIT_ROWS EDIT_ROWS --> CHILD_LISTENER
          CHILD_LISTENER --> CALLBACK_MSGS CALLBACK_MSGS --> PARENT_HANDLER
          PARENT_HANDLER --> CH_STATE & DATA_STATE DRAG_BAR --> VERT_STATE
          SHORTCUTS --> VERT_STATE ZOOM_PAN --> APPLY_UPDATES REORDER -->
          CH_STATE VERT_STATE --> VERT_PLUGIN VERT_PLUGIN --> RAF_BATCH
          DATA_STATE --> DIGITAL_FILL DIGITAL_FILL --> RAF_BATCH CH_STATE -->
          AUTO_SCALE AUTO_SCALE --> CHART_OPTIONS CH_STATE & DATA_STATE -->
          DELTA_BOX DELTA_BOX --> RAF_BATCH INTERPOLATION --> TIME_UTILS
          DELTA_BOX --> DELTA_UTILS RENDER_MAIN --> DOM_UTILS DRAG_BAR -->
          HELPERS AUTO_GROUP_UTIL --> CH_STATE style INTERPOLATION
          fill:#FFF9C4,stroke:#F57F17,stroke-width:3px,color:#000 style
          TIME_UTILS fill:#FFF9C4,stroke:#F57F17,stroke-width:3px,color:#000
          style PARSE_DAT
          fill:#BBDEFB,stroke:#1565C0,stroke-width:2px,color:#000 style
          PARSE_CFG fill:#BBDEFB,stroke:#1565C0,stroke-width:2px,color:#000
          style STATE_FACTORY
          fill:#C8E6C9,stroke:#2E7D32,stroke-width:2px,color:#000 style
          SUBSCRIBE_API fill:#C8E6C9,stroke:#2E7D32,stroke-width:2px,color:#000
          style SUBSCRIBE_CHARTS
          fill:#C8E6C9,stroke:#2E7D32,stroke-width:2px,color:#000 style
          CHART_OPTIONS fill:#FFE0B2,stroke:#E65100,stroke-width:2px,color:#000
          style RENDER_MAIN
          fill:#FFE0B2,stroke:#E65100,stroke-width:2px,color:#000
        </div>

        <div class="legend">
          <h3>üé® Color Legend & Key Systems</h3>
          <div class="legend-items">
            <div class="legend-item">
              <div
                class="legend-color"
                style="background: #fff9c4; border-color: #f57f17"
              ></div>
              <div class="legend-text">
                <strong>‚≠ê Linear Interpolation</strong> - Core time calculation
                system
              </div>
            </div>
            <div class="legend-item">
              <div
                class="legend-color"
                style="background: #bbdefb; border-color: #1565c0"
              ></div>
              <div class="legend-text">
                <strong>COMTRADE Parsing</strong> - File parsing & data
                extraction
              </div>
            </div>
            <div class="legend-item">
              <div
                class="legend-color"
                style="background: #c8e6c9; border-color: #2e7d32"
              ></div>
              <div class="legend-text">
                <strong>Reactive State</strong> - Proxy-based reactivity system
              </div>
            </div>
            <div class="legend-item">
              <div
                class="legend-color"
                style="background: #ffe0b2; border-color: #e65100"
              ></div>
              <div class="legend-text">
                <strong>Chart Rendering</strong> - uPlot initialization &
                management
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="diagram-card">
        <h2>üìã Implementation Details</h2>

        <div class="layer-section">
          <h3>Layer 2: Linear Interpolation (Core Innovation)</h3>
          <p>
            Located in <code>utils/timeInterpolation.js</code> (Lines 1-229)
          </p>
          <p>
            Provides uniform time spacing across samples regardless of varying
            sampling rates:
          </p>
          <ul style="margin-left: 20px; color: #555; line-height: 1.8">
            <li>
              <strong>calculateTimeFromSampleNumber(sampleNum, rates)</strong> -
              Returns: <code>time = sampleNum / samplingRate</code>
            </li>
            <li>
              <strong>generateUniformTimeArray(totalSamples, rates)</strong> -
              Returns: <code>[0, 0.00025, 0.0005, ...]</code>
            </li>
            <li>
              <strong>findSamplingRateForSample(sampleNum, rates)</strong> -
              Handles multi-rate support
            </li>
            <li>
              <strong>linearInterpolate(x1,y1,x2,y2,x)</strong> - Standard
              linear interpolation formula
            </li>
          </ul>
        </div>

        <div class="layer-section">
          <h3>Layer 3: Reactive State Management</h3>
          <p>Located in <code>components/createState.js</code> (Lines 1-250)</p>
          <p>
            High-performance Proxy-based reactivity system with deep change
            tracking, path subscriptions, and batch updates. No external
            dependencies - pure vanilla JavaScript.
          </p>
        </div>

        <div class="layer-section">
          <h3>Layer 5: Chart Update Strategy</h3>
          <p>
            Located in <code>components/chartManager.js</code> (Lines 40-150)
          </p>
          <p>Intelligent update decision engine:</p>
          <ul style="margin-left: 20px; color: #555; line-height: 1.8">
            <li>
              <strong>In-place updates</strong> (fast) - Color, label changes ‚Üí
              modify series property
            </li>
            <li>
              <strong>Structural updates</strong> (expensive) - Channel
              add/remove, axes ‚Üí destroy + recreate
            </li>
            <li>
              <strong>Data updates</strong> (medium) - New data ‚Üí setData() call
            </li>
            <li>
              <strong>Batching</strong> - requestAnimationFrame batches all
              updates for single render
            </li>
          </ul>
        </div>

        <div class="layer-section">
          <h3>Layer 6: Channel Editor Communication</h3>
          <p>Located in <code>components/showChannelListWindow.js</code></p>
          <p>Parent ‚Üî Child window communication via postMessage API:</p>
          <ul style="margin-left: 20px; color: #555; line-height: 1.8">
            <li>
              Child window (Tabulator) sends callback messages with edited
              values
            </li>
            <li>
              Parent window receives and updates <code>channelState</code>
            </li>
            <li>Reactive subscriptions automatically trigger chart updates</li>
          </ul>
        </div>
      </div>

      <footer>
        <p>
          Generated with Mermaid.js ‚Ä¢ COMTRADE v1 Project ‚Ä¢ Last Updated: 2025
        </p>
      </footer>
    </div>

    <script>
      mermaid.initialize({
        startOnLoad: true,
        theme: "default",
        securityLevel: "loose",
      });
      mermaid.contentLoaded();
    </script>
  
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ 
    startOnLoad: true,
    theme: 'default',
    flowchart: { useMaxWidth: false }
  });
</script>

</body>
</html>
