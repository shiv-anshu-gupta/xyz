

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> components/DeltaDrawer.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- build/entry.js removed - not needed -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-Context_ThemeContext.html">Context/ThemeContext</a></li><li><a href="module-analyzeGroupsAndPublish.html">analyzeGroupsAndPublish</a></li><li><a href="module-axisBuilder.html">axisBuilder</a></li><li><a href="module-axisCalculator.html">axisCalculator</a></li><li><a href="module-calculateAndPublishMaxYAxes.html">calculateAndPublishMaxYAxes</a></li><li><a href="module-chartAxisAlignment.html">chartAxisAlignment</a></li><li><a href="module-chartComponent.html">chartComponent</a></li><li><a href="module-chartManager.html">chartManager</a></li><li><a href="module-chartUpdateHelpers.html">chartUpdateHelpers</a></li><li><a href="module-components_AnalysisSidebar.html">components/AnalysisSidebar</a></li><li><a href="module-components_ChannelList.html">components/ChannelList</a></li><li><a href="module-components_ComputedChannelsSidebar.html">components/ComputedChannelsSidebar</a></li><li><a href="module-components_DeltaDrawer.html">components/DeltaDrawer</a></li><li><a href="module-components_DeltaTable.html">components/DeltaTable</a></li><li><a href="module-components_DeltaTableDataFormatter.html">components/DeltaTableDataFormatter</a></li><li><a href="module-components_DeltaTableRenderer.html">components/DeltaTableRenderer</a></li><li><a href="module-components_EquationEvaluatorInChannelList.html">components/EquationEvaluatorInChannelList</a></li><li><a href="module-components_PolarChart.html">components/PolarChart</a></li><li><a href="module-components_PolarChartCanvas.html">components/PolarChartCanvas</a></li><li><a href="module-components_ProgressBar.html">components/ProgressBar</a></li><li><a href="module-components_ResizableGroup.html">components/ResizableGroup</a></li><li><a href="module-components_SidebarResizer.html">components/SidebarResizer</a></li><li><a href="module-components_Tooltip.html">components/Tooltip</a></li><li><a href="module-components_debugPanelLite.html">components/debugPanelLite</a></li><li><a href="module-components_renderComputedChart.html">components/renderComputedChart</a></li><li><a href="module-components_renderComtradeCharts.html">components/renderComtradeCharts</a></li><li><a href="module-components_renderDigitalCharts.html">components/renderDigitalCharts</a></li><li><a href="module-components_renderSingleAnalogChart.html">components/renderSingleAnalogChart</a></li><li><a href="module-components_renderSingleDigitalChart.html">components/renderSingleDigitalChart</a></li><li><a href="module-components_setupPolarChartIntegration.html">components/setupPolarChartIntegration</a></li><li><a href="module-components_showError.html">components/showError</a></li><li><a href="module-components_verticalLineControl.html">components/verticalLineControl</a></li><li><a href="module-comtradeUtils.html">comtradeUtils</a></li><li><a href="module-createDragBar.html">createDragBar</a></li><li><a href="module-createState.html">createState</a></li><li><a href="module-domUpdateQueue.html">domUpdateQueue</a></li><li><a href="module-domUpdateQueueInit.html">domUpdateQueueInit</a></li><li><a href="module-eventListenerManager.html">eventListenerManager</a></li><li><a href="module-handleVerticalLineShortcuts.html">handleVerticalLineShortcuts</a></li><li><a href="module-initVerticalLineControl.html">initVerticalLineControl</a></li><li><a href="module-main.html">main</a></li><li><a href="module-maxYAxesStore.html">maxYAxesStore</a></li><li><a href="module-mergerWindowLauncher.html">mergerWindowLauncher</a></li><li><a href="module-plugins_autoUnitScalePlugin.html">plugins/autoUnitScalePlugin</a></li><li><a href="module-plugins_axisLinesPlugin.html">plugins/axisLinesPlugin</a></li><li><a href="module-plugins_deltaBoxPlugin.html">plugins/deltaBoxPlugin</a></li><li><a href="module-plugins_horizontalZoomPanPlugin.html">plugins/horizontalZoomPanPlugin</a></li><li><a href="module-plugins_verticalLinePlugin.html">plugins/verticalLinePlugin</a></li><li><a href="module-seriesMapper.html">seriesMapper</a></li><li><a href="module-services_computedChannels.html">services/computedChannels</a></li><li><a href="module-services_computedChannels_dataPreparation.html">services/computedChannels/dataPreparation</a></li><li><a href="module-services_computedChannels_eventHandling.html">services/computedChannels/eventHandling</a></li><li><a href="module-services_computedChannels_expressionConversion.html">services/computedChannels/expressionConversion</a></li><li><a href="module-services_computedChannels_resultProcessing.html">services/computedChannels/resultProcessing</a></li><li><a href="module-services_computedChannels_stateUpdate.html">services/computedChannels/stateUpdate</a></li><li><a href="module-services_computedChannels_validators.html">services/computedChannels/validators</a></li><li><a href="module-services_computedChannels_workerManagement.html">services/computedChannels/workerManagement</a></li><li><a href="module-setupChartDragAndDrop.html">setupChartDragAndDrop</a></li><li><a href="module-timeInterpolation.html">timeInterpolation</a></li><li><a href="module-utils_autoGroupChannels.html">utils/autoGroupChannels</a></li><li><a href="module-utils_chartDomUtils.html">utils/chartDomUtils</a></li><li><a href="module-utils_chartMetadataStore.html">utils/chartMetadataStore</a></li><li><a href="module-utils_computedChannelMetadata.html">utils/computedChannelMetadata</a></li><li><a href="module-utils_constants.html">utils/constants</a></li><li><a href="module-utils_helpers.html">utils/helpers</a></li><li><a href="module-utils_sidebarStore.html">utils/sidebarStore</a></li><li><a href="module-workers_computedChannelWorker.html">workers/computedChannelWorker</a></li></ul><h3>Classes</h3><ul><li><a href="module-components_PolarChartCanvas.PolarChartCanvas.html">PolarChartCanvas</a></li><li><a href="module-utils_computedChannelMetadata-ComputedChannelMetadata.html">ComputedChannelMetadata</a></li></ul><h3>Global</h3><ul><li><a href="global.html#IMPLEMENTATION_COMPLETE">IMPLEMENTATION_COMPLETE</a></li><li><a href="global.html#QUICK_REFERENCE">QUICK_REFERENCE</a></li><li><a href="global.html#STORAGE_CFG_KEY">STORAGE_CFG_KEY</a></li><li><a href="global.html#ZOOM_ICONS">ZOOM_ICONS</a></li><li><a href="global.html#adjustMainContent">adjustMainContent</a></li><li><a href="global.html#appendComputedChannelToStorage">appendComputedChannelToStorage</a></li><li><a href="global.html#applyZoom">applyZoom</a></li><li><a href="global.html#attachChartContainer">attachChartContainer</a></li><li><a href="global.html#attachChartEventHandlers">attachChartEventHandlers</a></li><li><a href="global.html#attachChartPlugins">attachChartPlugins</a></li><li><a href="global.html#attachComputedChartContainer">attachComputedChartContainer</a></li><li><a href="global.html#attachComputedChartEventHandlers">attachComputedChartEventHandlers</a></li><li><a href="global.html#attachComputedChartPlugins">attachComputedChartPlugins</a></li><li><a href="global.html#broadcastComputedChannelChange">broadcastComputedChannelChange</a></li><li><a href="global.html#buildChartData">buildChartData</a></li><li><a href="global.html#buildChartOptions">buildChartOptions</a></li><li><a href="global.html#buildComputedChannelLabels">buildComputedChannelLabels</a></li><li><a href="global.html#buildComputedChartOptions">buildComputedChartOptions</a></li><li><a href="global.html#buildGroupsWithAutoGrouping">buildGroupsWithAutoGrouping</a></li><li><a href="global.html#buildGroupsWithUserAssignments">buildGroupsWithUserAssignments</a></li><li><a href="global.html#buildUnitChartData">buildUnitChartData</a></li><li><a href="global.html#calculateStats">calculateStats</a></li><li><a href="global.html#chart2">chart2</a></li><li><a href="global.html#cleanupOldComputedCharts">cleanupOldComputedCharts</a></li><li><a href="global.html#clearChartsContainer">clearChartsContainer</a></li><li><a href="global.html#clearComputedChannelsFromStorage">clearComputedChannelsFromStorage</a></li><li><a href="global.html#clearExpressionCache">clearExpressionCache</a></li><li><a href="global.html#closeAnalysisDrawer">closeAnalysisDrawer</a></li><li><a href="global.html#collectChartDeltas">collectChartDeltas</a></li><li><a href="global.html#computeChartDataDimensions">computeChartDataDimensions</a></li><li><a href="global.html#createBinaryBlob">createBinaryBlob</a></li><li><a href="global.html#createChannelList">createChannelList</a></li><li><a href="global.html#createChartMetadata">createChartMetadata</a></li><li><a href="global.html#createChartOptions">createChartOptions</a></li><li><a href="global.html#createComputedChartMetadata">createComputedChartMetadata</a></li><li><a href="global.html#createComputedClickHandler">createComputedClickHandler</a></li><li><a href="global.html#createComputedMousemoveHandler">createComputedMousemoveHandler</a></li><li><a href="global.html#createDigitalFillPlugin">createDigitalFillPlugin</a></li><li><a href="global.html#createGroupDragBar">createGroupDragBar</a></li><li><a href="global.html#createMousemoveHandler">createMousemoveHandler</a></li><li><a href="global.html#createScopeTemplate">createScopeTemplate</a></li><li><a href="global.html#createState">createState</a></li><li><a href="global.html#createVerticalLineClickHandler">createVerticalLineClickHandler</a></li><li><a href="global.html#createZoomControlsHTML">createZoomControlsHTML</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#deleteComputedChannelFromStorage">deleteComputedChannelFromStorage</a></li><li><a href="global.html#encodeFloat64">encodeFloat64</a></li><li><a href="global.html#encodeInt32">encodeInt32</a></li><li><a href="global.html#evaluateExpression">evaluateExpression</a></li><li><a href="global.html#exportAllChannelsAsCSV">exportAllChannelsAsCSV</a></li><li><a href="global.html#exportComputedChannelsAsCSV">exportComputedChannelsAsCSV</a></li><li><a href="global.html#extractChannelMetadata">extractChannelMetadata</a></li><li><a href="global.html#extractChannelNameFromEquation">extractChannelNameFromEquation</a></li><li><a href="global.html#extractGroupId">extractGroupId</a></li><li><a href="global.html#extractMathExpression">extractMathExpression</a></li><li><a href="global.html#filterGroupsWithChannels">filterGroupsWithChannels</a></li><li><a href="global.html#filterUnassignedComputedChannels">filterUnassignedComputedChannels</a></li><li><a href="global.html#filterValidIndices">filterValidIndices</a></li><li><a href="global.html#formatEquationForLatex">formatEquationForLatex</a></li><li><a href="global.html#formatScaledValue">formatScaledValue</a></li><li><a href="global.html#generateCFGContentBinary32">generateCFGContentBinary32</a></li><li><a href="global.html#generateCFGContentBinary64">generateCFGContentBinary64</a></li><li><a href="global.html#generateCFGContentFloat32">generateCFGContentFloat32</a></li><li><a href="global.html#generateCFGContentFloat64">generateCFGContentFloat64</a></li><li><a href="global.html#generateDATContentBinary32">generateDATContentBinary32</a></li><li><a href="global.html#generateDATContentBinary64">generateDATContentBinary64</a></li><li><a href="global.html#generateDATContentFloat32">generateDATContentFloat32</a></li><li><a href="global.html#generateDATContentFloat64">generateDATContentFloat64</a></li><li><a href="global.html#getCacheStats">getCacheStats</a></li><li><a href="global.html#getChannelByDisplayName">getChannelByDisplayName</a></li><li><a href="global.html#getChannelMetadata">getChannelMetadata</a></li><li><a href="global.html#getChannelsForFile">getChannelsForFile</a></li><li><a href="global.html#getCompiledExpression">getCompiledExpression</a></li><li><a href="global.html#getComputedChannelById">getComputedChannelById</a></li><li><a href="global.html#getComputedChannelStorageMetadata">getComputedChannelStorageMetadata</a></li><li><a href="global.html#getComputedChannelsState">getComputedChannelsState</a></li><li><a href="global.html#getElementWidth">getElementWidth</a></li><li><a href="global.html#getFileIndexForTime">getFileIndexForTime</a></li><li><a href="global.html#getOriginalChannelName">getOriginalChannelName</a></li><li><a href="global.html#getSampleIndexInFile">getSampleIndexInFile</a></li><li><a href="global.html#getZoomLevel">getZoomLevel</a></li><li><a href="global.html#groupChannelsByUnit">groupChannelsByUnit</a></li><li><a href="global.html#handleComputedVerticalLineAddition">handleComputedVerticalLineAddition</a></li><li><a href="global.html#handleVerticalLineAddition">handleVerticalLineAddition</a></li><li><a href="global.html#hasStoredComputedChannels">hasStoredComputedChannels</a></li><li><a href="global.html#initComputedChannelsState">initComputedChannelsState</a></li><li><a href="global.html#initializeChartInstance">initializeChartInstance</a></li><li><a href="global.html#initializeComputedChartInstance">initializeComputedChartInstance</a></li><li><a href="global.html#initializeSidebarChannels">initializeSidebarChannels</a></li><li><a href="global.html#initializeZoomControls">initializeZoomControls</a></li><li><a href="global.html#injectZoomControls">injectZoomControls</a></li><li><a href="global.html#isMathJaxLoaded">isMathJaxLoaded</a></li><li><a href="global.html#listenForComputedChannelChanges">listenForComputedChannelChanges</a></li><li><a href="global.html#loadComputedChannelsForGroup">loadComputedChannelsForGroup</a></li><li><a href="global.html#loadComputedChannelsFromStorage">loadComputedChannelsFromStorage</a></li><li><a href="global.html#loadMathJax">loadMathJax</a></li><li><a href="global.html#mathJaxPromise">mathJaxPromise</a></li><li><a href="global.html#measurePerformance">measurePerformance</a></li><li><a href="global.html#mergeAnalogAndComputedMetadata">mergeAnalogAndComputedMetadata</a></li><li><a href="global.html#mergeAnalogChannels">mergeAnalogChannels</a></li><li><a href="global.html#mergeComtradeFilesSetsSequential">mergeComtradeFilesSetsSequential</a></li><li><a href="global.html#mergeDigitalChannels">mergeDigitalChannels</a></li><li><a href="global.html#mergeTimeArraysSequential">mergeTimeArraysSequential</a></li><li><a href="global.html#openAnalysisDrawer">openAnalysisDrawer</a></li><li><a href="global.html#openBothSidebars">openBothSidebars</a></li><li><a href="global.html#openDeltaWindow">openDeltaWindow</a></li><li><a href="global.html#openPhasorDiagram">openPhasorDiagram</a></li><li><a href="global.html#prepareChartDataContext">prepareChartDataContext</a></li><li><a href="global.html#processEquationInput">processEquationInput</a></li><li><a href="global.html#renameChannelWithPrefix">renameChannelWithPrefix</a></li><li><a href="global.html#renderChannelLabelContainer">renderChannelLabelContainer</a></li><li><a href="global.html#renderComputedChannels">renderComputedChannels</a></li><li><a href="global.html#renderLatex">renderLatex</a></li><li><a href="global.html#resetZoom">resetZoom</a></li><li><a href="global.html#resizeChartsToContainers">resizeChartsToContainers</a></li><li><a href="global.html#resolveGroupIndices">resolveGroupIndices</a></li><li><a href="global.html#resolveTimeArray">resolveTimeArray</a></li><li><a href="global.html#saveComputedChannelsToStorage">saveComputedChannelsToStorage</a></li><li><a href="global.html#setZoomLevel">setZoomLevel</a></li><li><a href="global.html#setupMobileSidebar">setupMobileSidebar</a></li><li><a href="global.html#showChannelListWindow">showChannelListWindow</a></li><li><a href="global.html#showFileInfo">showFileInfo</a></li><li><a href="global.html#subscribeChartUpdates">subscribeChartUpdates</a></li><li><a href="global.html#syncComputedChannelsWithParent">syncComputedChannelsWithParent</a></li><li><a href="global.html#toggleChartsVisibility">toggleChartsVisibility</a></li><li><a href="global.html#updateComputedChannelGroupInStorage">updateComputedChannelGroupInStorage</a></li><li><a href="global.html#updateComputedChannelInStorage">updateComputedChannelInStorage</a></li><li><a href="global.html#updateFileInfo">updateFileInfo</a></li><li><a href="global.html#updateMainZoomPosition">updateMainZoomPosition</a></li><li><a href="global.html#updateStatsCards">updateStatsCards</a></li><li><a href="global.html#updateZoomDisplay">updateZoomDisplay</a></li><li><a href="global.html#validateChannelName">validateChannelName</a></li><li><a href="global.html#validateGroupIndices">validateGroupIndices</a></li><li><a href="global.html#wrapChartInSection">wrapChartInSection</a></li><li><a href="global.html#zoomIn">zoomIn</a></li><li><a href="global.html#zoomOut">zoomOut</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>components/DeltaDrawer.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file DeltaDrawer.js
 * @module components/DeltaDrawer
 * 
 * @description
 * &lt;h3>Delta Values Sidebar Drawer&lt;/h3>
 * 
 * &lt;p>A slide-out sidebar component that displays detailed crosshair/vertical line values
 * in a searchable, formatted table. Shows measurement data at vertical marker positions
 * placed on charts using Alt+1 keyboard shortcut.&lt;/p>
 * 
 * &lt;h4>Design Philosophy&lt;/h4>
 * &lt;table>
 *   &lt;tr>&lt;th>Principle&lt;/th>&lt;th>Description&lt;/th>&lt;/tr>
 *   &lt;tr>&lt;td>Pre-built HTML&lt;/td>&lt;td>DOM structure defined in index.html, component handles behavior only&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>CSS Variable Layout&lt;/td>&lt;td>Uses --main-content-width and --sidebar-width for responsive resizing&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Deduplication&lt;/td>&lt;td>Hash-based comparison prevents redundant table re-renders&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Lazy Loading&lt;/td>&lt;td>Table renderer created on-demand when drawer is opened&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Store Integration&lt;/td>&lt;td>Registered with sidebarStore for single-sidebar-at-a-time behavior&lt;/td>&lt;/tr>
 * &lt;/table>
 * 
 * &lt;h4>Key Features&lt;/h4>
 * &lt;ul>
 *   &lt;li>&lt;strong>Vertical Line Values&lt;/strong> â€” Displays channel values at each vertical marker position&lt;/li>
 *   &lt;li>&lt;strong>Delta Calculations&lt;/strong> â€” Shows differences between consecutive vertical lines&lt;/li>
 *   &lt;li>&lt;strong>Time Headers&lt;/strong> â€” Dynamic column headers showing actual timestamp values (Î¼s)&lt;/li>
 *   &lt;li>&lt;strong>Search Filtering&lt;/strong> â€” Real-time search to filter table rows by channel name&lt;/li>
 *   &lt;li>&lt;strong>Resizable Width&lt;/strong> â€” Percentage-based width (15-70%) controlled via CSS variables&lt;/li>
 *   &lt;li>&lt;strong>Empty State&lt;/strong> â€” Helpful message when no vertical lines are placed&lt;/li>
 * &lt;/ul>
 * 
 * &lt;h4>Data Flow Pipeline&lt;/h4>
 * &lt;ol>
 *   &lt;li>User places vertical lines on chart (Alt+1)&lt;/li>
 *   &lt;li>verticalLinesX state updates with new positions&lt;/li>
 *   &lt;li>Parent calls deltaDrawer.update(deltaData, lineCount)&lt;/li>
 *   &lt;li>Hash comparison checks if data changed&lt;/li>
 *   &lt;li>formatTableData() transforms sections into row format&lt;/li>
 *   &lt;li>DeltaTableRenderer creates/updates HTML table&lt;/li>
 *   &lt;li>Search input filters visible rows in real-time&lt;/li>
 * &lt;/ol>
 * 
 * &lt;h4>DOM Structure&lt;/h4>
 * &lt;pre>
 * #delta-drawer (sidebar container)
 *   â””â”€ #delta-drawer-panel (content panel)
 *       â”œâ”€ .delta-drawer-header (title + close button)
 *       â”‚   â”œâ”€ #delta-table-search (search input)
 *       â”‚   â””â”€ #delta-table-search-btn (search button)
 *       â””â”€ .delta-table-container (table wrapper)
 *           â””â”€ [DeltaTableRenderer output]
 * &lt;/pre>
 * 
 * @see {@link module:components/DeltaTableRenderer} - Table rendering engine
 * @see {@link module:components/DeltaTableDataFormatter} - Data transformation utilities
 * @see {@link module:utils/sidebarStore} - Global sidebar coordination
 * @see {@link module:main} - verticalLinesX state management
 * 
 * @example
 * // Initialize and register with store
 * const deltaDrawer = createDeltaDrawer();
 * deltaDrawer.init();
 * deltaDrawer.registerWithStore();
 * 
 * // Show drawer with data
 * deltaDrawer.show();
 * deltaDrawer.update(deltaData, verticalLinesCount);
 * 
 * // Toggle visibility
 * deltaDrawer.toggle();
 * 
 * @example
 * // deltaData format (from crosshair calculations)
 * const deltaData = [
 *   {
 *     sectionTitle: "Analog Channels",
 *     rows: [
 *       { name: "IA", values: [100.5, 102.3], deltas: [1.8] },
 *       { name: "IB", values: [98.2, 99.1], deltas: [0.9] }
 *     ]
 *   }
 * ];
 * 
 * @mermaid
 * graph TD
 *     subgraph User_Triggers
 *         A[User Places Vertical Line&lt;br/>Alt+1] --> B[verticalLinesX State Updates]
 *         C[User Opens Delta Drawer] --> D[show method called]
 *     end
 *     
 *     subgraph Drawer_Lifecycle
 *         D --> E[Remove hidden class]
 *         E --> F[Set CSS Variables&lt;br/>--main-content-width&lt;br/>--sidebar-width]
 *         F --> G[Add sidebar-resized class]
 *         G --> H[Setup Search Listeners]
 *     end
 *     
 *     subgraph Data_Update_Flow
 *         B --> I[update method called]
 *         I --> J{Data Hash Changed?}
 *         J -->|No| K[Skip Render]
 *         J -->|Yes| L[Extract Time Values&lt;br/>from verticalLinesX]
 *         L --> M[formatTableData]
 *         M --> N{Has Data?}
 *         N -->|No| O[Show Empty State&lt;br/>Add vertical lines using Alt+1]
 *         N -->|Yes| P[Create DeltaTableRenderer]
 *         P --> Q[Render Table]
 *         Q --> R[Store currentTableData&lt;br/>for Search]
 *     end
 *     
 *     subgraph Search_Flow
 *         S[User Types in Search] --> T[filterTableRows]
 *         T --> U[Re-render Filtered Data]
 *     end
 *     
 *     subgraph Hide_Flow
 *         V[hide method called] --> W[Reset CSS Variables]
 *         W --> X[Remove sidebar-resized class]
 *         X --> Y[Add hidden class&lt;br/>after 300ms]
 *     end
 *     
 *     style A fill:#4CAF50,color:white
 *     style Q fill:#2196F3,color:white
 *     style O fill:#FF9800,color:white
 */

import { sidebarStore } from "../utils/sidebarStore.js";
import { adjustMainContent } from "../utils/sidebarResize.js";
import { crosshairColors } from "../utils/constants.js";
import { createDeltaTableRenderer } from "./DeltaTableRenderer.js";
import { formatTableData } from "./DeltaTableDataFormatter.js";
import { createSidebarResizer } from "./SidebarResizer.js";
import { filterTableRows } from "./DeltaTable.js";

export function createDeltaDrawer() {
  let isOpen = false;
  let sidebarWidth = 20; // Percentage width
  const minWidth = 15;
  const maxWidth = 70;
  let tableRenderer = null;
  let lastUpdateHash = null;
  let currentTableData = [];
  let currentVerticalLinesCount = 0;

  function setupEventListeners() {
    const drawer = document.getElementById("delta-drawer");
    if (!drawer) {
      console.warn("[DeltaDrawer] Delta drawer element not found in DOM");
      return;
    }

    // Setup search functionality
    setupSearchFunctionality();
  }

  /**
   * Setup search box event listeners
   */
  function setupSearchFunctionality() {
    const searchInput = document.getElementById("delta-table-search");
    const searchBtn = document.getElementById("delta-table-search-btn");

    if (!searchInput || !searchBtn) {
      console.warn("[DeltaDrawer] Search elements not found in DOM");
      return;
    }

    // Handle search button click
    const handleSearch = () => {
      const searchQuery = searchInput.value;
      console.log("[DeltaDrawer] Searching for:", searchQuery);

      // Filter table data based on search query
      const filteredData = filterTableRows(currentTableData, searchQuery);

      // Re-render table with filtered data
      if (tableRenderer) {
        try {
          tableRenderer.render(filteredData, currentVerticalLinesCount);
          console.log("[DeltaDrawer] Table filtered to", filteredData.length, "rows");
        } catch (err) {
          console.error("[DeltaDrawer] Error filtering table:", err);
        }
      }
    };

    // Add event listeners
    searchBtn.addEventListener("click", handleSearch);
    searchInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        handleSearch();
      }
    });

    // Allow search input to update on key release for real-time filtering
    searchInput.addEventListener("keyup", () => {
      const searchQuery = searchInput.value;
      if (searchQuery === "") {
        // If search is cleared, show all rows
        if (tableRenderer) {
          tableRenderer.render(currentTableData, currentVerticalLinesCount);
        }
      }
    });

    console.log("[DeltaDrawer] Search functionality initialized");
  }

  const api = {
    show: () => {
      console.log("[DeltaDrawer] show() called");

      const drawer = document.getElementById("delta-drawer");
      const mainContent = document.getElementById("mainContent");
      const divider = document.getElementById("resizeDivider");

      if (!drawer) {
        console.error("[DeltaDrawer] âŒ Delta drawer element not found in DOM");
        return;
      }

      isOpen = true;

      // âœ… Use CSS variables to override Tailwind hashing
      document.documentElement.style.setProperty(
        "--main-content-width",
        `${100 - sidebarWidth}%`
      );
      document.documentElement.style.setProperty(
        "--sidebar-width",
        `${sidebarWidth}%`
      );

      // Add resized class to apply CSS variable widths
      drawer.classList.remove("hidden");
      drawer.classList.add("sidebar-resized");
      mainContent.classList.add("sidebar-resized");
      divider.classList.remove("hidden");

      setupEventListeners();
      console.log(
        "[DeltaDrawer] âœ… Drawer shown with width:",
        sidebarWidth + "%"
      );
    },

    hide: () => {
      console.log("[DeltaDrawer] hide() called");
      const drawer = document.getElementById("delta-drawer");
      const mainContent = document.getElementById("mainContent");
      const divider = document.getElementById("resizeDivider");

      if (!drawer) {
        console.warn("[DeltaDrawer] Drawer not found in DOM");
        isOpen = false;
        return;
      }

      isOpen = false;

      // Clear search input when drawer is hidden
      const searchInput = document.getElementById("delta-table-search");
      if (searchInput) {
        searchInput.value = "";
      }

      // âœ… Reset CSS variables and remove resized class
      document.documentElement.style.setProperty(
        "--main-content-width",
        "100%"
      );
      document.documentElement.style.setProperty("--sidebar-width", "0px");

      // Remove resized class to clear CSS variable widths
      drawer.classList.remove("sidebar-resized");
      mainContent.classList.remove("sidebar-resized");
      divider.classList.add("hidden");

      // Add delay before adding hidden class to allow animation
      setTimeout(() => {
        drawer.classList.add("hidden");
      }, 300);

      console.log("[DeltaDrawer] âœ… Drawer hidden");
    },

    update: async (deltaData = [], verticalLinesCount = 0) => {
      // âœ… Log incoming data for debugging
      console.log(
        "[DeltaDrawer] update() called with",
        deltaData.length,
        "sections,",
        verticalLinesCount,
        "vertical lines, drawer open:",
        isOpen
      );

      // âœ… Generate hash of current data to prevent duplicate renders
      const currentHash = JSON.stringify({ deltaData, verticalLinesCount });

      // âœ… Skip if data hasn't changed
      if (currentHash === lastUpdateHash) {
        console.log(
          "[DeltaDrawer] â­ï¸ Skipping duplicate update (data unchanged)"
        );
        return;
      }

      lastUpdateHash = currentHash;

      const drawerPanel = document.getElementById("delta-drawer-panel");
      if (!drawerPanel) {
        console.warn(
          "[DeltaDrawer] Drawer panel element not found - drawer may not be rendered yet"
        );
        return;
      }
      
      // Find or create header for title and search
      let headerDiv = drawerPanel.querySelector(".delta-drawer-header");
      if (!headerDiv) {
        console.warn("[DeltaDrawer] Header not found in panel");
        return;
      }
      
      // Target the content area after header
      const content = drawerPanel;

      // Destroy old renderer
      if (tableRenderer) {
        tableRenderer.destroy();
        tableRenderer = null;
      }

      // Show empty state if insufficient data
      if (!deltaData || deltaData.length === 0 || verticalLinesCount &lt; 1) {
        const message =
          verticalLinesCount &lt; 1
            ? "Add vertical lines using &lt;strong>Alt + 1&lt;/strong> on the chart to see values"
            : "";

        let tableContainer = drawerPanel.querySelector(".delta-table-container");
        if (!tableContainer) {
          tableContainer = document.createElement("div");
          tableContainer.className = "delta-table-container";
          drawerPanel.appendChild(tableContainer);
        }
        
        tableContainer.innerHTML = `
          &lt;div class="delta-empty-state">
            &lt;div style="font-size: 14px; line-height: 1.5; margin-bottom: 12px;">
              ${message}
            &lt;/div>
            &lt;div style="font-size: 12px; color: #9ca3af; margin-top: 16px;">
              ðŸ’¡ Place markers on the chart to measure values
            &lt;/div>
          &lt;/div>
        `;
        console.log("[DeltaDrawer] Showing empty state:", {
          deltaDataLength: deltaData?.length || 0,
          verticalLinesCount,
        });
        return;
      }

      // Remove old table container if exists
      let tableContainer = drawerPanel.querySelector(".delta-table-container");
      if (tableContainer) {
        tableContainer.remove();
      }
      console.log(
        "[DeltaDrawer] âœ¨ Content cleared, creating single table container"
      );

      // Create table container
      tableContainer = document.createElement("div");
      tableContainer.className = "delta-table-container";
      tableContainer.id = "delta-table-main";
      drawerPanel.appendChild(tableContainer);
      console.log(
        "[DeltaDrawer] âœ… Table container appended to drawer panel (ONCE)"
      );

      // âœ… EXTRACT: Time values BEFORE creating renderer
      let verticalLineTimes = [];

      try {
        const mainModule = await import("../main.js");
        const verticalLinesXState = mainModule.verticalLinesX;

        if (verticalLinesXState &amp;&amp; typeof verticalLinesXState === "object") {
          let linesArray = verticalLinesXState.value || [];

          if (
            (!Array.isArray(linesArray) || linesArray.length === 0) &amp;&amp;
            typeof verticalLinesXState.asArray === "function"
          ) {
            linesArray = verticalLinesXState.asArray();
          }

          if (!Array.isArray(linesArray)) {
            linesArray = Array.isArray(verticalLinesXState)
              ? verticalLinesXState
              : [];
          }

          if (Array.isArray(linesArray) &amp;&amp; linesArray.length > 0) {
            linesArray.forEach((timeValue) => {
              if (typeof timeValue === "number") {
                verticalLineTimes.push(`${timeValue.toFixed(2)} Î¼s`);
              }
            });
            console.log("[DeltaDrawer] âœ… Got time values:", verticalLineTimes);
          }
        }
      } catch (error) {
        console.warn(
          "[DeltaDrawer] Could not extract time values:",
          error.message
        );
      }

      // Fallback to placeholders if no time values
      if (verticalLineTimes.length === 0) {
        console.warn("[DeltaDrawer] âš ï¸ Using placeholder time values");
        for (let i = 0; i &lt; verticalLinesCount; i++) {
          verticalLineTimes.push(`T${i + 1}`);
        }
      }

      // Format data with time values
      const tableData = formatTableData(
        deltaData,
        verticalLinesCount,
        verticalLineTimes
      );

      console.log(
        "[DeltaDrawer] formatTableData returned",
        tableData.length,
        "rows"
      );

      if (tableData.length === 0) {
        console.warn(
          "[DeltaDrawer] No valid table data after formatting. Input deltaData:",
          deltaData
        );
        tableContainer.innerHTML =
          '&lt;p style="padding: 16px; color: #9ca3af; text-align: center;">No data available&lt;/p>';
        return;
      }

      // Get verticalLinesX state for subscription
      try {
        const mainModule = await import("../main.js");
        const verticalLinesXState = mainModule.verticalLinesX;

        // Store current table data for search functionality
        currentTableData = tableData;
        currentVerticalLinesCount = verticalLinesCount;

        // Create renderer and subscribe to state changes
        tableRenderer = createDeltaTableRenderer(
          tableContainer,
          verticalLinesXState
        );
        tableRenderer.render(tableData, verticalLinesCount);

        console.log(
          `[DeltaDrawer] âœ… Table rendered with ${tableData.length} rows (including time row) and ${verticalLinesCount} columns`
        );
      } catch (error) {
        console.error(
          "[DeltaDrawer] âŒ Failed to create table:",
          error.message,
          error.stack
        );
        tableContainer.innerHTML =
          '&lt;p style="padding: 16px; color: #dc2626;">Error creating table: ' +
          error.message +
          "&lt;/p>";
      }
    },

    isOpen: () => {
      const drawer = document.getElementById("delta-drawer");
      return drawer ? !drawer.classList.contains("hidden") : isOpen;
    },

    toggle: () => {
      if (api.isOpen()) {
        api.hide();
      } else {
        api.show();
      }
    },

    /**
     * Initialize drawer - setup event listeners and resizer
     * Call this when DOM is ready
     */
    init: () => {
      setupEventListeners();
      // âœ… REMOVED: createSidebarResizer - using explicit resizeDivider from HTML instead
      // createSidebarResizer("delta-drawer-panel", "left");
      console.log("[DeltaDrawer] âœ… Initialized with event listeners (resizer from HTML)");
    },
  };

  /**
   * Register this drawer with the global sidebar store
   * Ensures only one sidebar is visible at a time
   */
  api.registerWithStore = () => {
    sidebarStore.register("delta-drawer", {
      show: api.show,
      hide: api.hide,
      isOpen: api.isOpen,
      isClosedByDefault: true,
    });
    console.log("[DeltaDrawer] Registered with sidebar store");
  };

  /**
   * Unregister this drawer from the global sidebar store
   */
  api.unregisterFromStore = () => {
    sidebarStore.unregister("delta-drawer");
    console.log("[DeltaDrawer] Unregistered from sidebar store");
  };

  return api;
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
