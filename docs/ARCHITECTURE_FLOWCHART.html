<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>COMTRADE Architecture Flowcharts</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 30px;
        font-size: 2.5em;
        font-weight: 800;
        letter-spacing: 1px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .flowchart-section {
        background: white;
        border-radius: 12px;
        padding: 28px;
        margin-bottom: 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        border: 1px solid rgba(102, 126, 234, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .flowchart-section:hover {
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
      }

      .flowchart-section h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.4em;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        border-bottom: 3px solid;
        border-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%) 1;
        padding-bottom: 12px;
        letter-spacing: 0.5px;
      }

      .mermaid {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }

      /* Navigation styles */
      .nav-info {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border-left: 5px solid #1976d2;
        padding: 16px 18px;
        margin-bottom: 24px;
        border-radius: 8px;
        font-size: 0.95em;
        color: #0d47a1;
        box-shadow: 0 4px 12px rgba(25, 118, 210, 0.15);
        font-weight: 500;
      }

      .nav-info strong {
        display: block;
        margin-bottom: 8px;
        font-size: 1.05em;
        font-weight: 700;
      }

      /* Clickable node styling */
      .mermaid svg g.clickable-node {
        cursor: pointer;
      }

      .mermaid svg g.clickable-node rect,
      .mermaid svg g.clickable-node polygon,
      .mermaid svg g.clickable-node circle,
      .mermaid svg g.clickable-node ellipse {
        transition: stroke 0.3s, stroke-width 0.3s, filter 0.3s;
      }

      .mermaid svg g.clickable-node:hover rect,
      .mermaid svg g.clickable-node:hover polygon,
      .mermaid svg g.clickable-node:hover circle,
      .mermaid svg g.clickable-node:hover ellipse {
        stroke: #ff6b6b !important;
        stroke-width: 3px !important;
        filter: drop-shadow(0 4px 12px rgba(255, 107, 107, 0.4));
      }

      /* Italic styling for function and object names */
      .mermaid svg g.clickable-node text {
        font-style: italic;
      }

      .tooltip {
        position: fixed;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 12px;
        pointer-events: none;
        z-index: 1000;
        white-space: nowrap;
      }

      .jsdoc-link-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 2px solid #667eea;
        border-radius: 8px;
        padding: 20px;
        z-index: 2000;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        max-width: 500px;
      }

      .jsdoc-link-popup h3 {
        color: #333;
        margin-bottom: 10px;
      }

      .jsdoc-link-popup p {
        color: #666;
        margin-bottom: 15px;
        font-size: 0.9em;
      }

      .jsdoc-link-popup a {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 10px 20px;
        border-radius: 4px;
        text-decoration: none;
        margin-right: 10px;
        font-weight: 500;
      }

      .jsdoc-link-popup a:hover {
        background: #4a5cc4;
      }

      .close-popup {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        font-size: 24px;
        color: #999;
      }

      .close-popup:hover {
        color: #333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>COMTRADE Application Architecture üîó (Click nodes for JSDOC)</h1>

      <div class="nav-info">
        <strong>üí° Interactive Navigation:</strong>
        Click on any highlighted node in the diagrams to view related JSDOC
        documentation. Hover over nodes to see available documentation links.
      </div>

      <!-- 1. Main Data Flow -->
      <div class="flowchart-section">
        <h2>1. Main Data Flow (Comprehensive Flowchart)</h2>
        <div class="mermaid">
graph TD
    START["üöÄ START<br/>User Selects Files"] --> INPUT["üìÅ Input Files<br/>CFG + DAT"]
    INPUT --> VALIDATE{"Files<br/>Valid?"}
    
    VALIDATE -->|No| ERROR["‚ùå Error<br/>Invalid Format"]
    ERROR --> END_ERR["‚õî Abort"]
    
    VALIDATE -->|Yes| PARSE["comtradeUtils.js<br/>parseCFG()<br/>Extract Metadata"]
    PARSE --> CFG_OUT["üìã CFG Object Created<br/>analogChannels[], digitalChannels[],<br/>samplingRates[], timeMultiplier"]
    
    CFG_OUT --> PARSEDAT["comtradeUtils.js<br/>parseDAT()<br/>Parse Signal Values"]
    PARSEDAT --> DAT_OUT["üìä Raw Data Loaded<br/>Binary/ASCII Format<br/>All Channel Values"]
    
    DAT_OUT --> INTERP["‚ö° Linear Interpolation<br/>time[i] = i / samplingRate"]
    INTERP --> INTERP_PROCESS["üîÑ Calculate Uniform Time<br/>- Handle Multi-rate Channels<br/>- Fill Missing Values<br/>- Normalize Time Axis"]
    INTERP_PROCESS --> TIME_ARRAY["‚úÖ Interpolated Time Array<br/>Uniform spacing calculated"]
    
    TIME_ARRAY --> DATA_OUT["üì¶ DATA Object Ready<br/>time[], analogData[][], digitalData[][]<br/>Resampled to uniform intervals"]
    
    DATA_OUT --> STATE_INIT["createState.js<br/>Initialize State System"]
    
    STATE_INIT --> CHANNEL_STATE["üéØ Create channelState Proxy<br/>yLabels, lineColors, groups,<br/>scales, units, inverts"]
    STATE_INIT --> DATA_STATE["üéØ Create dataState Proxy<br/>ANALOG: time + series,<br/>DIGITAL: time + series"]
    STATE_INIT --> VLINE_STATE["üéØ Create verticalLinesX State<br/>Array of measurement markers"]
    
    CHANNEL_STATE --> STATE_READY["‚ú® State System Ready<br/>All proxies reactive"]
    DATA_STATE --> STATE_READY
    VLINE_STATE --> STATE_READY
    
    STATE_READY --> RENDER_INIT["renderComtradeCharts.js<br/>Start Rendering Pipeline"]
    
    RENDER_INIT --> SUBSCRIBE["üîî Subscribe to State Changes<br/>Monitor all properties"]
    SUBSCRIBE --> ROUTE{"Route<br/>Channels"}
    
    ROUTE -->|Analog| ANALOG_ROUTE["chartComponent.js<br/>Analog Routing<br/>autoGroupChannels()"]
    ROUTE -->|Digital| DIGITAL_ROUTE["chartComponent.js<br/>Digital Routing<br/>Find Changed Channels"]
    
    ANALOG_ROUTE --> ANALOG_BUILD["Build Chart Options<br/>Filter Data, Setup Series"]
    DIGITAL_ROUTE --> DIGITAL_BUILD["Build Chart Options<br/>Transform to Binary Format"]
    
    ANALOG_BUILD --> ADD_PLUGINS_A["Add Plugins:<br/>Zoom, Pan, Delta,<br/>Vertical Lines, Tooltips"]
    DIGITAL_BUILD --> ADD_PLUGINS_D["Add Plugins:<br/>Digital Fill,<br/>Vertical Lines"]
    
    ADD_PLUGINS_A --> INIT_A["chartComponent.js<br/>initUPlotChart()<br/>Create uPlot Instance"]
    ADD_PLUGINS_D --> INIT_D["chartComponent.js<br/>initUPlotChart()<br/>Create uPlot Instance"]
    
    INIT_A --> DOM_A["üé® Render to DOM<br/>Analog Charts"]
    INIT_D --> DOM_D["üé® Render to DOM<br/>Digital Charts"]
    
    DOM_A --> CHARTS_READY["üìà All Charts Created<br/>Added to charts[]"]
    DOM_D --> CHARTS_READY
    
    CHARTS_READY --> FINAL["‚úÖ READY FOR INTERACTION<br/>Charts Displayed & Responsive"]
    
    style START fill:#ff6b6b,color:#fff,stroke:#c92a2a,stroke-width:3px
    style FINAL fill:#51cf66,color:#fff,stroke:#2f9e44,stroke-width:3px
    style ERROR fill:#ff8a80,color:#fff,stroke:#d32f2f,stroke-width:2px
    style END_ERR fill:#ff8a80,color:#fff,stroke:#d32f2f,stroke-width:2px
    
    classDef parseClass fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef interpClass fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef stateClass fill:#ffe0b2,stroke:#f57c00,stroke-width:2px
    classDef renderClass fill:#f0f4c3,stroke:#827717,stroke-width:2px
    classDef dataClass fill:#e1bee7,stroke:#6a1b9a,stroke-width:2px
    
    class PARSE,CFG_OUT,PARSEDAT,DAT_OUT parseClass
    class INTERP,INTERP_PROCESS,TIME_ARRAY interpClass
    class STATE_INIT,CHANNEL_STATE,DATA_STATE,VLINE_STATE,STATE_READY stateClass
    class RENDER_INIT,SUBSCRIBE,ROUTE,ANALOG_ROUTE,DIGITAL_ROUTE,ANALOG_BUILD,DIGITAL_BUILD,ADD_PLUGINS_A,ADD_PLUGINS_D,INIT_A,INIT_D,DOM_A,DOM_D,CHARTS_READY renderClass
    class INPUT,VALIDATE,DATA_OUT dataClass
        </div>
      </div>

      <!-- 2. Chart Optimization & Plugin Architecture -->
      <div class="flowchart-section">
        <h2>2. Chart Optimization & Plugin Architecture</h2>
        <div class="mermaid">
graph TD
    START["üìä Charts Created<br/>Ready for Enhancement"] --> PLUGIN_SYS["chartComponent.js<br/>Plugin Architecture"]
    
    PLUGIN_SYS --> AUTO_UNIT["autoUnitScalePlugin()<br/>Auto Unit Scaling"]
    AUTO_UNIT --> AUTO_DETAIL["üîç SI Prefix Conversion<br/>Œº (micro), m (milli)<br/>k (kilo), M (mega), G (giga)"]
    AUTO_DETAIL --> AUTO_OUT["Optimized Y-Axis<br/>Clean numeric display"]
    
    PLUGIN_SYS --> VLINE_PLUGIN["verticalLinePlugin()<br/>Vertical Line Markers"]
    VLINE_PLUGIN --> VLINE_DETAIL["üìç Line Management<br/>Draw markers, Toggle visible<br/>Sync across all charts"]
    VLINE_DETAIL --> VLINE_OUT["Multi-chart Synchronized<br/>Vertical Lines"]
    
    PLUGIN_SYS --> DELTA_PLUGIN["deltaBoxPlugin()<br/>Delta Measurement"]
    DELTA_PLUGIN --> DELTA_DETAIL["üìè Measure Changes<br/>Time delta calculation<br/>Value delta computation"]
    DELTA_DETAIL --> DELTA_OUT["Interactive Delta Box<br/>Time & Value Display"]
    
    PLUGIN_SYS --> ZOOM_PLUGIN["horizontalZoomPanPlugin()<br/>Zoom & Pan Controls"]
    ZOOM_PLUGIN --> ZOOM_DETAIL["üîé Mouse Interactions<br/>Wheel zoom, drag pan<br/>Scale sync across charts"]
    ZOOM_DETAIL --> ZOOM_OUT["Synchronized Zoom<br/>Pan Controls"]
    
    PLUGIN_SYS --> DIGI_PLUGIN["digitalFillPlugin()<br/>Digital Visualization"]
    DIGI_PLUGIN --> DIGI_DETAIL["üü© Digital Rendering<br/>State rectangles (HIGH/LOW)<br/>Color coded transitions"]
    DIGI_DETAIL --> DIGI_OUT["Binary Signal Display<br/>Stacked States"]
    
    AUTO_OUT --> FEATURE_READY["‚ú® Features Ready"]
    VLINE_OUT --> FEATURE_READY
    DELTA_OUT --> FEATURE_READY
    ZOOM_OUT --> FEATURE_READY
    DIGI_OUT --> FEATURE_READY
    
    FEATURE_READY --> PERF["‚ö° Performance Optimization"]
    PERF --> PERF_DETAIL["Memory Management<br/>Event Delegation<br/>Canvas Rendering"]
    PERF_DETAIL --> READY["üéØ Fully Optimized<br/>Charts Ready"]
    
    style START fill:#fff9c4,color:#000,stroke:#f57f17,stroke-width:2px
    style READY fill:#c8e6c9,color:#000,stroke:#388e3c,stroke-width:3px
    
    classDef pluginClass fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef autoClass fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef vlineClass fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px
    classDef deltaClass fill:#ffe0b2,stroke:#e65100,stroke-width:2px
    classDef zoomClass fill:#ffccbc,stroke:#d84315,stroke-width:2px
    classDef digiClass fill:#f0f4c3,stroke:#827717,stroke-width:2px
    classDef perfClass fill:#f8bbd0,stroke:#c2185b,stroke-width:2px
    
    class PLUGIN_SYS pluginClass
    class AUTO_UNIT,AUTO_DETAIL,AUTO_OUT autoClass
    class VLINE_PLUGIN,VLINE_DETAIL,VLINE_OUT vlineClass
    class DELTA_PLUGIN,DELTA_DETAIL,DELTA_OUT deltaClass
    class ZOOM_PLUGIN,ZOOM_DETAIL,ZOOM_OUT zoomClass
    class DIGI_PLUGIN,DIGI_DETAIL,DIGI_OUT digiClass
    class PERF,PERF_DETAIL perfClass
        </div>
      </div>

      <!-- 3. Reactive State Update System -->
      <div class="flowchart-section">
        <h2>3. Reactive State Update System (State Diagram)</h2>
        <div class="mermaid">
stateDiagram-v2
    [*] --> Idle
    Idle --> ChangeDetected: State Property Changed
    ChangeDetected --> DecisionPoint: chartManager.js<br/>Detect Update Type
    DecisionPoint --> ColorLabel: Color/Label Changed<br/>(chartManager.js)
    DecisionPoint --> GroupScale: Group/Scale/Unit Changed<br/>(chartManager.js)
    DecisionPoint --> Invert: Invert Flag Toggled<br/>(chartManager.js)
    DecisionPoint --> TimeWindow: Start/Duration Changed<br/>(chartManager.js)
    DecisionPoint --> ChannelMod: Add/Delete Channel<br/>(chartManager.js)
    ColorLabel --> InPlace: In-Place Update<br/>setSeries/setLabel<br/>(chartManager.js)
    Invert --> InvertDecision: Can Invert Safely?<br/>(chartManager.js)
    InvertDecision --> InPlaceInvert: Yes - In-Place<br/>(chartManager.js)
    InvertDecision --> FullRebuild: No - Rebuild<br/>(chartManager.js)
    GroupScale --> FullRebuild: Rebuild Charts<br/>Destroy + Re-init<br/>(chartManager.js)
    TimeWindow --> TimeAdjust: setScale/Pan/Zoom<br/>(chartManager.js)
    ChannelMod --> FullRebuild
    InPlace --> Sync: forceRedraw<br/>(chartManager.js)
    InPlaceInvert --> Sync
    TimeAdjust --> Sync
    FullRebuild --> Sync
    Sync --> NotifySubscribers: Update All<br/>(chartManager.js)
    NotifySubscribers --> UIUpdated: ‚úÖ Charts Synced
    UIUpdated --> Idle
        </div>
      </div>

      <!-- 4. User Interaction Handlers -->
      <div class="flowchart-section">
        <h2>4. User Interaction Handlers (Flowchart)</h2>
        <div class="mermaid">
graph TD
    START["User Interaction<br/>(main.js)"] --> MOUSE{"Event<br/>Type?"}
    MOUSE -->|Move| TOOLTIP["Tooltip.js<br/>Show<br/>Tooltip<br/>with values"]
    MOUSE -->|Click| VLINE["handleVerticalLineShortcuts.js<br/>Toggle<br/>Vertical Line<br/>Update state"]
    START --> DRAG["setupChartDragAndDrop.js<br/>Drag<br/>dragstart"]
    DRAG --> REORDER["Reorder<br/>Charts<br/>DOM update"]
    START --> KB["Keyboard<br/>Shortcut?"]
    KB -->|Ctrl+Z| UNDO["createState.js<br/>History Undo<br/>Restore old value<br/>Suppress recording"]
    KB -->|Ctrl+Y| REDO["createState.js<br/>History Redo<br/>Restore new value"]
    TOOLTIP --> UPDATE["Update State<br/>(createState.js)"]
    VLINE --> UPDATE
    REORDER --> UPDATE
    UNDO --> UPDATE
    REDO --> UPDATE
    UPDATE --> SYNC_DETECT["Detect Changes<br/>What Changed?"]
    SYNC_DETECT --> SYNC_SELECT{"Type of Change?"}
    SYNC_SELECT -->|Color/Label| SYNC_INPLACE["In-Place Sync<br/>setSeries()<br/>setLabel()"]
    SYNC_SELECT -->|Scale/Group| SYNC_REBUILD["Full Sync<br/>forceRedraw()<br/>Rebuild"]
    SYNC_SELECT -->|Vertical Line| SYNC_VLINE["Update Markers<br/>verticalLinesX[]<br/>Redraw"]
    SYNC_INPLACE --> SYNC_BROADCAST["Broadcast Changes<br/>Notify All Charts"]
    SYNC_REBUILD --> SYNC_BROADCAST
    SYNC_VLINE --> SYNC_BROADCAST
    SYNC_BROADCAST --> END["\u2705 Synced<br/>Ready"]
    classDef interactClass fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    class START,MOUSE,TOOLTIP,VLINE,DRAG,REORDER,KB,UNDO,REDO,UPDATE,SYNC_DETECT,SYNC_SELECT,SYNC_INPLACE,SYNC_REBUILD,SYNC_VLINE,SYNC_BROADCAST,END interactClass
        </div>
      </div>

      <!-- 5. Channel Editor Workflow -->
      <div class="flowchart-section">
        <h2>5. Channel Editor Workflow (Sequence Diagram)</h2>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant Parent as main.js<br/>(Parent Window)
    participant Child as showChannelListWindow.js<br/>(Child Window)
    participant Tabulator as Tabulator<br/>Table
    participant Manager as chartManager.js<br/>(Reactive)

    User->>Parent: Click Edit Channels
    activate Parent
    Parent->>Child: window.open()
    deactivate Parent
    activate Child
    
    Child->>Child: Load Dependencies<br/>(Tailwind, Tabulator CSS/JS)
    Child->>Child: Inject UI Structure<br/>(Buttons, Container)
    
    Child->>Tabulator: Initialize Table
    activate Tabulator
    Tabulator->>Child: Table Created
    deactivate Tabulator
    
    Child->>Child: Populate Rows from<br/>channelState
    Child->>User: Table Ready
    
    alt User Edits Cell
        User->>Tabulator: Click Cell
        activate Tabulator
        Tabulator->>Child: cellEdited Event
        deactivate Tabulator
        Child->>Parent: postMessage<br/>(type: callback_*)
    else User Adds Row
        User->>Tabulator: Click Add Row Button
        activate Tabulator
        Tabulator->>Child: Row Added
        deactivate Tabulator
        Child->>Parent: postMessage<br/>(type: addChannel)
    else User Deletes Row
        User->>Tabulator: Click Delete Button
        activate Tabulator
        Tabulator->>Child: Row Removed
        deactivate Tabulator
        Child->>Parent: postMessage<br/>(type: deleteChannel)
    end
    
    activate Parent
    Parent->>Parent: Route by Message Type
    alt Update channelState
        Parent->>Parent: Update arrays<br/>(yLabels, lineColors, etc)
    else Add Channel
        Parent->>Parent: Generate channelID<br/>Add to cfg arrays
    else Delete Channel
        Parent->>Parent: Find & Remove<br/>from cfg arrays
    end
    
    Parent->>Manager: Trigger Reactive System<br/>State proxy notifies
    deactivate Parent
    
    activate Manager
    Manager->>Manager: Detect Change Type
    Manager->>Manager: In-Place or<br/>Full Rebuild
    Manager->>Manager: Force Redraw
    deactivate Manager
    
    Parent->>Child: Send ACK Message
    activate Child
    Child->>Tabulator: Update Row IDs
    deactivate Child
    deactivate Child
    
    User->>User: Charts Updated
        </div>
      </div>

      <!-- 6. Plugin & Advanced Features -->
      <div class="flowchart-section">
        <h2>6. Plugin & Advanced Features Architecture (Flowchart)</h2>
        <div class="mermaid">
graph TD
    CORE["chartComponent.js<br/>Core Plugin System"]
    STATE_SYS["createState.js<br/>State Management System"]
    
    CORE --> PLUGINS_HEADER["üì¶ Chart Enhancement Plugins"]
    
    PLUGINS_HEADER --> AUTO["autoUnitScalePlugin()<br/>SI Unit Auto-scaling"]
    AUTO --> AUTO_DESC["üîç Dynamic Prefixes<br/>Œº m k M G conversion<br/>Clean numeric display"]
    AUTO_DESC --> AUTO_READY["Ready"]
    
    PLUGINS_HEADER --> VERT["verticalLinePlugin()<br/>Vertical Line Markers"]
    VERT --> VERT_DESC["üìç Marker Management<br/>Draw, toggle, sync<br/>Multi-chart coordination"]
    VERT_DESC --> VERT_READY["Ready"]
    
    PLUGINS_HEADER --> DELTA["deltaBoxPlugin()<br/>Delta Measurement Tool"]
    DELTA --> DELTA_DESC["üìè Interactive Deltas<br/>Time & value calculation<br/>Visual box overlay"]
    DELTA_DESC --> DELTA_READY["Ready"]
    
    PLUGINS_HEADER --> ZOOM["horizontalZoomPanPlugin()<br/>Zoom & Pan Controls"]
    ZOOM --> ZOOM_DESC["üîé Mouse Interactions<br/>Wheel zoom, drag pan<br/>Synchronized scaling"]
    ZOOM_DESC --> ZOOM_READY["Ready"]
    
    PLUGINS_HEADER --> DIGI["digitalFillPlugin()<br/>Digital Visualization"]
    DIGI --> DIGI_DESC["üü© State Rendering<br/>HIGH/LOW rectangles<br/>Color-coded states"]
    DIGI_DESC --> DIGI_READY["Ready"]
    
    AUTO_READY --> PLUGINS_COMPLETE["‚ú® All Plugins Ready"]
    VERT_READY --> PLUGINS_COMPLETE
    DELTA_READY --> PLUGINS_COMPLETE
    ZOOM_READY --> PLUGINS_COMPLETE
    DIGI_READY --> PLUGINS_COMPLETE
    
    STATE_SYS --> FEATURES_HEADER["üéØ Advanced State Features"]
    
    FEATURES_HEADER --> HISTORY["History System<br/>State Change Tracking"]
    HISTORY --> TRACK["Record Mutations<br/>Detect action type<br/>Store in array"]
    TRACK --> PERSIST["localStorage Persistence<br/>Save & restore state<br/>JSON serialization"]
    PERSIST --> HISTORY_READY["Ready"]
    
    FEATURES_HEADER --> REACTIVE["Reactive Proxy System<br/>State Management"]
    REACTIVE --> BIND["DOM Binding API<br/>Two-way sync<br/>Property binding"]
    BIND --> COMPUTED["Computed Properties<br/>Auto-recalculate<br/>Dependency tracking"]
    COMPUTED --> MIDDLEWARE["Middleware System<br/>Change interception<br/>Input validation"]
    MIDDLEWARE --> REACTIVE_READY["Ready"]
    
    HISTORY_READY --> FEATURES_COMPLETE["‚ú® All Features Ready"]
    REACTIVE_READY --> FEATURES_COMPLETE
    
    PLUGINS_COMPLETE --> FINAL["Production Ready"]
    FEATURES_COMPLETE --> FINAL
    
    style CORE fill:#667eea,color:#fff,stroke:#4a4a8a,stroke-width:2px
    style STATE_SYS fill:#667eea,color:#fff,stroke:#4a4a8a,stroke-width:2px
    style FINAL fill:#51cf66,color:#000,stroke:#2f9e44,stroke-width:3px
    
    classDef pluginHeader fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef autoClass fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef vlineClass fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px
    classDef deltaClass fill:#ffe0b2,stroke:#e65100,stroke-width:2px
    classDef zoomClass fill:#ffccbc,stroke:#d84315,stroke-width:2px
    classDef digiClass fill:#f0f4c3,stroke:#827717,stroke-width:2px
    classDef historyClass fill:#f8bbd0,stroke:#c2185b,stroke-width:2px
    classDef stateClass fill:#b2dfdb,stroke:#00897b,stroke-width:2px
    classDef readyClass fill:#e0e0e0,stroke:#424242,stroke-width:1px
    
    class PLUGINS_HEADER pluginHeader
    class AUTO,AUTO_DESC autoClass
    class VERT,VERT_DESC vlineClass
    class DELTA,DELTA_DESC deltaClass
    class ZOOM,ZOOM_DESC zoomClass
    class DIGI,DIGI_DESC digiClass
    class HISTORY,TRACK,PERSIST historyClass
    class REACTIVE,BIND,COMPUTED,MIDDLEWARE stateClass
    class AUTO_READY,VERT_READY,DELTA_READY,ZOOM_READY,DIGI_READY,HISTORY_READY,REACTIVE_READY readyClass
    class PLUGINS_COMPLETE,FEATURES_COMPLETE pluginHeader
        </div>
      </div>

      <!-- 7. Complete Application Architecture -->
      <div class="flowchart-section">
        <h2>7. Complete Application Architecture (Full Detail)</h2>
        <div class="mermaid">
graph TB
    START([Application Start])
    START --> LOAD_FILES
    
    subgraph FILE_LOADING["File Loading and Parsing Layer"]
        LOAD_FILES["User Selects COMTRADE Files<br/>CFG and DAT files"]
        LOAD_FILES --> PARSE_CFG["parseCFG Function<br/>Extract channel metadata<br/>sampling rates and time data"]
        LOAD_FILES --> PARSE_DAT["parseDAT Function<br/>Parse signal values<br/>LINEAR INTERPOLATION<br/>ASCII or Binary format"]
        PARSE_CFG --> CFG_OBJ["Configuration Object<br/>analogChannels array<br/>digitalChannels array<br/>samplingRates"]
        PARSE_DAT --> INTERP["Linear Interpolation<br/>time = sampleNumber / samplingRate<br/>Uniform time spacing<br/>Multi-rate support"]
        INTERP --> DATA_OBJ["Data Object<br/>time float array<br/>analogData 2D array<br/>digitalData 2D array"]
    end
    
    subgraph STATE_INIT["Reactive State Management - createState.js"]
        CFG_OBJ --> INIT_CHANNEL["Initialize channelState"]
        DATA_OBJ --> INIT_DATA["Initialize dataState"]
        INIT_CHANNEL --> CHANNEL_STATE["channelState<br/>yLabels, lineColors<br/>groups, channelIDs<br/>scales, units"]
        INIT_DATA --> DATA_STATE["dataState<br/>ANALOG: time + series<br/>DIGITAL: time + series"]
        VLINES_INIT["Create verticalLinesX"] --> VLINES_STATE["verticalLinesX State<br/>Array of X positions"]
    end
    
    subgraph CHART_RENDER["Chart Rendering Pipeline - renderComtradeCharts.js"]
        CHANNEL_STATE --> RENDER_START["renderComtradeCharts<br/>Main orchestrator"]
        DATA_STATE --> RENDER_START
        VLINES_STATE --> RENDER_START
        RENDER_START --> CLEAR["Clear Charts Container"]
        CLEAR --> SETUP_DND["setupChartDragAndDrop.js"]
        SETUP_DND --> ROUTE{"Route by<br/>Channel Type?"}
        ROUTE -->|Analog| AUTO_GRP["autoGroupChannels<br/>chartComponent.js"]
        ROUTE -->|Digital| FILTER_DIG["findChangedDigitalChannels<br/>chartComponent.js"]
        AUTO_GRP --> ANA_RENDER["renderAnalogCharts"]
        FILTER_DIG --> DIG_RENDER["renderDigitalCharts"]
        ANA_RENDER --> DND_BAR["createDragBar"]
        DND_BAR --> BUILD_OPT["createChartOptions<br/>chartComponent.js"]
        BUILD_OPT --> INIT_CH["initUPlotChart<br/>chartComponent.js"]
        DIG_RENDER --> DIG_PLUGINS["Add Plugins"]
        DIG_PLUGINS --> DIG_INIT["initUPlotChart<br/>chartComponent.js"]
        INIT_CH --> CH_READY["Charts Array Ready"]
        DIG_INIT --> CH_READY
    end
    
    subgraph REACTIVE_SYS["Reactive Update Manager - chartManager.js"]
        CH_READY --> SUBSCRIBE["subscribeChartUpdates<br/>Monitor state changes"]
        SUBSCRIBE --> LISTEN{"Detect State<br/>Change Type?"}
        LISTEN -->|Color Changed| COLOR_UPD["In-Place Update<br/>setSeries"]
        LISTEN -->|Scale Changed| FULL_REC["Full Rebuild Chart"]
        LISTEN -->|Channel Added| FULL_REC
        COLOR_UPD --> REACTIVE_OK["Reactive Update<br/>Complete"]
        FULL_REC --> REACTIVE_OK
    end
    
    subgraph EDITOR["Channel List Editor - showChannelListWindow.js"]
        USER_OPENS["User Clicks Edit Channels"]
        USER_OPENS --> OPEN_WIN["Open Popup Window"]
        OPEN_WIN --> LOAD_DEP["Load Dependencies<br/>Tailwind, Tabulator"]
        LOAD_DEP --> BUILD_TBL["Build Tabulator Table<br/>ID, Name, Color<br/>Unit, Group, Scale"]
        BUILD_TBL --> POP_ROWS["Populate Rows"]
        POP_ROWS --> TBL_RDY["Table Ready"]
        TBL_RDY --> USER_ACT{"User Action?"}
        USER_ACT -->|Edit Cell| CELL_ED["cellEdited Event"]
        USER_ACT -->|Add Row| ADD_ROW["Add New Row"]
        USER_ACT -->|Delete Row| DEL_ROW["Delete Row"]
        CELL_ED --> POST_MSG["postMessage to Parent"]
        ADD_ROW --> POST_MSG
        DEL_ROW --> POST_MSG
        POST_MSG --> PARENT_HDL["main.js<br/>Update State"]
        PARENT_HDL --> TRIGGER_RX["Trigger Reactive System"]
    end
    
    REACTIVE_OK --> END(["Application Running<br/>and Ready"])
    TRIGGER_RX --> LISTEN
    
    classDef fileClass fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef stateClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef renderClass fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef reactiveClass fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef editorClass fill:#fff3e0,stroke:#e65100,stroke-width:2px
    
    class LOAD_FILES,PARSE_CFG,PARSE_DAT fileClass
    class CHANNEL_STATE,DATA_STATE,VLINES_STATE stateClass
    class RENDER_START,ANA_RENDER,DIG_RENDER,INIT_CH renderClass
    class SUBSCRIBE,LISTEN,REACTIVE_OK reactiveClass
    class OPEN_WIN,BUILD_TBL,PARENT_HDL editorClass
        </div>
      </div>

    <script>
      // JSDOC Navigation Mapping - All nodes from 7 sections
      const jsDocMap = {
        // ========== SECTION 1: Main Data Flow (Sequence Diagram) ==========
        "User": {
          name: "User Interaction",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Application user interface",
        },
        "FileSystem": {
          name: "File System",
          path: "module-comtradeUtils.html",
          modulePath: "module-comtradeUtils.html",
          desc: "COMTRADE file selection",
        },
        "Utils": {
          name: "comtradeUtils()",
          path: "module-comtradeUtils.html",
          modulePath: "module-comtradeUtils.html",
          desc: "CFG and DAT file parsing",
        },
        "Interpolation": {
          name: "Linear Interpolation",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Time array interpolation",
        },
        "StateManager": {
          name: "createState()",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Reactive state management",
        },
        "Renderer": {
          name: "renderComtradeCharts()",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "Main chart rendering orchestrator",
        },
        "Display": {
          name: "Chart Display",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "Chart container and rendering",
        },

        // ========== SECTION 2: Chart Rendering Pipeline ==========
        "START": {
          name: "renderComtradeCharts()",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "Main chart rendering orchestrator - routes analog and digital channels",
        },
        "ROUTE": {
          name: "Channel Type Router",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "Route channels by type (analog vs digital)",
        },
        "AUTO": {
          name: "autoGroupChannels()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Smart grouping for analog channels by phase or unit",
        },
        "FILTER": {
          name: "findChangedDigitalChannels()",
          path: "components_renderDigitalCharts.js.html",
          modulePath: "module-renderDigitalCharts.html",
          desc: "Filter to only channels with state changes",
        },
        "LOOP": {
          name: "Analog Rendering Loop",
          path: "components_renderAnalogCharts.js.html",
          modulePath: "module-renderAnalogCharts.html",
          desc: "Process each analog group for rendering",
        },
        "DLOOP": {
          name: "Digital Rendering Loop",
          path: "components_renderDigitalCharts.js.html",
          modulePath: "module-renderDigitalCharts.html",
          desc: "Process each digital channel",
        },
        "BUILD": {
          name: "buildChartOptions()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Build uPlot options for analog charts",
        },
        "DBUILD": {
          name: "buildChartOptions()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Build uPlot options for digital charts",
        },
        "PLUGINS": {
          name: "Add Plugins",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Attach plugins: zoom, pan, auto-scale, vertical lines",
        },
        "DPLUGINS": {
          name: "Add Digital Plugins",
          path: "components_renderDigitalCharts.js.html",
          modulePath: "module-renderDigitalCharts.html",
          desc: "Attach digital plugins: fill, vertical lines",
        },
        "INIT": {
          name: "initUPlotChart()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Create uPlot instance for analog",
        },
        "DINIT": {
          name: "initUPlotChart()",
          path: "components_renderDigitalCharts.js.html",
          modulePath: "module-renderDigitalCharts.html",
          desc: "Create uPlot instance for digital",
        },
        "DONE": {
          name: "Add to Charts Array",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "Add created chart to global charts array",
        },
        "END": {
          name: "All Charts Ready",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "Rendering complete - all charts ready",
        },

        // ========== SECTION 2: Chart Optimization & Plugin Architecture ==========
        "PLUGIN_SYS": {
          name: "Plugin Architecture",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "uPlot plugin system for enhanced visualization",
        },
        "AUTO_UNIT": {
          name: "autoUnitScalePlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Auto-scaling plugin with SI prefix conversion",
        },
        "AUTO_DETAIL": {
          name: "SI Prefix Conversion",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Calculate and apply SI prefixes (Œº, m, k, M, G)",
        },
        "AUTO_OUT": {
          name: "Optimized Y-Axis",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Axis with clean numeric display and proper units",
        },
        "VLINE_PLUGIN": {
          name: "verticalLinePlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Plugin for vertical line marker management",
        },
        "VLINE_DETAIL": {
          name: "Line Management",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Draw, toggle, and sync vertical line markers",
        },
        "VLINE_OUT": {
          name: "Synchronized Vertical Lines",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Vertical lines synced across all charts",
        },
        "DELTA_PLUGIN": {
          name: "deltaBoxPlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Plugin for delta measurement between points",
        },
        "DELTA_DETAIL": {
          name: "Delta Measurement",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Calculate time and value deltas interactively",
        },
        "DELTA_OUT": {
          name: "Interactive Delta Box",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Visual delta box with time and value display",
        },
        "ZOOM_PLUGIN": {
          name: "horizontalZoomPanPlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Plugin for mouse wheel zoom and pan",
        },
        "ZOOM_DETAIL": {
          name: "Zoom & Pan Controls",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Synchronized zoom and pan across charts",
        },
        "ZOOM_OUT": {
          name: "Synchronized Zoom & Pan",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "All charts zoom and pan together",
        },
        "DIGI_PLUGIN": {
          name: "digitalFillPlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Plugin for digital signal rectangle visualization",
        },
        "DIGI_DETAIL": {
          name: "Digital Rendering",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Color-coded rectangles for HIGH/LOW states",
        },
        "DIGI_OUT": {
          name: "Binary Signal Display",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Stacked digital state visualization",
        },
        "FEATURE_READY": {
          name: "Features Ready",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "All plugins initialized and active",
        },
        "PERF": {
          name: "Performance Optimization",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Memory management and rendering optimization",
        },
        "PERF_DETAIL": {
          name: "Optimization Techniques",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Event delegation, canvas rendering, memory pooling",
        },
        "READY": {
          name: "Fully Optimized Charts",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Production-ready charts with all features enabled",
        },

        // ========== SECTION 3: Reactive State Update System ==========
        "Idle": {
          name: "Idle State",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Waiting for state changes",
        },
        "ChangeDetected": {
          name: "Change Detection",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "State proxy detected property change",
        },
        "DecisionPoint": {
          name: "Change Type Router",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Determine type of change and update strategy",
        },
        "ColorLabel": {
          name: "Color/Label Update",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "In-place update for colors or labels",
        },
        "GroupScale": {
          name: "Group/Scale Change",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Requires full chart rebuild",
        },
        "Invert": {
          name: "Invert Flag Change",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Toggle channel invert state",
        },
        "TimeWindow": {
          name: "Time Window Change",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Update time range or duration",
        },
        "ChannelMod": {
          name: "Channel Modification",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Add or delete channel",
        },
        "InPlace": {
          name: "In-Place Update",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Fast update without rebuilding chart",
        },
        "InvertDecision": {
          name: "Invert Compatibility Check",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Check if invert can be applied safely",
        },
        "InPlaceInvert": {
          name: "In-Place Invert",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Apply invert without full rebuild",
        },
        "FullRebuild": {
          name: "Full Chart Rebuild",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Destroy and re-initialize charts",
        },
        "TimeAdjust": {
          name: "Time Adjustment",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Adjust scale, pan, or zoom",
        },
        "Sync": {
          name: "Synchronize",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Sync all chart updates",
        },
        "NotifySubscribers": {
          name: "Notify Subscribers",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Trigger all state change listeners",
        },
        "UIUpdated": {
          name: "UI Updated",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Charts synced with new state",
        },

        // ========== SECTION 4: User Interaction Handlers ==========
        "MOUSE": {
          name: "Mouse Events",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Mouse move and click handlers",
        },
        "TOOLTIP": {
          name: "Tooltip Display",
          path: "components_Tooltip.js.html",
          modulePath: "components_Tooltip.js.html",
          desc: "Show tooltip with data values at cursor",
        },
        "VLINE": {
          name: "handleVerticalLineShortcuts()",
          path: "components_handleVerticalLineShortcuts.js.html",
          modulePath: "module-handleVerticalLineShortcuts.html",
          desc: "Alt+0/1 shortcuts for vertical line management",
        },
        "DRAG": {
          name: "setupChartDragAndDrop()",
          path: "components_setupChartDragAndDrop.js.html",
          modulePath: "module-setupChartDragAndDrop.html",
          desc: "Drag and drop event handlers",
        },
        "REORDER": {
          name: "Reorder Charts",
          path: "components_setupChartDragAndDrop.js.html",
          modulePath: "module-setupChartDragAndDrop.html",
          desc: "Reorder charts via drag and drop",
        },
        "KB": {
          name: "Keyboard Events",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Keyboard shortcut handlers",
        },
        "UNDO": {
          name: "Undo Operation",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Ctrl+Z - restore previous state",
        },
        "REDO": {
          name: "Redo Operation",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Ctrl+Y - restore next state",
        },
        "UPDATE": {
          name: "Update State",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Apply state changes via proxy",
        },
        "SYNC": {
          name: "Sync All Charts",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Force redraw across all charts",
        },
        "SYNC_DETECT": {
          name: "Detect Changes",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Analyze what property changed in state",
        },
        "SYNC_SELECT": {
          name: "Change Type Router",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Route to appropriate sync strategy",
        },
        "SYNC_INPLACE": {
          name: "In-Place Sync",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Fast update using setSeries() and setLabel() without rebuild",
        },
        "SYNC_REBUILD": {
          name: "Full Sync Rebuild",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Complete chart rebuild with forceRedraw() for complex changes",
        },
        "SYNC_VLINE": {
          name: "Vertical Line Sync",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Update vertical line markers across all charts",
        },
        "SYNC_BROADCAST": {
          name: "Broadcast Changes",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Notify all chart subscribers of synchronized updates",
        },

        // ========== SECTION 5: Channel Editor Workflow ==========
        "OPEN_WINDOW": {
          name: "showChannelListWindow()",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Open channel editor popup window",
        },
        "LOAD_DEP": {
          name: "Load Dependencies",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Load Tailwind CSS and Tabulator",
        },
        "BUILD_TBL": {
          name: "Build Tabulator Table",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Create editable table for channels",
        },
        "POP_ROWS": {
          name: "Populate Table Rows",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Fill table with current channel data",
        },
        "TBL_RDY": {
          name: "Table Ready",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Table ready for user editing",
        },
        "USER_ACT": {
          name: "User Action",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Edit, add, or delete row",
        },
        "CELL_ED": {
          name: "Cell Edited",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Cell edit event triggered",
        },
        "ADD_ROW": {
          name: "Add Row",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Add new channel row",
        },
        "DEL_ROW": {
          name: "Delete Row",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Delete channel row",
        },
        "POST_MSG": {
          name: "postMessage",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "Send message to parent window",
        },
        "PARENT_HDL": {
          name: "Parent Message Handler",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Handle messages from child window",
        },
        "TRIGGER_RX": {
          name: "Trigger Reactive System",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Activate state change detection",
        },

        // ========== SECTION 6: Plugin & Advanced Features ==========
        "CORE": {
          name: "Plugin System Core",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Core plugin architecture for uPlot enhancement",
        },
        "STATE_SYS": {
          name: "State Management System",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Reactive state management with history and middleware",
        },
        "PLUGINS_HEADER": {
          name: "Chart Enhancement Plugins",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Collection of advanced chart plugins",
        },
        "AUTO": {
          name: "autoUnitScalePlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "SI unit auto-scaling plugin with prefix conversion",
        },
        "AUTO_DESC": {
          name: "SI Prefix Conversion",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Dynamic conversion of Œº, m, k, M, G prefixes",
        },
        "AUTO_READY": {
          name: "SI Scale Ready",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Auto-scaling initialized and ready",
        },
        "VERT": {
          name: "verticalLinePlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Vertical line marker management plugin",
        },
        "VERT_DESC": {
          name: "Marker Management",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Draw, toggle, and synchronize vertical lines",
        },
        "VERT_READY": {
          name: "Vertical Lines Ready",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Vertical line markers initialized",
        },
        "DELTA": {
          name: "deltaBoxPlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Delta measurement tool plugin",
        },
        "DELTA_DESC": {
          name: "Interactive Deltas",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Calculate and display time and value deltas",
        },
        "DELTA_READY": {
          name: "Delta Tool Ready",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Delta measurement tool initialized",
        },
        "ZOOM": {
          name: "horizontalZoomPanPlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Mouse zoom and pan controls plugin",
        },
        "ZOOM_DESC": {
          name: "Zoom & Pan Controls",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Synchronized zoom and pan across charts",
        },
        "ZOOM_READY": {
          name: "Zoom & Pan Ready",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Zoom and pan controls initialized",
        },
        "DIGI": {
          name: "digitalFillPlugin()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Digital signal visualization plugin",
        },
        "DIGI_DESC": {
          name: "Digital Rendering",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Color-coded HIGH/LOW state rectangles",
        },
        "DIGI_READY": {
          name: "Digital Viz Ready",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Digital visualization initialized",
        },
        "PLUGINS_COMPLETE": {
          name: "All Plugins Ready",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "All chart enhancement plugins initialized",
        },
        "FEATURES_HEADER": {
          name: "Advanced State Features",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Advanced state management features",
        },
        "HISTORY": {
          name: "History System",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "State change history tracking and management",
        },
        "TRACK": {
          name: "Record Mutations",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Record and detect all state mutations",
        },
        "PERSIST": {
          name: "localStorage Persistence",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Save and restore state from local storage",
        },
        "HISTORY_READY": {
          name: "History Ready",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "History system initialized and functional",
        },
        "REACTIVE": {
          name: "Reactive Proxy System",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Reactive state proxy with change detection",
        },
        "BIND": {
          name: "DOM Binding API",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Two-way state-DOM synchronization",
        },
        "COMPUTED": {
          name: "Computed Properties",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Auto-recalculating derived state values",
        },
        "MIDDLEWARE": {
          name: "Middleware System",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Intercept, validate, and transform state changes",
        },
        "REACTIVE_READY": {
          name: "Reactive System Ready",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Reactive proxy system fully operational",
        },
        "FEATURES_COMPLETE": {
          name: "All Features Ready",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "All advanced state features initialized",
        },
        "FINAL": {
          name: "Production Ready",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Full-featured production-ready architecture",
        },
        },
        "MIDDLEWARE": {
          name: "Middleware System",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Intercept and validate state changes",
        },

        // ========== SECTION 7: Complete Application Architecture ==========
        "LOAD_FILES": {
          name: "Select COMTRADE Files",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "User selects CFG and DAT files",
        },
        "PARSE_CFG": {
          name: "parseCFG()",
          path: "module-comtradeUtils.html",
          modulePath: "module-comtradeUtils.html",
          desc: "Parse COMTRADE CFG file",
        },
        "PARSE_DAT": {
          name: "parseDAT()",
          path: "module-comtradeUtils.html",
          modulePath: "module-comtradeUtils.html",
          desc: "Parse COMTRADE DAT file",
        },
        "CFG_OBJ": {
          name: "Configuration Object",
          path: "module-comtradeUtils.html",
          modulePath: "module-comtradeUtils.html",
          desc: "Parsed CFG with channel metadata",
        },
        "INTERP": {
          name: "Linear Interpolation",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Time array interpolation",
        },
        "DATA_OBJ": {
          name: "Data Object",
          path: "module-comtradeUtils.html",
          modulePath: "module-comtradeUtils.html",
          desc: "Parsed and interpolated signal data",
        },
        "INIT_CHANNEL": {
          name: "Initialize channelState",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Create channel configuration state",
        },
        "INIT_DATA": {
          name: "Initialize dataState",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Create signal data state",
        },
        "CHANNEL_STATE": {
          name: "channelState",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Channel metadata (labels, colors, scales)",
        },
        "DATA_STATE": {
          name: "dataState",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Signal data arrays (analog and digital)",
        },
        "VLINES_INIT": {
          name: "Create verticalLinesX",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Initialize vertical line markers state",
        },
        "VLINES_STATE": {
          name: "verticalLinesX State",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Vertical line positions",
        },
        "RENDER_START": {
          name: "renderComtradeCharts()",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "Main chart rendering orchestrator",
        },
        "CLEAR": {
          name: "Clear Charts Container",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "Remove existing chart elements",
        },
        "SETUP_DND": {
          name: "setupChartDragAndDrop()",
          path: "components_setupChartDragAndDrop.js.html",
          modulePath: "module-setupChartDragAndDrop.html",
          desc: "Setup drag and drop system",
        },
        "ANA_RENDER": {
          name: "renderAnalogCharts()",
          path: "components_renderAnalogCharts.js.html",
          modulePath: "module-renderAnalogCharts.html",
          desc: "Render analog channels",
        },
        "DIG_RENDER": {
          name: "renderDigitalCharts()",
          path: "components_renderDigitalCharts.js.html",
          modulePath: "module-renderDigitalCharts.html",
          desc: "Render digital channels",
        },
        "DND_BAR": {
          name: "createDragBar()",
          path: "components_createDragBar.js.html",
          modulePath: "module-createDragBar.html",
          desc: "Create drag bar for chart reordering",
        },
        "BUILD_OPT": {
          name: "buildChartOptions()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Build uPlot options",
        },
        "INIT_CH": {
          name: "initUPlotChart()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Create uPlot instance",
        },
        "CH_READY": {
          name: "Charts Array Ready",
          path: "components_renderComtradeCharts.js.html",
          modulePath: "module-renderComtradeCharts.html",
          desc: "All charts created and initialized",
        },
        "SUBSCRIBE": {
          name: "subscribeChartUpdates()",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Subscribe to state changes",
        },
        "LISTEN": {
          name: "State Change Router",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Detect and route state changes",
        },
        "COLOR_UPD": {
          name: "Color Update",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "In-place color update",
        },
        "FULL_REC": {
          name: "Full Rebuild",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Rebuild charts completely",
        },
        "REACTIVE_OK": {
          name: "Reactive Complete",
          path: "components_chartManager.js.html",
          modulePath: "module-chartManager.html",
          desc: "Reactive updates working",
        },
        "USER_OPENS": {
          name: "Edit Channels",
          path: "components_showChannelListWindow.js.html",
          modulePath: "module-showChannelListWindow.html",
          desc: "User opens channel editor",
        },

        // ========== ADDITIONAL UTILITY FUNCTIONS ==========
        // Utility Functions for Chart Configuration and Formatting
        "LOGSCALES": {
          name: "logScalesDiagnostics()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Debug logging for uPlot scale and axis configuration",
        },
        "SIPREFIX": {
          name: "getSiPrefix()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Calculate SI prefix (Œº, m, k, M, G) for axis values",
        },
        "AXISFORMAT": {
          name: "makeAxisValueFormatter()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Create axis value formatter with SI prefix conversion",
        },
        "UNWRAP": {
          name: "unwrap()",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Extract plain value from reactive state proxy",
        },
        "CREATECONTAINER": {
          name: "createChartContainer()",
          path: "components_chartDomUtils.js.html",
          modulePath: "module-chartDomUtils.html",
          desc: "Create DOM container for chart with title and drag bar",
        },

        // ========== TIME INTERPOLATION UTILITIES ==========
        "FINDSAMPLING": {
          name: "findSamplingRateForSample()",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Find sampling rate for specific sample number",
        },
        "CALCSAMPLE": {
          name: "calculateTimeFromSampleNumber()",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Calculate time value from sample number",
        },
        "LINEARINTERP": {
          name: "linearInterpolate()",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Perform linear interpolation between two points",
        },
        "GENTIMEARRAY": {
          name: "generateUniformTimeArray()",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Generate uniform time array from sampling rates",
        },
        "INTERPDATA": {
          name: "interpolateData()",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Interpolate data series to new time array",
        },
        "COMPARETS": {
          name: "compareTimestamps()",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Compare file timestamps with calculated values",
        },
        "DETECTUNIFORM": {
          name: "detectUniformSpacing()",
          path: "module-timeInterpolation.html",
          modulePath: "module-timeInterpolation.html",
          desc: "Check if time array has uniform spacing",
        },

        // ========== STATE OBJECTS (No parentheses) ==========
        "verticalLinesX": {
          name: "verticalLinesX",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Reactive state for vertical line positions on all charts",
        },
        "dataState": {
          name: "dataState",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Reactive state for parsed signal data arrays",
        },
        "channelState": {
          name: "channelState",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Reactive state for channel metadata (labels, colors, scales)",
        },
        "CALLBACK_TYPE": {
          name: "CALLBACK_TYPE",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Enumeration of callback message types",
        },
        "PROPERTY_ALIASES": {
          name: "PROPERTY_ALIASES",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Mapping of property names to state aliases",
        },
        "whiteBackground": {
          name: "whiteBackground",
          path: "main.js.html",
          modulePath: "module-main.html",
          desc: "Reactive state for background color toggle",
        },

        // ========== PLUGIN SYSTEM OBJECTS AND FUNCTIONS ==========
        "digitalFill": {
          name: "digitalFillPlugin()",
          path: "plugins_digitalFillPlugin.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Plugin for rendering digital signal state rectangles",
        },
        "deltaBox": {
          name: "deltaBoxPlugin()",
          path: "plugins_deltaBoxPlugin.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Plugin for measuring delta values between points",
        },
        "tailwindColors": {
          name: "tailwindColors",
          path: "utils_tailwindColors.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Color palette from Tailwind CSS",
        },
        "crosshairColors": {
          name: "crosshairColors",
          path: "utils_constants.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Array of colors for multi-chart synchronized crosshairs",
        },
        "SI_UNITS": {
          name: "SI_UNITS",
          path: "utils_constants.js.html",
          modulePath: "module-chartComponent.html",
          desc: "SI prefix scaling constants",
        },
        "analogPalette": {
          name: "analogPalette",
          path: "utils_constants.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Default color palette for analog channels",
        },
        "digitalPalette": {
          name: "digitalPalette",
          path: "utils_constants.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Default color palette for digital channels",
        },

        // ========== UTILITY HELPER FUNCTIONS ==========
        "extractUnit": {
          name: "extractUnit()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Extract unit suffix from channel label",
        },
        "getNearestIndex": {
          name: "getNearestIndex()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Find nearest array index for given value",
        },
        "createCustomElement": {
          name: "createCustomElement()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Factory function to create DOM elements with attributes",
        },
        "findDigitalChanges": {
          name: "findChangedDigitalChannelIndices()",
          path: "components_renderDigitalCharts.js.html",
          modulePath: "module-renderDigitalCharts.html",
          desc: "Find digital channels with state transitions",
        },
        "calcDeltas": {
          name: "calculateDeltas()",
          path: "components_createState.js.html",
          modulePath: "module-main.html",
          desc: "Calculate time and value deltas from delta box selection",
        },
        "destroyCharts": {
          name: "destroyCharts()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Cleanup and destroy all uPlot chart instances",
        },
        "syncRequests": {
          name: "requestScaleSync()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Request synchronized scale update across charts",
        },
        "syncAndRedraw": {
          name: "requestScaleSyncAndRedraw()",
          path: "components_chartComponent.js.html",
          modulePath: "module-chartComponent.html",
          desc: "Sync scales and trigger chart redraw",
        },
        "createTooltip": {
          name: "createTooltip()",
          path: "components_Tooltip.js.html",
          modulePath: "components_Tooltip.js.html",
          desc: "Create tooltip element for data display",
        },
        "updateTooltip": {
          name: "updateTooltip()",
          path: "components_Tooltip.js.html",
          modulePath: "components_Tooltip.js.html",
          desc: "Update tooltip position and text content",
        },
        "hideTooltip": {
          name: "hideTooltip()",
          path: "components_Tooltip.js.html",
          modulePath: "components_Tooltip.js.html",
          desc: "Hide tooltip element",
        },
        "showError": {
          name: "showError()",
          path: "components_showError.js.html",
          modulePath: "module-main.html",
          desc: "Display error message to user",
        },
        "createChannelList": {
          name: "createChannelList()",
          path: "components_ChannelList.js.html",
          modulePath: "module-main.html",
          desc: "Create channel list UI component",
        },
        "ResizableGroup": {
          name: "ResizableGroup",
          path: "components_ResizableGroup.js.html",
          modulePath: "module-main.html",
          desc: "Class for managing resizable chart groups",
        },
        "debugLite": {
          name: "debugLite",
          path: "components_debugPanelLite.js.html",
          modulePath: "module-main.html",
          desc: "Lightweight debug panel utilities",
        },
      };

      // Initialize Mermaid
      mermaid.initialize({
        startOnLoad: true,
        theme: "default",
        securityLevel: "loose",
      });

      // Add click handlers after Mermaid renders
      mermaid.contentLoaded();

      setTimeout(() => {
        addNavigationHandlers();
      }, 1000);

      function addNavigationHandlers() {
        const svgs = document.querySelectorAll(".mermaid svg");
        let clickableCount = 0;

        svgs.forEach((svg, svgIndex) => {
          // Query multiple node types to handle all Mermaid diagram types:
          // - flowchart nodes: g[class*='node']
          // - sequence participants: g[class*='actor']
          // - state nodes: g[class*='state']
          // - and others
          const allGroups = svg.querySelectorAll("g[class*='node'], g[class*='actor'], g[class*='state'], text, tspan");
          const processedNodeIds = new Set();

          allGroups.forEach((group) => {
            const nodeId = extractNodeId(group);
            
            // Skip if no valid nodeId found or already processed
            if (!nodeId || processedNodeIds.has(nodeId) || !jsDocMap[nodeId]) {
              return;
            }
            processedNodeIds.add(nodeId);

            // Find the clickable parent element (usually a <g> tag)
            let clickableGroup = group;
            if (group.tagName === 'text' || group.tagName === 'tspan') {
              // Find parent <g> element
              let parent = group.parentElement;
              while (parent && parent.tagName !== 'g') {
                parent = parent.parentElement;
              }
              if (parent) {
                clickableGroup = parent;
              } else {
                return; // No suitable parent found
              }
            }

            clickableGroup.classList.add("clickable-node");
            clickableGroup.style.cursor = "pointer";
            clickableCount++;

            clickableGroup.addEventListener("click", (e) => {
              e.preventDefault();
              e.stopPropagation();
              showJsDocPopup(nodeId);
            });

            clickableGroup.addEventListener("mouseenter", () => {
              clickableGroup.style.opacity = "0.8";
            });

            clickableGroup.addEventListener("mouseleave", () => {
              clickableGroup.style.opacity = "1";
            });
          });
        });

        console.log(`‚úÖ Navigation setup complete: ${clickableCount} interactive nodes found`);
      }

      function extractNodeId(element) {
        let nodeId = null;

        // For text/tspan elements, extract from text content and parent
        if (element.tagName === 'text' || element.tagName === 'tspan') {
          const textContent = element.textContent.trim();
          
          // Try to match first word or common identifiers
          const matches = textContent.match(/^([A-Z_][A-Z0-9_]*)/);
          if (matches && jsDocMap[matches[1]]) {
            return matches[1];
          }
          
          // Try splitting by common delimiters
          const parts = textContent.split(/[\s:\/\-]/);
          for (let part of parts) {
            if (jsDocMap[part]) {
              return part;
            }
          }
          
          // Get text from parent element as well
          const parent = element.parentElement;
          if (parent) {
            return extractNodeId(parent);
          }
        }

        // Method 1: Check for title element (most reliable for Mermaid)
        const titleElement = element.querySelector("title");
        if (titleElement && titleElement.textContent) {
          const titleText = titleElement.textContent.trim();
          nodeId = titleText.split(/[\s:\/]/)[0];
          if (jsDocMap[nodeId]) return nodeId;
        }

        // Method 2: Parse from ID attributes
        const id = element.getAttribute("id");
        if (id) {
          // Extract all uppercase words or known identifiers
          const matches = id.match(/([A-Z_][A-Z0-9_]*)/g);
          if (matches && matches.length > 0) {
            nodeId = matches.find(m => jsDocMap[m]) || matches[0];
            if (jsDocMap[nodeId]) return nodeId;
          }
        }

        // Method 3: Check class attribute for node IDs
        const classList = element.getAttribute("class");
        if (classList) {
          const parts = classList.split(/\s+/);
          for (let part of parts) {
            if (/^[A-Z_]/.test(part) && part !== "node" && part !== "default") {
              // Extract letters from class like "flowchart-START-1234"
              const match = part.match(/([A-Z_][A-Z0-9_]*)/);
              if (match && jsDocMap[match[1]]) {
                return match[1];
              }
            }
          }
        }

        // Method 4: Extract from text content as last resort
        const textElements = element.querySelectorAll("text");
        for (let textEl of textElements) {
          if (textEl.textContent) {
            const text = textEl.textContent.trim();
            // Look for uppercase identifiers or known names
            const match = text.match(/^([A-Z_][A-Z0-9_]*)/);
            if (match && jsDocMap[match[1]]) {
              return match[1];
            }
            
            // Try common delimiters
            const parts = text.split(/[\s:\/\-]/);
            for (let part of parts) {
              if (jsDocMap[part]) {
                return part;
              }
            }
          }
        }

        // Method 5: For sequence/state diagrams, look for direct text content
        const directText = element.textContent ? element.textContent.trim().split('\n')[0] : '';
        if (directText) {
          const match = directText.match(/([A-Z_][A-Z0-9_]*)/);
          if (match && jsDocMap[match[1]]) {
            return match[1];
          }
        }

        return nodeId;
      }

      function showJsDocPopup(nodeId) {
        const docInfo = jsDocMap[nodeId];
        if (!docInfo) {
          console.warn(`No documentation found for node: ${nodeId}`);
          return;
        }

        // Remove existing popup if any
        const existingPopup = document.querySelector(".jsdoc-link-popup");
        if (existingPopup) {
          existingPopup.remove();
        }

        // Create popup
        const popup = document.createElement("div");
        popup.className = "jsdoc-link-popup";
        popup.innerHTML = `
          <span class="close-popup" onclick="this.parentElement.remove()">√ó</span>
          <h3>${docInfo.name}</h3>
          <p>${docInfo.desc}</p>
          <a href="${docInfo.modulePath || docInfo.path}" target="_blank">üìñ Quick Reference</a>
          <a href="${docInfo.path}" target="_blank">üìö Full Documentation</a>
        `;

        document.body.appendChild(popup);

        // Close on escape key
        const escapeHandler = (e) => {
          if (e.key === "Escape") {
            popup.remove();
            document.removeEventListener("keydown", escapeHandler);
          }
        };
        document.addEventListener("keydown", escapeHandler);

        // Close popup when clicking close button
        popup.querySelector(".close-popup").addEventListener("click", () => {
          popup.remove();
          document.removeEventListener("keydown", escapeHandler);
        });
      }

      // Improve node detection by looking for Mermaid-specific structures
      document.addEventListener("DOMContentLoaded", () => {
        setTimeout(() => {
          console.log("üîó Interactive Architecture Diagram loaded");
          console.log(
            "üí° Click on any colored node to view JSDOC documentation"
          );
        }, 500);
      });
    </script>
  
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ 
    startOnLoad: true,
    theme: 'default',
    flowchart: { useMaxWidth: false }
  });
</script>

</body>
</html>
