

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> components/renderSingleAnalogChart.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- build/entry.js removed - not needed -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-analyzeGroupsAndPublish.html">analyzeGroupsAndPublish</a></li><li><a href="module-axisBuilder.html">axisBuilder</a></li><li><a href="module-axisCalculator.html">axisCalculator</a></li><li><a href="module-calculateAndPublishMaxYAxes.html">calculateAndPublishMaxYAxes</a></li><li><a href="module-chartAxisAlignment.html">chartAxisAlignment</a></li><li><a href="module-chartComponent.html">chartComponent</a></li><li><a href="module-chartManager.html">chartManager</a></li><li><a href="module-chartUpdateHelpers.html">chartUpdateHelpers</a></li><li><a href="module-components_renderComputedChart.html">components/renderComputedChart</a></li><li><a href="module-components_renderComtradeCharts.html">components/renderComtradeCharts</a></li><li><a href="module-components_renderSingleAnalogChart.html">components/renderSingleAnalogChart</a></li><li><a href="module-components_renderSingleDigitalChart.html">components/renderSingleDigitalChart</a></li><li><a href="module-comtradeUtils.html">comtradeUtils</a></li><li><a href="module-createDragBar.html">createDragBar</a></li><li><a href="module-createState.html">createState</a></li><li><a href="module-domUpdateQueue.html">domUpdateQueue</a></li><li><a href="module-domUpdateQueueInit.html">domUpdateQueueInit</a></li><li><a href="module-eventListenerManager.html">eventListenerManager</a></li><li><a href="module-handleVerticalLineShortcuts.html">handleVerticalLineShortcuts</a></li><li><a href="module-initVerticalLineControl.html">initVerticalLineControl</a></li><li><a href="module-main.html">main</a></li><li><a href="module-maxYAxesStore.html">maxYAxesStore</a></li><li><a href="module-mergerWindowLauncher.html">mergerWindowLauncher</a></li><li><a href="module-seriesMapper.html">seriesMapper</a></li><li><a href="module-services_computedChannels.html">services/computedChannels</a></li><li><a href="module-services_computedChannels_dataPreparation.html">services/computedChannels/dataPreparation</a></li><li><a href="module-services_computedChannels_eventHandling.html">services/computedChannels/eventHandling</a></li><li><a href="module-services_computedChannels_expressionConversion.html">services/computedChannels/expressionConversion</a></li><li><a href="module-services_computedChannels_resultProcessing.html">services/computedChannels/resultProcessing</a></li><li><a href="module-services_computedChannels_stateUpdate.html">services/computedChannels/stateUpdate</a></li><li><a href="module-services_computedChannels_validators.html">services/computedChannels/validators</a></li><li><a href="module-services_computedChannels_workerManagement.html">services/computedChannels/workerManagement</a></li><li><a href="module-setupChartDragAndDrop.html">setupChartDragAndDrop</a></li><li><a href="module-timeInterpolation.html">timeInterpolation</a></li><li><a href="module-utils_autoGroupChannels.html">utils/autoGroupChannels</a></li><li><a href="module-utils_computedChannelMetadata.html">utils/computedChannelMetadata</a></li><li><a href="module-verticalLineControl.html">verticalLineControl</a></li><li><a href="module-workers_computedChannelWorker.html">workers/computedChannelWorker</a></li></ul><h3>Classes</h3><ul><li><a href="PolarChart.html">PolarChart</a></li><li><a href="PolarChartCanvas.html">PolarChartCanvas</a></li><li><a href="SidebarStore.html">SidebarStore</a></li><li><a href="module-utils_computedChannelMetadata-ComputedChannelMetadata.html">ComputedChannelMetadata</a></li></ul><h3>Global</h3><ul><li><a href="global.html#IMPLEMENTATION_COMPLETE">IMPLEMENTATION_COMPLETE</a></li><li><a href="global.html#QUICK_REFERENCE">QUICK_REFERENCE</a></li><li><a href="global.html#STORAGE_CFG_KEY">STORAGE_CFG_KEY</a></li><li><a href="global.html#adjustMainContent">adjustMainContent</a></li><li><a href="global.html#appendComputedChannelToStorage">appendComputedChannelToStorage</a></li><li><a href="global.html#attachChartContainer">attachChartContainer</a></li><li><a href="global.html#attachChartEventHandlers">attachChartEventHandlers</a></li><li><a href="global.html#attachChartPlugins">attachChartPlugins</a></li><li><a href="global.html#attachComputedChartContainer">attachComputedChartContainer</a></li><li><a href="global.html#attachComputedChartEventHandlers">attachComputedChartEventHandlers</a></li><li><a href="global.html#attachComputedChartPlugins">attachComputedChartPlugins</a></li><li><a href="global.html#axisLinesPlugin">axisLinesPlugin</a></li><li><a href="global.html#broadcastComputedChannelChange">broadcastComputedChannelChange</a></li><li><a href="global.html#buildChartData">buildChartData</a></li><li><a href="global.html#buildChartOptions">buildChartOptions</a></li><li><a href="global.html#buildComputedChannelLabels">buildComputedChannelLabels</a></li><li><a href="global.html#buildComputedChartOptions">buildComputedChartOptions</a></li><li><a href="global.html#buildGroupsWithAutoGrouping">buildGroupsWithAutoGrouping</a></li><li><a href="global.html#buildGroupsWithUserAssignments">buildGroupsWithUserAssignments</a></li><li><a href="global.html#buildTableBody">buildTableBody</a></li><li><a href="global.html#buildTableHTML">buildTableHTML</a></li><li><a href="global.html#buildTableHeader">buildTableHeader</a></li><li><a href="global.html#buildUnitChartData">buildUnitChartData</a></li><li><a href="global.html#calculateStats">calculateStats</a></li><li><a href="global.html#chart2">chart2</a></li><li><a href="global.html#cleanupOldComputedCharts">cleanupOldComputedCharts</a></li><li><a href="global.html#clearChartsContainer">clearChartsContainer</a></li><li><a href="global.html#clearComputedChannelsFromStorage">clearComputedChannelsFromStorage</a></li><li><a href="global.html#clearExpressionCache">clearExpressionCache</a></li><li><a href="global.html#closeAnalysisDrawer">closeAnalysisDrawer</a></li><li><a href="global.html#collectChartDeltas">collectChartDeltas</a></li><li><a href="global.html#computeChartDataDimensions">computeChartDataDimensions</a></li><li><a href="global.html#convertLatexToMathJs">convertLatexToMathJs</a></li><li><a href="global.html#convertLatexToPlainText">convertLatexToPlainText</a></li><li><a href="global.html#createAnalogChannelGroupMap">createAnalogChannelGroupMap</a></li><li><a href="global.html#createBinaryBlob">createBinaryBlob</a></li><li><a href="global.html#createChannelItem">createChannelItem</a></li><li><a href="global.html#createChannelList">createChannelList</a></li><li><a href="global.html#createChartContainer">createChartContainer</a></li><li><a href="global.html#createChartMetadata">createChartMetadata</a></li><li><a href="global.html#createChartOptions">createChartOptions</a></li><li><a href="global.html#createComputedChannelsSidebar">createComputedChannelsSidebar</a></li><li><a href="global.html#createComputedChartMetadata">createComputedChartMetadata</a></li><li><a href="global.html#createComputedClickHandler">createComputedClickHandler</a></li><li><a href="global.html#createComputedMousemoveHandler">createComputedMousemoveHandler</a></li><li><a href="global.html#createDeltaTableRenderer">createDeltaTableRenderer</a></li><li><a href="global.html#createDigitalFillPlugin">createDigitalFillPlugin</a></li><li><a href="global.html#createGroupDragBar">createGroupDragBar</a></li><li><a href="global.html#createMousemoveHandler">createMousemoveHandler</a></li><li><a href="global.html#createProgressBar">createProgressBar</a></li><li><a href="global.html#createScopeTemplate">createScopeTemplate</a></li><li><a href="global.html#createSidebarResizer">createSidebarResizer</a></li><li><a href="global.html#createSimpleChannelList">createSimpleChannelList</a></li><li><a href="global.html#createSimpleContainer">createSimpleContainer</a></li><li><a href="global.html#createState">createState</a></li><li><a href="global.html#createTooltip">createTooltip</a></li><li><a href="global.html#createVerticalLineClickHandler">createVerticalLineClickHandler</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#detectGroupFromExpression">detectGroupFromExpression</a></li><li><a href="global.html#encodeFloat64">encodeFloat64</a></li><li><a href="global.html#encodeInt32">encodeInt32</a></li><li><a href="global.html#evaluateAndSaveComputedChannel">evaluateAndSaveComputedChannel</a></li><li><a href="global.html#evaluateExpression">evaluateExpression</a></li><li><a href="global.html#exportAllChannelsAsCSV">exportAllChannelsAsCSV</a></li><li><a href="global.html#exportAllComputedChannels">exportAllComputedChannels</a></li><li><a href="global.html#exportComputedChannelAsASCII">exportComputedChannelAsASCII</a></li><li><a href="global.html#exportComputedChannelAsCFGDAT">exportComputedChannelAsCFGDAT</a></li><li><a href="global.html#exportComputedChannelsAsCSV">exportComputedChannelsAsCSV</a></li><li><a href="global.html#extractChannelMetadata">extractChannelMetadata</a></li><li><a href="global.html#extractChannelNameFromEquation">extractChannelNameFromEquation</a></li><li><a href="global.html#extractGroupId">extractGroupId</a></li><li><a href="global.html#extractMathExpression">extractMathExpression</a></li><li><a href="global.html#filterGroupsWithChannels">filterGroupsWithChannels</a></li><li><a href="global.html#filterIndicesWithData">filterIndicesWithData</a></li><li><a href="global.html#filterTableRows">filterTableRows</a></li><li><a href="global.html#filterUnassignedComputedChannels">filterUnassignedComputedChannels</a></li><li><a href="global.html#filterValidIndices">filterValidIndices</a></li><li><a href="global.html#formatEquationForLatex">formatEquationForLatex</a></li><li><a href="global.html#formatScaledValue">formatScaledValue</a></li><li><a href="global.html#formatTableData">formatTableData</a></li><li><a href="global.html#generateCFGContent">generateCFGContent</a></li><li><a href="global.html#generateCFGContentBatch">generateCFGContentBatch</a></li><li><a href="global.html#generateCFGContentBinary32">generateCFGContentBinary32</a></li><li><a href="global.html#generateCFGContentBinary64">generateCFGContentBinary64</a></li><li><a href="global.html#generateCFGContentFloat32">generateCFGContentFloat32</a></li><li><a href="global.html#generateCFGContentFloat64">generateCFGContentFloat64</a></li><li><a href="global.html#generateDATContent">generateDATContent</a></li><li><a href="global.html#generateDATContentBatch">generateDATContentBatch</a></li><li><a href="global.html#generateDATContentBinary32">generateDATContentBinary32</a></li><li><a href="global.html#generateDATContentBinary64">generateDATContentBinary64</a></li><li><a href="global.html#generateDATContentFloat32">generateDATContentFloat32</a></li><li><a href="global.html#generateDATContentFloat64">generateDATContentFloat64</a></li><li><a href="global.html#generateUniqueComputedGroup">generateUniqueComputedGroup</a></li><li><a href="global.html#getAllAvailableGroups">getAllAvailableGroups</a></li><li><a href="global.html#getCacheStats">getCacheStats</a></li><li><a href="global.html#getChannelByDisplayName">getChannelByDisplayName</a></li><li><a href="global.html#getChannelMetadata">getChannelMetadata</a></li><li><a href="global.html#getChannelsForFile">getChannelsForFile</a></li><li><a href="global.html#getColorHex">getColorHex</a></li><li><a href="global.html#getCompiledExpression">getCompiledExpression</a></li><li><a href="global.html#getComputedChannelById">getComputedChannelById</a></li><li><a href="global.html#getComputedChannelStorageMetadata">getComputedChannelStorageMetadata</a></li><li><a href="global.html#getComputedChannelsState">getComputedChannelsState</a></li><li><a href="global.html#getElementWidth">getElementWidth</a></li><li><a href="global.html#getFileIndexForTime">getFileIndexForTime</a></li><li><a href="global.html#getOriginalChannelName">getOriginalChannelName</a></li><li><a href="global.html#getSampleIndexInFile">getSampleIndexInFile</a></li><li><a href="global.html#groupChannelsByUnit">groupChannelsByUnit</a></li><li><a href="global.html#handleComputedVerticalLineAddition">handleComputedVerticalLineAddition</a></li><li><a href="global.html#handleVerticalLineAddition">handleVerticalLineAddition</a></li><li><a href="global.html#hasDigitalData">hasDigitalData</a></li><li><a href="global.html#hasStoredComputedChannels">hasStoredComputedChannels</a></li><li><a href="global.html#hideProgress">hideProgress</a></li><li><a href="global.html#hideTooltip">hideTooltip</a></li><li><a href="global.html#importComputedChannelFromJSON">importComputedChannelFromJSON</a></li><li><a href="global.html#initComputedChannelsState">initComputedChannelsState</a></li><li><a href="global.html#initUPlotChart">initUPlotChart</a></li><li><a href="global.html#initializeChartInstance">initializeChartInstance</a></li><li><a href="global.html#initializeComputedChartInstance">initializeComputedChartInstance</a></li><li><a href="global.html#initializeSidebarChannels">initializeSidebarChannels</a></li><li><a href="global.html#injectSidebarIntoUplot">injectSidebarIntoUplot</a></li><li><a href="global.html#isMathJaxLoaded">isMathJaxLoaded</a></li><li><a href="global.html#listenForComputedChannelChanges">listenForComputedChannelChanges</a></li><li><a href="global.html#loadComputedChannelsForGroup">loadComputedChannelsForGroup</a></li><li><a href="global.html#loadComputedChannelsFromStorage">loadComputedChannelsFromStorage</a></li><li><a href="global.html#loadMathJax">loadMathJax</a></li><li><a href="global.html#mathJaxPromise">mathJaxPromise</a></li><li><a href="global.html#measurePerformance">measurePerformance</a></li><li><a href="global.html#mergeAnalogAndComputedMetadata">mergeAnalogAndComputedMetadata</a></li><li><a href="global.html#mergeAnalogChannels">mergeAnalogChannels</a></li><li><a href="global.html#mergeComtradeFilesSetsSequential">mergeComtradeFilesSetsSequential</a></li><li><a href="global.html#mergeDigitalChannels">mergeDigitalChannels</a></li><li><a href="global.html#mergeTimeArraysSequential">mergeTimeArraysSequential</a></li><li><a href="global.html#openAnalysisDrawer">openAnalysisDrawer</a></li><li><a href="global.html#openBothSidebars">openBothSidebars</a></li><li><a href="global.html#openDeltaWindow">openDeltaWindow</a></li><li><a href="global.html#openMathLiveEditor">openMathLiveEditor</a></li><li><a href="global.html#openPhasorDiagram">openPhasorDiagram</a></li><li><a href="global.html#performExport">performExport</a></li><li><a href="global.html#prepareChartDataContext">prepareChartDataContext</a></li><li><a href="global.html#processEquationInput">processEquationInput</a></li><li><a href="global.html#readFileAsText">readFileAsText</a></li><li><a href="global.html#renameChannelWithPrefix">renameChannelWithPrefix</a></li><li><a href="global.html#renderChannelLabelContainer">renderChannelLabelContainer</a></li><li><a href="global.html#renderComputedChannels">renderComputedChannels</a></li><li><a href="global.html#renderLatex">renderLatex</a></li><li><a href="global.html#resizeChartsToContainers">resizeChartsToContainers</a></li><li><a href="global.html#resolveGroupIndices">resolveGroupIndices</a></li><li><a href="global.html#resolveTimeArray">resolveTimeArray</a></li><li><a href="global.html#saveComputedChannelsToStorage">saveComputedChannelsToStorage</a></li><li><a href="global.html#setupMobileSidebar">setupMobileSidebar</a></li><li><a href="global.html#showChannelListWindow">showChannelListWindow</a></li><li><a href="global.html#showError">showError</a></li><li><a href="global.html#showExportFormatDialog">showExportFormatDialog</a></li><li><a href="global.html#showFileInfo">showFileInfo</a></li><li><a href="global.html#showProgress">showProgress</a></li><li><a href="global.html#subscribeChartUpdates">subscribeChartUpdates</a></li><li><a href="global.html#syncComputedChannelsWithParent">syncComputedChannelsWithParent</a></li><li><a href="global.html#themeContext">themeContext</a></li><li><a href="global.html#toggleChartsVisibility">toggleChartsVisibility</a></li><li><a href="global.html#updateComputedChannelGroupInStorage">updateComputedChannelGroupInStorage</a></li><li><a href="global.html#updateComputedChannelsSidebar">updateComputedChannelsSidebar</a></li><li><a href="global.html#updateFileInfo">updateFileInfo</a></li><li><a href="global.html#updateProgress">updateProgress</a></li><li><a href="global.html#updateStatsCards">updateStatsCards</a></li><li><a href="global.html#updateTooltip">updateTooltip</a></li><li><a href="global.html#validateChannelName">validateChannelName</a></li><li><a href="global.html#validateGroupIndices">validateGroupIndices</a></li><li><a href="global.html#wrapChartInSection">wrapChartInSection</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>components/renderSingleAnalogChart.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file renderSingleAnalogChart.js
 * @module components/renderSingleAnalogChart
 * 
 * @description
 * &lt;h3>Single Analog Chart Renderer&lt;/h3>
 * 
 * &lt;p>Core building block for analog chart visualization in COMTRADE viewers.
 * Renders a SINGLE uPlot instance for one channel group.&lt;/p>
 * 
 * &lt;h4>Design Philosophy&lt;/h4>
 * &lt;table>
 *   &lt;tr>&lt;th>Principle&lt;/th>&lt;th>Description&lt;/th>&lt;/tr>
 *   &lt;tr>&lt;td>Single Responsibility&lt;/td>&lt;td>One function â†’ one chart&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>DRY&lt;/td>&lt;td>Uses shared utilities to avoid duplication&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Ownership Rule&lt;/td>&lt;td>Computed channels render with their parent group&lt;/td>&lt;/tr>
 *   &lt;tr>&lt;td>Consistency&lt;/td>&lt;td>Same interface as &lt;code>renderSingleDigitalChart&lt;/code>&lt;/td>&lt;/tr>
 * &lt;/table>
 * 
 * &lt;h4>Key Features&lt;/h4>
 * &lt;ul>
 *   &lt;li>&lt;strong>Group-based rendering&lt;/strong> â€” Channels grouped by user or auto-grouping&lt;/li>
 *   &lt;li>&lt;strong>Computed channel integration&lt;/strong> â€” Ownership rule merges computed into parent&lt;/li>
 *   &lt;li>&lt;strong>Auto data validation&lt;/strong> â€” Filters invalid/empty channels&lt;/li>
 *   &lt;li>&lt;strong>Shared event handlers&lt;/strong> â€” Click for vertical lines, hover for tooltip&lt;/li>
 *   &lt;li>&lt;strong>Responsive charts&lt;/strong> â€” ResizeObserver auto-adjusts&lt;/li>
 * &lt;/ul>
 * 
 * &lt;h4>Pipeline&lt;/h4>
 * &lt;ol>
 *   &lt;li>Input: groupId, channelIndices, cfg, data&lt;/li>
 *   &lt;li>Validate Inputs â†’ Invalid? Return null&lt;/li>
 *   &lt;li>Build chartData Array&lt;/li>
 *   &lt;li>Extract Labels / Colors / Units&lt;/li>
 *   &lt;li>&lt;code>createDragBar()&lt;/code> â†’ &lt;code>createChartContainer()&lt;/code>&lt;/li>
 *   &lt;li>&lt;code>createChartOptions()&lt;/code> â†’ &lt;code>initUPlotChart()&lt;/code>&lt;/li>
 *   &lt;li>Attach Metadata â†’ &lt;code>attachChartEventHandlers()&lt;/code>&lt;/li>
 *   &lt;li>Return chart instance&lt;/li>
 * &lt;/ol>
 * 
 * @see {@link module:components/renderSingleDigitalChart} - Digital equivalent
 * @see {@link module:components/renderComtradeCharts} - Orchestrator
 * @see {@link module:utils/autoGroupChannels} - Grouping logic
 * 
 * @example
 * import { renderSingleAnalogChart } from "./renderSingleAnalogChart.js";
 * 
 * renderSingleAnalogChart(
 *   "G0",              // Group ID
 *   [0, 1, 2],         // Channel indices (IA, IB, IC)
 *   0,                 // Chart index
 *   cfg, data,         // COMTRADE data
 *   chartsContainer,   // DOM container
 *   charts,            // Charts array
 *   verticalLinesX,    // Vertical lines state
 *   { channelState, maxYAxes: 3, computedChannels: [] }
 * );
 * 
 * @mermaid
 * graph TD
 *     A[Input: groupId, channelIndices, cfg, data] --> B[Validate Inputs]
 *     B --> C{Valid?}
 *     C -->|No| D[Return null]
 *     C -->|Yes| E[Build chartData Array]
 *     E --> F[Extract Labels/Colors/Units]
 *     F --> G[createDragBar]
 *     G --> H[createChartContainer]
 *     H --> I[createChartOptions]
 *     I --> J[initUPlotChart]
 *     J --> K[Attach Metadata]
 *     K --> L[attachChartEventHandlers]
 *     L --> M[Return chart instance]
 */

import { createDragBar } from "./createDragBar.js";
import { createChartOptions } from "./chartComponent.js";
import { addChart } from "../utils/chartMetadataStore.js";
import { createChartContainer, initUPlotChart } from "../utils/chartDomUtils.js";
import verticalLinePlugin from "../plugins/verticalLinePlugin.js";
import { attachChartEventHandlers } from "../utils/chartInteractions.js";
import { resolveTimeArray } from "../utils/computedChannelDataProcessor.js";

/**
 * Channel state object structure for analog channels
 * 
 * @typedef {Object} AnalogChannelState
 * @property {string[]} yLabels - Array of channel labels indexed by channel position
 * @property {string[]} lineColors - Array of hex color codes indexed by channel position
 * @property {string[]} yUnits - Array of unit strings (e.g., "V", "A", "Hz")
 * @property {number[]} axesScales - Array of Y-axis scale multipliers
 * @property {string[]} groups - Array of group IDs per channel (e.g., ["G0", "G0", "G1"])
 * @property {string} xLabel - X-axis label (default: "Time")
 * @property {string} xUnit - X-axis unit (default: "s" or "ms")
 * 
 * @example
 * const channelState = {
 *   analog: {
 *     yLabels: ["IA", "IB", "IC", "VA", "VB", "VC"],
 *     lineColors: ["#FF0000", "#00FF00", "#0000FF", "#FF6600", "#00FF66", "#6600FF"],
 *     yUnits: ["A", "A", "A", "V", "V", "V"],
 *     axesScales: [1, 1, 1, 1, 1, 1, 1],
 *     groups: ["G0", "G0", "G0", "G1", "G1", "G1"],
 *     xLabel: "Time",
 *     xUnit: "ms"
 *   }
 * };
 */

/**
 * Computed channel object structure
 * 
 * @typedef {Object} ComputedChannel
 * @property {string} id - Unique identifier (e.g., "computed_1")
 * @property {string} name - Display name (e.g., "RMS Current")
 * @property {string} color - Hex color code (e.g., "#4ECDC4")
 * @property {string} group - Parent group ID (e.g., "G0") - determines which analog chart owns it
 * @property {string} unit - Unit string (e.g., "A", "V")
 * @property {string} formula - Calculation formula (e.g., "sqrt(IA^2 + IB^2 + IC^2)")
 * @property {number[]} data - Calculated data array (same length as time array)
 * 
 * @example
 * const computedChannel = {
 *   id: "computed_rms_current",
 *   name: "RMS Current",
 *   color: "#4ECDC4",
 *   group: "G0",           // Will render in G0's analog chart
 *   unit: "A",
 *   formula: "sqrt(IA^2 + IB^2 + IC^2) / sqrt(3)",
 *   data: [1.23, 1.25, 1.24, ...]  // Pre-calculated values
 * };
 */

/**
 * Options object for renderSingleAnalogChart
 * 
 * @typedef {Object} RenderAnalogOptions
 * @property {Object} channelState - Channel state with analog/digital sub-objects
 * @property {AnalogChannelState} channelState.analog - Analog channel configuration
 * @property {number} [maxYAxes=1] - Maximum Y-axes for alignment across charts
 * @property {ComputedChannel[]} [computedChannels=[]] - Computed channels for this group
 * 
 * @example
 * const options = {
 *   channelState: {
 *     analog: { yLabels: [...], lineColors: [...], groups: [...] }
 *   },
 *   maxYAxes: 3,
 *   computedChannels: [
 *     { id: "rms", name: "RMS", color: "#4ECDC4", group: "G0", data: [...] }
 *   ]
 * };
 */

/**
 * Chart metadata object attached to uPlot instance
 * 
 * @typedef {Object} ChartMetadata
 * @property {string} chartType - Chart type ("analog", "digital", "computed")
 * @property {string} name - Chart name (same as groupId)
 * @property {string} groupName - Group name for display
 * @property {string} userGroupId - User-facing group ID (e.g., "G0")
 * @property {string[]} channels - Array of channel IDs (e.g., ["analog-0", "analog-1"])
 * @property {string[]} colors - Array of hex colors for each channel
 * @property {number[]} indices - Array of original channel indices
 * @property {string} sourceGroupId - Original group ID before any merging
 */

/**
 * Render a SINGLE uPlot instance for one analog channel group.
 * 
 * This function creates a complete analog chart with:
 * - Multiple analog channels from the same group
 * - Optional computed channels that belong to this group (ownership rule)
 * - Drag bar for chart reordering
 * - Click handler for vertical line markers
 * - Tooltip on hover showing all channel values
 * - Responsive resize handling
 * 
 * **Ownership Rule:**
 * Computed channels are rendered in the analog chart whose groupId matches
 * the computed channel's `group` property. This ensures computed channels
 * appear alongside their source data.
 * 
 * **Data Flow:**
 * ```
 * cfg.analogChannels[idx] â†’ channel metadata (id, unit, etc.)
 * data.analogData[idx]    â†’ actual waveform data arrays
 * channelState.analog     â†’ user customizations (colors, labels, groups)
 * options.computedChannels â†’ pre-calculated computed channel data
 * ```
 * 
 * @function renderSingleAnalogChart
 * @memberof module:components/renderSingleAnalogChart
 * @since 1.0.0
 * 
 * @param {string} groupId - Group identifier (e.g., "G0", "G1", "Currents")
 *   Used for chart title, metadata, and computed channel ownership matching
 * 
 * @param {number[]} channelIndices - Array of channel indices belonging to this group
 *   These indices map to `cfg.analogChannels[idx]` and `data.analogData[idx]`
 *   Example: [0, 1, 2] for channels IA, IB, IC
 * 
 * @param {number} chartIndex - Chart position/number (0-based)
 *   Used for ordering and dataset attributes
 * 
 * @param {Object} cfg - COMTRADE configuration object from parseCFG()
 * @param {Object[]} cfg.analogChannels - Array of analog channel definitions
 * @param {string} cfg.analogChannels[].id - Channel identifier (e.g., "IA")
 * @param {string} cfg.analogChannels[].unit - Channel unit (e.g., "A", "V")
 * @param {number} cfg.analogChannels[].multiplier - Scaling multiplier
 * 
 * @param {Object} data - Parsed COMTRADE data object from parseDAT()
 * @param {number[]} data.time - Time array in seconds or milliseconds
 * @param {number[][]} data.analogData - 2D array of analog channel data
 *   `data.analogData[channelIndex][sampleIndex]`
 * 
 * @param {HTMLElement} chartsContainer - DOM container to append chart to
 *   Typically `document.getElementById("charts-container")`
 * 
 * @param {uPlot[]} charts - Array to push new chart instance into
 *   Shared across all charts for synchronized cursor/zoom
 * 
 * @param {Object} verticalLinesX - Reactive array for vertical line positions
 * @param {number[]} verticalLinesX.value - Current line X positions
 * @param {Function} verticalLinesX.asArray - Returns positions as array
 * 
 * @param {RenderAnalogOptions} [options={}] - Additional options
 * 
 * @returns {uPlot|null} The created uPlot instance, or null if:
 *   - No valid channel indices provided
 *   - Missing time or analogData
 *   - All channels have empty data
 *   - uPlot creation failed
 * 
 * @throws {Error} Does not throw - returns null on failure with console warnings
 * 
 * @example
 * // Example 1: Basic analog chart with 3 current channels
 * const chart = renderSingleAnalogChart(
 *   "G0",                              // Group ID
 *   [0, 1, 2],                         // Indices for IA, IB, IC
 *   0,                                 // First chart
 *   cfg,                               // From parseCFG()
 *   data,                              // From parseDAT()
 *   document.getElementById("charts"), // Container
 *   charts,                            // Charts array
 *   verticalLinesX,                    // Vertical lines state
 *   {
 *     channelState: {
 *       analog: {
 *         yLabels: ["IA", "IB", "IC"],
 *         lineColors: ["#FF0000", "#00FF00", "#0000FF"],
 *         groups: ["G0", "G0", "G0"]
 *       }
 *     },
 *     maxYAxes: 3
 *   }
 * );
 * 
 * @example
 * // Example 2: Analog chart with computed channel (ownership rule)
 * const computedChannels = [
 *   {
 *     id: "rms_current",
 *     name: "I_RMS",
 *     color: "#4ECDC4",
 *     group: "G0",        // â† Matches groupId, will render in this chart
 *     unit: "A",
 *     data: calculateRMS(data.analogData, [0, 1, 2])
 *   }
 * ];
 * 
 * const chart = renderSingleAnalogChart(
 *   "G0", [0, 1, 2], 0, cfg, data,
 *   container, charts, verticalLinesX,
 *   { channelState, maxYAxes: 3, computedChannels }
 * );
 * // Chart will have 4 series: IA, IB, IC, I_RMS
 * 
 * @example
 * // Example 3: Handling return value
 * const chart = renderSingleAnalogChart(...);
 * 
 * if (chart) {
 *   console.log("Chart created:", chart._userGroupId);
 *   console.log("Channels:", chart._channelIndices);
 *   console.log("Computed:", chart._computedChannelIds);
 *   
 *   // Access chart data
 *   const timeArray = chart.data[0];
 *   const firstChannel = chart.data[1];
 * } else {
 *   console.warn("Chart creation failed");
 * }
 * 
 * @mermaid
 * sequenceDiagram
 *     Caller->>Func: groupId, indices, cfg, data
 *     Func->>Func: Validate inputs
 *     Func->>DragBar: createDragBar
 *     DragBar-->>Func: dragBar element
 *     Func->>Container: createChartContainer
 *     Container-->>Func: parentDiv, chartDiv
 *     Func->>Options: createChartOptions
 *     Options-->>Func: opts
 *     Func->>uPlot: initUPlotChart
 *     uPlot-->>Func: chart
 *     Func->>Events: attachChartEventHandlers
 *     Func-->>Caller: return chart
 * 
 * @see {@link module:components/chartComponent~createChartOptions} - Options builder
 * @see {@link module:utils/chartDomUtils~initUPlotChart} - uPlot initialization
 * @see {@link module:utils/chartInteractions~attachChartEventHandlers} - Event binding
 * @see {@link module:components/renderComtradeCharts} - Caller/orchestrator
 */
export function renderSingleAnalogChart(
  groupId,
  channelIndices,
  chartIndex,
  cfg,
  data,
  chartsContainer,
  charts,
  verticalLinesX,
  options = {}
) {
  const { channelState, maxYAxes = 1, computedChannels = [] } = options;
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DETERMINE MODE: COMTRADE mode (has indices) vs Computed-only mode (empty indices)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const hasComtradeChannels = channelIndices?.length > 0;
  const hasComputedChannels = computedChannels?.length > 0;

  console.log(`[renderSingleAnalogChart] ğŸ“Š Creating chart #${chartIndex} for group "${groupId}" - Mode: ${hasComtradeChannels ? 'COMTRADE' : 'Computed-only'} (${channelIndices?.length || 0} COMTRADE + ${computedChannels.length} computed)`);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // VALIDATE INPUTS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Need at least COMTRADE channels OR computed channels
  if (!hasComtradeChannels &amp;&amp; !hasComputedChannels) {
    console.warn(`[renderSingleAnalogChart] âš ï¸ No channels for "${groupId}"`);
    return null;
  }

  // For COMTRADE mode, need time and analogData
  if (hasComtradeChannels &amp;&amp; (!data?.time?.length || !data?.analogData?.length)) {
    console.warn(`[renderSingleAnalogChart] âš ï¸ Missing time or analogData for COMTRADE mode`);
    return null;
  }

  // Resolve time array using centralized utility (handles multiple fallback sources)
  // For COMTRADE mode: uses data.time
  // For computed-only mode: tries data.time, data.time.data, data.timeArray, or generates synthetic
  let timeArray = resolveTimeArray(data, computedChannels);
  
  if (!timeArray?.length) {
    console.warn(`[renderSingleAnalogChart] âš ï¸ No time data available for "${groupId}"`);
    return null;
  }

  // Filter to valid COMTRADE indices that have data
  const validIndices = hasComtradeChannels 
    ? channelIndices.filter(idx => 
        idx >= 0 &amp;&amp; 
        idx &lt; data.analogData.length &amp;&amp; 
        Array.isArray(data.analogData[idx]) &amp;&amp; 
        data.analogData[idx].length > 0
      )
    : [];

  if (validIndices.length === 0 &amp;&amp; computedChannels.length === 0) {
    console.warn(`[renderSingleAnalogChart] âš ï¸ No valid data for group "${groupId}"`);
    return null;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BUILD CHART DATA: [time, ...analogSeries, ...computedSeries]
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // Determine sample count (minimum of all series)
  const allLengths = [
    timeArray.length,
    ...validIndices.map(idx => data.analogData[idx].length),
    ...computedChannels.filter(ch => ch.data?.length).map(ch => ch.data.length)
  ];
  const sampleCount = Math.min(...allLengths);

  // Build data array
  const chartData = [timeArray.slice(0, sampleCount)];
  
  // Add analog series (COMTRADE channels)
  validIndices.forEach(idx => {
    chartData.push(data.analogData[idx].slice(0, sampleCount));
  });
  
  // Add computed series (if any belong to this group)
  const computedWithData = computedChannels.filter(ch => ch.data?.length > 0);
  computedWithData.forEach(ch => {
    chartData.push(ch.data.slice(0, sampleCount));
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BUILD METADATA: labels, colors, units
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const analog = channelState?.analog || {};
  
  // Build labels from COMTRADE channels + computed channels
  const yLabels = [
    ...validIndices.map(idx => analog.yLabels?.[idx] || cfg?.analogChannels?.[idx]?.id || `Ch${idx}`),
    ...computedWithData.map(ch => ch.name || ch.id)
  ];
  
  // Build colors from COMTRADE channels + computed channels
  const lineColors = [
    ...validIndices.map(idx => analog.lineColors?.[idx] || "#888"),
    ...computedWithData.map(ch => ch.color || "#4ECDC4")
  ];
  
  // Build units from COMTRADE channels + computed channels
  const yUnits = [
    ...validIndices.map(idx => analog.yUnits?.[idx] || cfg?.analogChannels?.[idx]?.unit || ""),
    ...computedWithData.map(ch => ch.unit || "")
  ];
  
  // Build axes scales (1 for computed channels)
  const axesScales = [
    analog.axesScales?.[0] || 1,
    ...validIndices.map(idx => analog.axesScales?.[idx + 1] || 1),
    ...computedWithData.map(() => 1)
  ];

  const xLabel = analog.xLabel || "Time";
  const xUnit = analog.xUnit || "";

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CREATE CHART METADATA
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const metadata = addChart({
    chartType: "analog",
    name: groupId,
    groupName: groupId,
    userGroupId: groupId,
    channels: validIndices.map(idx => `analog-${idx}`),
    colors: lineColors,
    indices: validIndices.slice(),
    sourceGroupId: groupId,
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CREATE DOM: Drag bar + Container
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const dragBar = createDragBar({ indices: validIndices, name: groupId }, cfg, channelState);
  
  const { parentDiv, chartDiv } = createChartContainer(
    dragBar,
    "chart-container",
    yLabels,
    lineColors,
    "Analog Channels",
    groupId,
    "analog"
  );
  
  parentDiv.dataset.userGroupId = groupId;
  parentDiv.dataset.chartType = "analog";
  parentDiv.dataset.chartIndex = chartIndex;
  chartsContainer.appendChild(parentDiv);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CREATE UPLOT OPTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const opts = createChartOptions({
    title: groupId,
    yLabels,
    lineColors,
    verticalLinesX,
    xLabel,
    xUnit,
    getCharts: () => charts,
    yUnits,
    axesScales,
    singleYAxis: false,
    maxYAxes,
  });
  
  // Add vertical line plugin
  opts.plugins = opts.plugins || [];
  opts.plugins.push(verticalLinePlugin(verticalLinesX, () => charts));

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CREATE UPLOT INSTANCE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const chart = initUPlotChart(opts, chartData, chartDiv, charts);
  
  if (!chart) {
    console.warn(`[renderSingleAnalogChart] âš ï¸ Failed to create uPlot for "${groupId}"`);
    parentDiv.remove();
    return null;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ATTACH METADATA TO CHART INSTANCE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  chart._metadata = metadata;
  chart._userGroupId = groupId;
  chart._groupId = groupId;
  chart._chartType = "analog";
  chart._chartIndex = chartIndex;
  chart._type = "analog";
  chart._channelIndices = validIndices.slice();
  chart._validIndices = validIndices.slice();
  
  // Computed channel metadata
  chart._computedChannels = computedWithData.map(ch => ({
    id: ch.id, name: ch.name, color: ch.color, group: ch.group, unit: ch.unit
  }));
  chart._computedChannelIds = computedWithData.map(ch => ch.id);
  chart._analogSeriesCount = validIndices.length;
  chart._computedSeriesCount = computedWithData.length;
  
  // Scaling metadata
  chart._axesScales = axesScales;
  chart._yUnits = yUnits;
  chart._seriesColors = lineColors;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ATTACH EVENT HANDLERS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  attachChartEventHandlers(chart, charts, verticalLinesX, opts);

  console.log(`[renderSingleAnalogChart] âœ… Created chart #${chartIndex} "${groupId}" with ${chartData.length - 1} series (${validIndices.length} analog + ${computedWithData.length} computed)`);
  
  return chart;
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
